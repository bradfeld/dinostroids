var fe="@vercel/analytics",ue="1.5.0",ge=()=>{window.va||(window.va=function(...i){(window.vaq=window.vaq||[]).push(i)})};function j(){return typeof window<"u"}function Z(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function me(e="auto"){if(e==="auto"){window.vam=Z();return}window.vam=e}function we(){return(j()?window.vam:Z())||"production"}function C(){return we()==="development"}function ye(e){return e.scriptSrc?e.scriptSrc:C()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function J(e={debug:!0}){var i;if(!j())return;me(e.mode),ge(),e.beforeSend&&((i=window.va)==null||i.call(window,"beforeSend",e.beforeSend));let n=ye(e);if(document.head.querySelector(`script[src*="${n}"]`))return;let s=document.createElement("script");s.src=n,s.defer=!0,s.dataset.sdkn=fe+(e.framework?`/${e.framework}`:""),s.dataset.sdkv=ue,e.disableAutoTrack&&(s.dataset.disableAutoTrack="1"),e.endpoint?s.dataset.endpoint=e.endpoint:e.basePath&&(s.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(s.dataset.dsn=e.dsn),s.onerror=()=>{let d=C()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${n}. ${d}`)},C()&&e.debug===!1&&(s.dataset.debug="false"),document.head.appendChild(s)}J();var r=document.getElementById("gameCanvas"),t=r.getContext("2d");r.width=window.innerWidth;r.height=window.innerHeight;var k=Math.PI*2;var xe=15,pe=.07*3,L=.18*3,Se=.98,ie=3e3,Te=2,Ae=8,ve=50,_=120,B=.6*3,N=1.6*3,ne={large:45,medium:25,small:15},F={easy:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},medium:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},difficult:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}}},oe=10,p={easy:{playerAcceleration:L,shootCooldown:_,asteroidMinSpeed:B,asteroidSpeedVariation:N,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:L*1.5,shootCooldown:Math.floor(_*.7),asteroidMinSpeed:B*1.5,asteroidSpeedVariation:N*1.2,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:L*2,shootCooldown:Math.floor(_*.5),asteroidMinSpeed:B*2,asteroidSpeedVariation:N*1.5,initialAsteroidCountBase:4,lives:2}},P="medium",Ee=p.medium.playerAcceleration,re=p.medium.shootCooldown,Ie=p.medium.asteroidMinSpeed,be=p.medium.asteroidSpeedVariation,ke=p.medium.initialAsteroidCountBase,K=p.medium.lives,Y={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},Fe={[Y.BIG]:{baseSize:45,score:20},[Y.MEDIUM]:{baseSize:25,score:50},[Y.LITTLE]:{baseSize:15,score:100}};var Q={small:"./images/bront.png",medium:"./images/steg.png",large:"./images/trex.png"},se={small:null,medium:null,large:null};function Le(e){console.log("Preloading dinosaur images...");let i=0,n=Object.keys(Q).length,s=()=>{console.log("All dinosaur images loaded successfully!"),e&&e()},d=a=>{console.log(`${a} dinosaur image loaded.`),i++,i===n&&s()},l=(a,f)=>{console.error(`Error loading ${a} dinosaur image:`,f),i++,i===n&&s()};Object.entries(Q).forEach(([a,f])=>{let g=new Image;g.onload=()=>d(a),g.onerror=I=>l(a,I),g.src=f,se[a]=g})}function ee(e){if(!e||e.length===0)return"";let i=`M ${e[0].x} ${e[0].y}`;for(let n=1;n<e.length;n++)i+=` L ${e[n].x} ${e[n].y}`;return i+=" Z",i}var Ye={small:`<svg viewBox="-1.1 -0.9 2.2 1.8" width="2.2" height="1.8">
              <path fill="none" stroke="currentColor" stroke-width="0.1" stroke-linecap="round" stroke-linejoin="round"
                    d="${ee([{x:.8,y:-.6},{x:1,y:-.4},{x:.9,y:0},{x:.5,y:.3},{x:.2,y:.8},{x:-.5,y:.7},{x:-1,y:.5},{x:-.8,y:0},{x:-.9,y:-.3},{x:-.4,y:-.6},{x:0,y:-.7},{x:.3,y:-.6},{x:.6,y:-.8}])}" />
            </svg>`,large:`<svg viewBox="-1.1 -0.9 2.1 1.9" width="2.1" height="1.9">
               <path fill="none" stroke="currentColor" stroke-width="0.1" stroke-linecap="round" stroke-linejoin="round"
                     d="${ee([{x:.5,y:-.9},{x:.9,y:-.7},{x:.6,y:-.2},{x:.9,y:.1},{x:.5,y:.3},{x:.4,y:.8},{x:-.3,y:.9},{x:-.8,y:.6},{x:-1,y:0},{x:-.8,y:-.3},{x:-.9,y:-.6},{x:-.7,y:-.7},{x:-.3,y:-.8},{x:.2,y:-.3},{x:.3,y:-.5},{x:.1,y:-.8}])}" />
            </svg>`,medium:`<svg width="3.999" height="1.267" viewBox="0 0 3.999 1.267" xmlns="http://www.w3.org/2000/svg">
                <path fill="none" stroke="currentColor" stroke-width="0.015" stroke-linecap="round" stroke-linejoin="round"
                      d="m2.197 0-.064.04-.02.026-.06.093-.07.023-.2-.039-.033.004-.07.034-.186.08-.338.125-.098.085-.026.043L.82.61.598.705.453.75.341.761.2.776.01.79 0 .793l.04.023.249.068.284.049.214-.015.142-.01.24-.018.054-.008.05.01.025.044.015.077-.045.109-.037.1.045.042.37.001h.023l.03-.037-.02-.032-.01-.018-.01-.05.123-.106.019.037.022.056.042.104.052.048.345-.002.05-.007-.056-.098-.058-.118.038-.037h.25l.04-.008.03.052.078.128.126.064.223-.011h.104l.04-.008-.19-.2-.037-.044.032-.084.049-.029.178-.01.023-.004.152-.016.217.037.15.047.1-.018.01-.008.11-.139.002-.015L3.86.662 3.758.6l.24-.214-.105.01-.28.073-.062.003.17-.317-.045.004-.132.065-.193.09-.074.032-.031-.061-.17-.117-.167-.09L2.8.03 2.534.017l-.282-.01L2.24.004zm-.022.024.184.02.059.005.16.009h.056l.164.01.092.044.083.044.21.124.047.077.065.023.183-.086.135-.058-.025.073-.08.149.012.067.362-.094-.02.024-.132.112.035.087.118.112-.002.01-.12.14-.012.005-.138-.043L3.378.82l-.12.014-.026.005-.258.023-.068.03-.043.099.02.054.06.066.084.09.007.021-.123.003h-.18l-.042-.017-.063-.12-.07-.105-.064-.012-.047.004h-.252l-.043.029.062.157.02.054-.032.02h-.249l-.043-.035-.08-.183L1.8.964 1.76.986l-.105.087-.054.048.013.046.012.021-.046.038h-.3l.017-.055.058-.13-.021-.132-.008-.012L1.3.854h-.106l-.07.008-.226.02H.894l-.258.02L.34.864.188.819.176.81l.078-.01.235-.025.135-.039L.9.616l.155-.067.04-.054.1-.084.348-.13.21-.093.06-.006.198.037.06-.016.102-.154z" />
             </svg>`},o={x:r.width/2,y:r.height/2,angle:-Math.PI/2,speed:0,rotationSpeed:pe,acceleration:L,friction:Se,size:xe,canShoot:!0,lastShotTime:0,isInvulnerable:!1},c=[],h=[],w=0,v=3,T=1,$=!0;var m=!1,x=!1,u=null,y=null,V=!1,b=0,G=class{constructor(i,n,s){this.sizeType=i,this.x=n,this.y=s,this.radius=ne[this.sizeType],this.size=this.radius,this.speed=Math.random()*(F[P][this.sizeType].max-F[P][this.sizeType].min)+F[P][this.sizeType].min,this.angle=Math.random()*k,this.rotation=Math.random()*k,this.rotationSpeed=(Math.random()-.5)*.05,this.image=se[this.sizeType],this.image||console.error(`Image for ${this.sizeType} asteroid not loaded!`)}draw(){if(this.x+this.radius<0||this.x-this.radius>r.width||this.y+this.radius<0||this.y-this.radius>r.height)return;t.save(),t.translate(this.x,this.y),t.rotate(this.rotation);let i=this.radius*2/Math.max(this.image?.width||100,this.image?.height||100);this.image&&this.image.complete?t.drawImage(this.image,-this.image.width*i/2,-this.image.height*i/2,this.image.width*i,this.image.height*i):(t.beginPath(),t.arc(0,0,this.radius,0,k),t.strokeStyle="gray",t.lineWidth=1,t.stroke()),t.restore()}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.rotation+=this.rotationSpeed,W(this)}},H=class{constructor(i,n,s){this.x=i,this.y=n,this.angle=s,this.speed=Ae,this.radius=Te,this.size=this.radius,this.lifespan=ve}draw(){this.x<-this.radius||this.x>r.width+this.radius||this.y<-this.radius||this.y>r.height+this.radius||(t.beginPath(),t.arc(this.x,this.y,this.radius,0,k),t.fillStyle="white",t.fill())}update(){return this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.lifespan--,this.lifespan>0&&this.x>=-this.radius&&this.x<=r.width+this.radius&&this.y>=-this.radius&&this.y<=r.height+this.radius}},E={};document.addEventListener("keydown",e=>{if(E[e.key]=!0,e.key==="?"&&(m=!m,e.preventDefault()),!x&&!m){let i=e.key.toLowerCase(),n=null;i==="e"?n="easy":i==="m"?n="medium":i==="d"&&(n="difficult"),n&&($e(n),Re(),e.preventDefault())}e.key==="Escape"&&x&&!m&&($&&ae(),e.preventDefault())});document.addEventListener("keyup",e=>{E[e.key]=!1});function W(e){let i=typeof e.radius<"u"?e.radius:e.size;e.x<-i&&(e.x=r.width+i),e.x>r.width+i&&(e.x=-i),e.y<-i&&(e.y=r.height+i),e.y>r.height+i&&(e.y=-i)}function q(e="large",i=null,n=null){let s=ne[e],d=o.size+s+100;if(i===null||n===null){let a=0;do i=s+Math.random()*(r.width-2*s),n=s+Math.random()*(r.height-2*s),a++;while(a<50&&Math.sqrt(Math.pow(i-o.x,2)+Math.pow(n-o.y,2))<d);a>=50&&console.warn("Could not find a safe spawn location far from the player after 50 attempts. Spawning anyway."),console.log(`Spawning ${e} asteroid randomly inside canvas at (${i.toFixed(1)}, ${n.toFixed(1)})`)}else console.log(`Spawning split ${e} asteroid at provided location (${i.toFixed(1)}, ${n.toFixed(1)})`);let l=new G(e,i,n);h.push(l),console.log(`Asteroids array length: ${h.length}`)}function te(e,i){let n=e.x-i.x,s=e.y-i.y,d=Math.sqrt(n*n+s*s),l=typeof e.radius<"u"?e.radius:e.size,a=typeof i.radius<"u"?i.radius:i.size;return d<l+a}async function ae(){$=!1;let e=w;await U();let i=!1;u&&!y?u.length<oe?i=e>0:i=e>u[u.length-1].score:y&&console.error("Cannot check leaderboard qualification due to fetch error.");let n=null,s=!1,d=null;if(i){for(;;){if(n=prompt(`You made the leaderboard! Score: ${e}
Enter your initials (1-3 characters):`),n===null){n=null;break}if(n=n.trim().toUpperCase(),n.length>0&&n.length<=3)break;alert("Please enter 1 to 3 characters for your initials.")}if(n)try{s=await Pe(n,e),s&&await U()}catch(f){d=f.message}}t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,r.width,r.height),t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";let l=r.width/2,a=r.height/2;t.font="48px Arial",t.fillText("GAME OVER",l,a-150),t.font="30px Arial",t.fillText(`Final Score: ${e}`,l,a-100),t.font="20px Arial",i?n?s?t.fillText("Score submitted to leaderboard!",l,a-60):d?(t.fillText(`Submission Error: ${d}`,l,a-60),t.fillText("Your score was not saved.",l,a-30)):t.fillText("Score qualified, but was not submitted.",l,a-60):t.fillText("You qualified, but did not enter initials.",l,a-60):y?t.fillText("Could not check leaderboard ranking.",l,a-60):t.fillText("Better luck next time!",l,a-60),t.font="20px Arial",t.fillText("Returning to Title Screen...",l,a+150),setTimeout(()=>{de()},3e3)}async function Pe(e,i){console.log(`Submitting score: ${e} - ${i}`);try{let n=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:e,score:i})});if(!n.ok){let d=await n.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${n.status} ${d.message||""}`)}let s=await n.json();return console.log("Submission result:",s.message),!0}catch(n){throw console.error("Error submitting score:",n),n}}async function M(e){if(m){le(),requestAnimationFrame(M);return}if(!x){X(),requestAnimationFrame(M);return}if(t.clearRect(0,0,r.width,r.height),t.fillStyle="black",t.fillRect(0,0,r.width,r.height),E.ArrowUp?o.speed+=o.acceleration:o.speed*=o.friction,E[" "]&&o.canShoot){let n=o.x+Math.cos(o.angle)*o.size,s=o.y+Math.sin(o.angle)*o.size;c.push(new H(n,s,o.angle)),o.canShoot=!1,o.lastShotTime=e}!o.canShoot&&e-o.lastShotTime>re&&(o.canShoot=!0),o.x+=Math.cos(o.angle)*o.speed,o.y+=Math.sin(o.angle)*o.speed,W(o);for(let n=c.length-1;n>=0;n--)c[n].update()||c.splice(n,1);ze(),t.fillStyle="white",t.font="20px Arial",t.textBaseline="top",t.textAlign="left",t.fillText("Level: "+T,10,10),t.textAlign="center",t.fillText("Score: "+w,r.width/2,10),t.textAlign="right",t.fillText("Lives: "+v,r.width-10,10),Me();for(let n of c)n.draw();let i=[];for(let n of h)i.push(n.draw());try{await Promise.all(i)}catch(n){console.error("Error during asteroid drawing batch:",n)}requestAnimationFrame(M)}function Me(){t.save(),t.translate(o.x,o.y),t.rotate(o.angle),t.beginPath(),t.moveTo(o.size,0),t.lineTo(-o.size*.7,o.size*.7),t.lineTo(-o.size*.4,0),t.lineTo(-o.size*.7,-o.size*.7),t.closePath(),t.strokeStyle="cyan",t.lineWidth=2,t.stroke(),E.ArrowUp&&(t.beginPath(),t.moveTo(-o.size*.5,0),t.lineTo(-o.size*.9,o.size*.4),t.lineTo(-o.size*1.2,0),t.lineTo(-o.size*.9,-o.size*.4),t.closePath(),t.fillStyle="orange",t.fill()),t.restore()}function le(){t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,r.width,r.height),t.fillStyle="white",t.font="32px Arial",t.textAlign="center",t.textBaseline="middle";let e=r.width/2,i=r.height/2-100,n=40;t.fillText("Controls",e,i),t.font="20px Arial",t.fillText("Arrow Left: Rotate Left",e,i+n*1.5),t.fillText("Arrow Right: Rotate Right",e,i+n*2.5),t.fillText("Arrow Up: Thrust",e,i+n*3.5),t.fillText("Spacebar: Shoot",e,i+n*4.5),t.fillText("?: Toggle Help / Pause",e,i+n*5.5),t.fillText("Esc: End Game",e,i+n*6.5),t.font="24px Arial",t.fillText("Press ? to close",e,i+n*8.5)}async function U(){V=!0,y=null;try{let e=await fetch("/api/leaderboard");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);u=await e.json()}catch(e){console.error("Failed to fetch leaderboard:",e),y=e.message}finally{V=!1}}function X(){t.clearRect(0,0,r.width,r.height),t.fillStyle="black",t.fillRect(0,0,r.width,r.height),t.fillStyle="white",t.textAlign="center";let e=r.width/2,i=r.height*.15;t.font="84px Arial",t.textBaseline="middle",t.fillText("DINOSTROIDS",e,i);let n=i+100,s=n+40,d=25;t.font="32px Arial",t.fillText("TOP SCORES",e,n),t.font="16px Arial",t.textBaseline="top";let l=s;if(V)t.fillText("Loading...",e,s),l+=d;else if(y)t.fillText(`Error loading scores: ${y}`,e,s),l+=d;else if(u&&u.length>0){let f=e-180,g=e-100,I=e+50,R=e+110,A=s;t.textAlign="left",t.fillText("Rank",f,A),t.fillText("Initials",g,A),t.textAlign="right",t.fillText("Score",I+40,A),t.textAlign="left",t.fillText("Date",R,A),t.font="14px Arial",u.forEach((z,D)=>{if(D>=oe)return;let S=A+d*(D+1.5);t.textAlign="left",t.fillText(`${D+1}.`,f,S),t.fillText(z.initials,g,S),t.textAlign="right",t.fillText(z.score.toLocaleString(),I+40,S),t.textAlign="left";try{let O=new Date(z.createdAt),he=`${O.toLocaleDateString()} ${O.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;t.fillText(he,R,S)}catch{t.fillText("Invalid Date",R,S)}l=S+d})}else t.fillText("No scores yet! Be the first!",e,s),l+=d;let a=l+60;t.textAlign="center",t.font="28px Arial",t.fillText("Start Game:",e,a),t.font="24px Arial",t.fillText("E)asy   M)edium   D)ifficult",e,a+40),t.font="20px Arial",t.textBaseline="bottom",t.fillText("? for Help",e,r.height-50),t.font="16px Arial",t.fillText("(c) Intensity Ventures, 2025",e,r.height-20)}function $e(e){P=e;let i=p[e];Ee=i.playerAcceleration,re=i.shootCooldown,Ie=i.asteroidMinSpeed,be=i.asteroidSpeedVariation,ke=i.initialAsteroidCountBase,K=i.lives,v=K,console.log(`Difficulty set to: ${e}`)}function Re(){x||(x=!0,$=!0,w=0,T=1,fetch("/api/incrementGamesPlayed",{method:"POST"}).then(e=>{e.ok?console.log("Successfully triggered server-side games played increment."):console.error("Failed to increment games played count on server.")}).catch(e=>{console.error("Network error trying to increment games played count:",e)}),o.x=r.width/2,o.y=r.height/2,o.speed=0,o.angle=-Math.PI/2,c=[],h=[],ce())}function de(){console.log("Initializing game..."),r.width=window.innerWidth,r.height=window.innerHeight,window.addEventListener("resize",_e),Le(()=>{console.log("Images loaded, initializing game..."),Ce(),U(),w=0,v=3,T=1,x=!1,m=!1,o.x=r.width/2,o.y=r.height/2,o.speed=0,o.angle=-Math.PI/2,c=[],h=[],X()})}function ce(){h=[],c=[];let e=5+T*2;console.log(`Level ${T}: Spawning ${e} asteroids.`);for(let i=0;i<e;i++)q("large");o.isInvulnerable=!0,setTimeout(()=>{o.isInvulnerable=!1},ie)}window.addEventListener("resize",()=>{r.width=window.innerWidth,r.height=window.innerHeight,o&&(o.x>r.width+o.size&&(o.x=r.width/2),o.y>r.height+o.size&&(o.y=r.height/2))});de();requestAnimationFrame(M);function ze(){for(let e=h.length-1;e>=0;e--){let i=h[e],n=!1;$&&!o.isInvulnerable&&te(o,i)&&Oe();for(let s=c.length-1;s>=0;s--){let d=c[s];if(te(d,i)){c.splice(s,1),De(i,e),n=!0;break}}n||(i.update(),W(i))}}function De(e,i){switch(h.splice(i,1),e.sizeType){case"large":w+=20;for(let n=0;n<2;n++)q("medium",e.x,e.y);break;case"medium":w+=50;for(let n=0;n<2;n++)q("small",e.x,e.y);break;case"small":w+=100;break}h.length===0&&(T++,ce())}function Oe(){if(!o.isInvulnerable){if(v--,v<=0){ae();return}o.x=r.width/2,o.y=r.height/2,o.speed=0,o.angle=-Math.PI/2,o.isInvulnerable=!0,setTimeout(()=>{o.isInvulnerable=!1},ie)}}async function Ce(){console.log("Fetching global games played count...");try{let e=await fetch("/api/gamesPlayed");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let i=await e.json();typeof i.count=="number"?(b=i.count,console.log(`Global games played count: ${b}`)):(console.warn("Received invalid count from API."),b=0)}catch(e){console.error("Failed to fetch games played count:",e),b=0}}function _e(){console.log("Resizing canvas to fit window..."),r.width=window.innerWidth,r.height=window.innerHeight,x?m&&le():X()}
