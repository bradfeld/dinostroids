var ze="@vercel/analytics",Ve="1.5.0",Ke=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function he(){return typeof window<"u"}function ue(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function We(e="auto"){if(e==="auto"){window.vam=ue();return}window.vam=e}function qe(){return(he()?window.vam:ue())||"production"}function Z(){return qe()==="development"}function Ze(e){return e.scriptSrc?e.scriptSrc:Z()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function me(e={debug:!0}){var t;if(!he())return;We(e.mode),Ke(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));let o=Ze(e);if(document.head.querySelector(`script[src*="${o}"]`))return;let i=document.createElement("script");i.src=o,i.defer=!0,i.dataset.sdkn=ze+(e.framework?`/${e.framework}`:""),i.dataset.sdkv=Ve,e.disableAutoTrack&&(i.dataset.disableAutoTrack="1"),e.endpoint?i.dataset.endpoint=e.endpoint:e.basePath&&(i.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(i.dataset.dsn=e.dsn),i.onerror=()=>{let r=Z()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${o}. ${r}`)},Z()&&e.debug===!1&&(i.dataset.debug="false"),document.head.appendChild(i)}var p,O;function ge(){return p=document.getElementById("gameCanvas"),O=p.getContext("2d"),j(),{canvas:p,ctx:O}}function C(){return{canvas:p,ctx:O}}function j(){p&&(console.log("Resizing canvas to fit window..."),p.width=window.innerWidth,p.height=window.innerHeight)}function F(e="black"){!O||!p||(O.clearRect(0,0,p.width,p.height),O.fillStyle=e,O.fillRect(0,0,p.width,p.height))}function h(){return p?{width:p.width,height:p.height}:{width:0,height:0}}async function pe(){console.log("Fetching global games played count...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/gamesPlayed",{signal:e.signal,cache:"no-store"});if(clearTimeout(t),!o.ok)throw console.warn(`API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return typeof i.count=="number"?(console.log(`Global games played count: ${i.count}`),i.count):(console.warn("Received invalid count from API."),50)}catch(e){return e.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",e),console.log("Using fallback games played count: 50"),50}}async function Se(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:e.signal,cache:"no-store"});return clearTimeout(t),o.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${o.status}`),!1)}catch(e){return e.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",e),!1}}async function J(){console.log("Fetching leaderboard data...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),o=await fetch("/api/leaderboard",{signal:e.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(t),!o.ok)throw console.warn(`Leaderboard API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return console.log("Leaderboard data received:",i.length?`${i.length} entries`:"Empty array"),i.length>0&&console.log("First entry:",JSON.stringify(i[0])),i}catch(e){return console.error("Failed to fetch leaderboard:",e),[]}finally{console.log("Leaderboard fetch completed")}}async function ye(e,t,o=0,i=1,r="medium"){console.log(`Submitting score: ${t} points, Level ${i}, ${o}ms, ${r} difficulty`);try{let n=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:e,score:t,time:o,level:i,difficulty:r,date:new Date().toISOString()})});if(!n.ok){let l=await n.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${n.status} ${l.message||""}`)}let s=await n.json();return console.log("Submission result:",s.message),!0}catch(n){return console.error("Error submitting score:",n),!1}}var z={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},U={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},Y={RADIUS:2,SPEED:500,LIFESPAN:1e3},D={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var ee={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var ut=Math.PI*2;var mt=.07*3,gt=.18*3;var pt=.6*3,St=1.6*3;var _={easy:{playerAcceleration:.54,shootCooldown:120,asteroidSpeed:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},initialAsteroids:2,lives:5},medium:{playerAcceleration:.81,shootCooldown:84,asteroidSpeed:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},initialAsteroids:3,lives:3},difficult:{playerAcceleration:1.08,shootCooldown:60,asteroidSpeed:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}},initialAsteroids:4,lives:2}},Q={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},yt={[Q.BIG]:{baseSize:45,score:20},[Q.MEDIUM]:{baseSize:25,score:50},[Q.LITTLE]:{baseSize:15,score:100}};var Te={};function Ee(e){return console.log("Preloading dinosaur images..."),new Promise((t,o)=>{let i=0,r=Object.keys(ee).length;if(r===0){console.log("No dinosaur images to load."),e&&e(),t();return}let n=()=>{console.log("All dinosaur images loaded successfully!"),e&&e(),t()},s=a=>{console.log(`${a} dinosaur image loaded.`),i++,i===r&&n()},l=(a,c)=>{console.error(`Error loading ${a} dinosaur image:`,c),i++,i===r&&n()};Object.entries(ee).forEach(([a,c])=>{let f=new Image;f.onload=()=>s(a),f.onerror=d=>l(a,d),f.src=c,Te[a]=f})})}function we(e){return Te[e]||null}var re={},te=null,ie=null,oe=null,X=null;function Ie(){window.addEventListener("keydown",je),window.addEventListener("keyup",Je)}function je(e){re[e.code]=!0,(e.code==="Enter"||e.code==="NumpadEnter")&&te&&te(),(e.key==="?"||e.code==="Slash"&&e.shiftKey)&&ie&&(ie(),e.preventDefault()),e.code==="Escape"&&oe&&oe(),X&&(e.code==="KeyE"?X("easy"):e.code==="KeyM"?X("medium"):e.code==="KeyD"&&X("difficult"))}function Je(e){re[e.code]=!1}function B(e){return re[e]===!0}function Ae(e){te=e}function ve(e){ie=e}function Le(e){oe=e}function Re(e){X=e}var ne=class{constructor(t="medium"){let{width:o,height:i}=h();this.x=o/2,this.y=i/2,this.radius=U.RADIUS;let r=_[t];this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=U.ROTATION_SPEED,this.acceleration=r.playerAcceleration,this.friction=U.FRICTION,this.canShoot=!0,this.shootCooldown=r.shootCooldown,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0}update(t){if(this.isDestroyed)return null;if(this.invincible&&(this.invincibilityTime-=t,this.invincibilityTime<=0&&(this.invincible=!1)),B("ArrowLeft")&&(this.rotation-=this.rotationSpeed*t),B("ArrowRight")&&(this.rotation+=this.rotationSpeed*t),this.isThrusting=B("ArrowUp"),this.isThrusting){let n=Math.cos(this.rotation)*this.acceleration*t,s=Math.sin(this.rotation)*this.acceleration*t;this.velocityX+=n,this.velocityY+=s}this.velocityX*=1-this.friction*t,this.velocityY*=1-this.friction*t,this.x+=this.velocityX,this.y+=this.velocityY;let{width:o,height:i}=h();this.x<0&&(this.x=o),this.x>o&&(this.x=0),this.y<0&&(this.y=i),this.y>i&&(this.y=0);let r=null;if(B("Space")&&this.canShoot&&!this.isDestroyed){let n=Date.now();n-this.lastShot>this.shootCooldown&&(r={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=n)}return r}setShootCooldown(t){this.shootCooldown=t}setAcceleration(t){this.acceleration=t}draw(t){if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(this.radius,0),t.lineTo(-this.radius*.7,-this.radius*.7),t.lineTo(-this.radius*.5,0),t.lineTo(-this.radius*.7,this.radius*.7),t.closePath(),t.stroke(),this.isThrusting){t.beginPath(),t.moveTo(-this.radius*.5,0),t.lineTo(-this.radius*1.5,0);let o=Math.random()*.5+.5;t.lineTo(-this.radius*(1+o),.5*this.radius*o),t.lineTo(-this.radius*.5,0),t.fillStyle="orange",t.fill()}t.restore()}}destroy(){this.isDestroyed=!0}reset(){let{width:t,height:o}=h();this.x=t/2,this.y=o/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.invincible=!0,this.invincibilityTime=U.INVINCIBILITY_TIME}isCollidingWith(t){if(this.isDestroyed||this.invincible)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}},xe=ne;function De(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function T(e,t){return Math.random()*(t-e)+e}var se=class e{constructor(t,o,i,r,n="medium"){let{width:s,height:l}=h();this.type=t||this.getRandomType(),this.size=o||1,this.difficulty=n,this.radius=D.BASE_RADIUS/this.size,this.x=i!==void 0?i:T(0,s),this.y=r!==void 0?r:T(0,l);let a=this.getSizeCategory(),c=_[n].asteroidSpeed[a],f=T(c.min,c.max);this.velocityX=T(-1,1)*f,this.velocityY=T(-1,1)*f,this.rotation=0,this.rotationSpeed=T(-1,1)*D.ROTATION_SPEED;let d=this.getImageKey();this.image=we(d),this.points=D.POINTS_BASE*this.size}getSizeCategory(){switch(this.size){case 1:return"large";case 2:return"medium";case 3:return"small";default:return"large"}}getRandomType(){let t=["bront","steg","trex"];return t[De(0,t.length-1)]}getImageKey(){return this.type}update(t){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*t;let{width:o,height:i}=h();this.x<-this.radius&&(this.x=o+this.radius),this.x>o+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=i+this.radius),this.y>i+this.radius&&(this.y=-this.radius)}draw(t){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),this.image){let o=this.radius*2/Math.max(this.image.width,this.image.height),i=this.image.width*o,r=this.image.height*o;t.drawImage(this.image,-i/2,-r/2,i,r)}else t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.strokeStyle="gray",t.stroke();t.restore()}break(){if(this.size>=3)return[];let t=this.size+1,o=[];for(let i=0;i<2;i++){let r=T(-10,10),n=T(-10,10),s=new e(this.type,t,this.x+r,this.y+n,this.difficulty),l=s.getSizeCategory(),a=_[this.difficulty].asteroidSpeed[l],c=T(a.min,a.max),f=this.velocityX+T(-1,1),d=this.velocityY+T(-1,1),I=Math.sqrt(f*f+d*d);s.velocityX=f/I*c,s.velocityY=d/I*c,o.push(s)}return o}isCollidingWith(t){let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}},Pe=se;var ae=class{constructor(t,o,i){this.x=t,this.y=o,this.angle=i,this.velocityX=Math.cos(i)*Y.SPEED,this.velocityY=Math.sin(i)*Y.SPEED,this.radius=Y.RADIUS,this.lifespan=Y.LIFESPAN,this.active=!0}update(t){if(!this.active)return!1;if(this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.lifespan-=t*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:o,height:i}=h();return this.x<-this.radius||this.x>o+this.radius||this.y<-this.radius||this.y>i+this.radius?(this.active=!1,!1):!0}draw(t){this.active&&(t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="white",t.fill())}isCollidingWith(t){if(!this.active)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}deactivate(){this.active=!1}},be=ae;function Ne(e,t,o,i,r){let{width:n,height:s}=h();e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${t}`,20,30),e.textAlign="center",e.fillText(`Level: ${i}`,n/2,30),Qe(e,o,n-20,30)}function Qe(e,t,o,i){for(let r=0;r<t;r++)et(e,o-r*25,i-5,10)}function et(e,t,o,i){e.save(),e.translate(t,o),e.rotate(-Math.PI/2),e.strokeStyle="white",e.lineWidth=1.5,e.beginPath(),e.moveTo(i,0),e.lineTo(-i*.7,-i*.7),e.lineTo(-i*.4,0),e.lineTo(-i*.7,i*.7),e.closePath(),e.stroke(),e.restore()}var y=["","",""],m=0,$=!1,le=null,ce=null;function V(e,t,o=[],i=1,r=0){let{width:n,height:s}=h();F("black"),e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",n/2,s/4);let l=Math.floor(r/6e4),a=Math.floor(r%6e4/1e3),c=`${l}:${a.toString().padStart(2,"0")}`;if(e.font="32px Arial",e.fillText(`Score: ${t}`,n/2,s/4+60),e.font="24px Arial",e.fillText(`Level: ${i}  Time: ${c}`,n/2,s/4+95),tt(t,o)){e.font="24px Arial",e.fillText("New High Score!",n/2,s/4+130),e.fillText("Enter your initials:",n/2,s/4+165);let d=40,I=40,g=s/4+180,A=10;for(let v=0;v<3;v++){let G=n/2-d*1.5-A+v*(d+A);e.strokeStyle=m===v&&$?"#ffff00":"white",e.lineWidth=m===v&&$?3:2,e.strokeRect(G,g,d,I),e.fillStyle="white",e.font="32px Arial",e.textAlign="center";let u=y[v];m===v&&$&&!u?u="_":u||(u=" "),e.fillText(u,G+d/2,g+30)}y[0]&&y[1]&&y[2]&&(e.font="24px Arial",e.fillText("Press ENTER to submit",n/2,g+80))}else e.font="24px Arial",e.fillText("Press RETURN to return to start screen",n/2,s/2+50)}function tt(e,t){if(!t||t.length===0||t.length<20)return!0;let o=[...t].sort((i,r)=>r.score-i.score);return e>o[19].score}function Oe(e){$?e.key.length===1&&/[A-Za-z]/.test(e.key)?(y[m]=e.key.toUpperCase(),m<2&&m++):e.key==="Backspace"?(y[m]="",m>0&&!y[m]&&m--):e.key==="Enter"&&y[0]&&y[1]&&y[2]?(le&&le(y.join("")),it()):e.key==="ArrowLeft"?m>0&&m--:e.key==="ArrowRight"&&m<2&&m++:(e.code==="Enter"||e.code==="NumpadEnter")&&ce&&ce()}function it(){y=["","",""],m=0,$=!1}function _e(){y=["","",""],m=0,$=!0}function Me(e){le=e}function Ce(e){ce=e}function ot(e,t,o,i,r,n){let{rankX:s,scoreX:l,levelX:a,initialsX:c,dateX:f,timeX:d}=n;e.font="16px Arial";for(let I=0;I<o;I++){let g=t[I];if(!g)continue;let A=r+85+I*30;g.isCurrent&&(e.fillStyle="rgba(255, 255, 0, 0.3)",e.fillRect(i-240,A-15,480,20),e.fillStyle="white"),e.textAlign="center",e.fillText(`${I+1}`,s,A),e.fillText(`${g.score}`,l,A),e.fillText(`${g.level||"1"}`,a,A),e.fillText(`${g.initials||"???"}`,c,A);let v="--/--/--";if(g.date)try{let u=new Date(g.date);isNaN(u.getTime())||(v=`${(u.getMonth()+1).toString().padStart(2,"0")}/${u.getDate().toString().padStart(2,"0")}/${u.getFullYear().toString().substr(2)}`)}catch(u){console.error("Error parsing date:",u)}e.fillText(v,f,A);let G="--:--";if(g.time&&!isNaN(g.time))try{let u=Math.floor(g.time/6e4),He=Math.floor(g.time%6e4/1e3);G=`${u}:${He.toString().padStart(2,"0")}`}catch(u){console.error("Error formatting time:",u)}e.fillText(G,d,A)}}function $e(e,t,o,i){let r=[...o].sort((l,a)=>a.score-l.score).slice(0,20),n=Math.min(r.length,20,Math.floor((i.canvas.height-t-50)/30));i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(e-250,t,500,n*30+60),i.fillStyle="white",i.font="bold 24px Arial",i.textAlign="center",i.fillText("LEADERBOARD",e,t+30);let s={rankX:e-220,scoreX:e-160,levelX:e-80,initialsX:e,dateX:e+100,timeX:e+190};rt(i,t,s),i.strokeStyle="rgba(255, 255, 255, 0.5)",i.beginPath(),i.moveTo(e-240,t+60),i.lineTo(e+240,t+60),i.stroke(),ot(i,r,n,e,t,s),o.length>n&&(i.textAlign="center",i.font="14px Arial",i.fillText(`Showing ${n} of ${o.length} scores`,e,t+n*30+45))}function rt(e,t,o){let{rankX:i,scoreX:r,levelX:n,initialsX:s,dateX:l,timeX:a}=o;e.font="14px Arial",e.textAlign="center",e.fillStyle="white",e.fillText("RANK",i,t+55),e.fillText("SCORE",r,t+55),e.fillText("LEVEL",n,t+55),e.fillText("PLAYER",s,t+55),e.fillText("DATE",l,t+55),e.fillText("TIME",a,t+55)}function ke(e,t,o=[],i=0){let{width:r,height:n}=h();e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("DINOSTROIDS",r/2,n/3),e.font="24px Arial",e.fillText("Select Difficulty:",r/2,n/2-30);let s=[{key:"E",label:"Easy",value:"easy"},{key:"M",label:"Medium",value:"medium"},{key:"D",label:"Difficult",value:"difficult"}],l=n/2+30;s.forEach((a,c)=>{let f=r/2-150+c*150,d=t===a.value;d&&(e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(f-65,l-30,130,40)),e.fillStyle=d?"#ffff00":"white",e.fillText(`${a.key}: ${a.label}`,f,l)}),e.fillStyle="white",e.font="24px Arial",e.fillText("Press RETURN to start",r/2,n*2/3+20),e.fillText("Press ? for help",r/2,n*2/3+60),i>0&&(e.font="16px Arial",e.fillText(`Games Played: ${i}`,r/2,n-80)),e.font="14px Arial",e.fillText("\xA9 Intensity Ventures, 2025",r/2,n-20),o&&o.length>0&&$e(r-200,50,o,e)}var W=!1,R=!1,w=!1,k=!1,nt=!1,fe=0,P=0,K=z.INITIAL_LIVES,b=1,Fe=0,L=[],q=0;var N="medium",S=null,E=[],M=[],x=null;function H(){let{ctx:e}=C();F("black"),ke(e,N,L,Fe)}function st(){console.log("Game ended by user (ESC key)"),R=!1,w=!0,W=!1,x&&(cancelAnimationFrame(x),x=null),Xe()}function Ue(){let{ctx:e,width:t,height:o}=C();e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,t,o),e.fillStyle="white",e.font="bold 36px Arial",e.textAlign="center",e.fillText("HOW TO PLAY",t/2,80);let i=["","CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 ?: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible","","DIFFICULTY:","\u2022 Press E: Easy mode","\u2022 Press M: Medium mode","\u2022 Press D: Difficult mode","","START GAME:","\u2022 Press RETURN to begin"];e.font="18px Arial",e.textAlign="left";let r=130,n=24;i.forEach((s,l)=>{e.fillText(s,t/2-180,r+l*n)}),e.textAlign="center",e.font="20px Arial",e.fillText("Press ? to return",t/2,o-50)}function at(){Ae(()=>{!k&&!R&&!w?Ge():w&&(w=!1,Ge())}),ve(ct),Le(()=>{R&&!w&&st()}),Re(e=>{(!R||w)&&(N=e,H())})}function Ge(){if(k||R||w)return;console.log(`Starting game with ${N} difficulty...`),R=!0,w=!1,W=!0,P=0,q=0;let e=_[N];K=e.lives,b=1,S=new xe(N),Ye(e.initialAsteroids),M=[],Se().catch(t=>console.error("Failed to increment games played:",t)),fe=performance.now(),x=requestAnimationFrame(de)}function Ye(e){let{width:t,height:o}=h();E=[];for(let i=0;i<e;i++){let r,n,s;do{r=Math.random()*t,n=Math.random()*o;let a=S?S.x-r:t/2-r,c=S?S.y-n:o/2-n;s=Math.sqrt(a*a+c*c)}while(s<D.SPAWN_DISTANCE_MIN);let l=new Pe(null,1,r,n,N);E.push(l)}}function de(e){let t=(e-fe)/1e3;if(fe=e,nt||!W){x=requestAnimationFrame(de);return}q+=t*1e3,F("black");let{ctx:o,canvas:i}=C();if(S){let r=S.update(t);r&&M.push(new be(r.x,r.y,r.rotation)),S.draw(o)}for(let r=M.length-1;r>=0;r--){let n=M[r];if(!n.update(t)){M.splice(r,1);continue}n.draw(o);for(let s=E.length-1;s>=0;s--){let l=E[s];if(n.isCollidingWith(l)){n.deactivate(),M.splice(r,1);let a=l.break();P+=D.SCORE_VALUES[l.size]||100,E.push(...a),E.splice(s,1);break}}}if(E.forEach(r=>{r.update(t),r.draw(o)}),S&&!S.isDestroyed)for(let r=E.length-1;r>=0;r--){let n=E[r];if(S.isCollidingWith(n)){S.destroy(),K-=D.COLLISION_DAMAGE,K<=0?Xe():setTimeout(()=>{S.reset()},1e3);break}}if(E.length===0&&R&&!w){b++;let r=Math.min(z.INITIAL_ASTEROIDS+(b-1)*z.ASTEROID_INCREMENT_PER_LEVEL,20);Ye(r)}Ne(o,P,K,b,N),x=requestAnimationFrame(de)}function Xe(){console.log("Game over!"),w=!0,W=!1;let e=q;x&&(cancelAnimationFrame(x),x=null),S&&(S=null),E=[],M=[];let{ctx:t}=C();V(t,P,L,b,e),lt()&&(_e(),Me(async i=>{try{await ye(i,P,e,b,N),L=await J(),V(t,P,L,b,e)}catch(r){console.error("Failed to submit score:",r)}})),Ce(()=>{H()}),document.addEventListener("keydown",Oe)}function lt(){if(!L||L.length===0||L.length<20)return!0;let e=[...L].sort((t,o)=>o.score-t.score);return P>e[19].score}function ct(){R||(k=!k,k?Ue():H())}function Be(){console.log("Initializing game...");let{canvas:e}=ge();window.addEventListener("resize",()=>{if(j(),!R)k?Ue():H();else if(w){let{ctx:t}=C();V(t,P,L,b,q)}}),Ie(),at(),Ee(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{Fe=await pe()}catch(t){console.error("Failed to fetch games played:",t)}})(),(async()=>{try{L=await J()}catch(t){console.error("Failed to fetch leaderboard:",t)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),H()})})}me();document.addEventListener("DOMContentLoaded",()=>{Be()});
