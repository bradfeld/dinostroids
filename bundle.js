var Nt="@vercel/analytics",Dt="1.5.0",Mt=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function nt(){return typeof window<"u"}function st(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function Ct(t="auto"){if(t==="auto"){window.vam=st();return}window.vam=t}function kt(){return(nt()?window.vam:st())||"production"}function k(){return kt()==="development"}function Gt(t){return t.scriptSrc?t.scriptSrc:k()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function at(t={debug:!0}){var e;if(!nt())return;Ct(t.mode),Mt(),t.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",t.beforeSend));let o=Gt(t);if(document.head.querySelector(`script[src*="${o}"]`))return;let i=document.createElement("script");i.src=o,i.defer=!0,i.dataset.sdkn=Nt+(t.framework?`/${t.framework}`:""),i.dataset.sdkv=Dt,t.disableAutoTrack&&(i.dataset.disableAutoTrack="1"),t.endpoint?i.dataset.endpoint=t.endpoint:t.basePath&&(i.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(i.dataset.dsn=t.dsn),i.onerror=()=>{let r=k()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${o}. ${r}`)},k()&&t.debug===!1&&(i.dataset.debug="false"),document.head.appendChild(i)}var c,I;function lt(){return c=document.getElementById("gameCanvas"),I=c.getContext("2d"),G(),{canvas:c,ctx:I}}function T(){return{canvas:c,ctx:I}}function G(){c&&(console.log("Resizing canvas to fit window..."),c.width=window.innerWidth,c.height=window.innerHeight)}function w(t="black"){!I||!c||(I.clearRect(0,0,c.width,c.height),I.fillStyle=t,I.fillRect(0,0,c.width,c.height))}function h(){return c?{width:c.width,height:c.height}:{width:0,height:0}}async function ct(){console.log("Fetching global games played count...");try{let t=new AbortController,e=setTimeout(()=>t.abort(),3e3),o=await fetch("/api/gamesPlayed",{signal:t.signal,cache:"no-store"});if(clearTimeout(e),!o.ok)throw console.warn(`API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return typeof i.count=="number"?(console.log(`Global games played count: ${i.count}`),i.count):(console.warn("Received invalid count from API."),50)}catch(t){return t.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",t),console.log("Using fallback games played count: 50"),50}}async function ht(){try{let t=new AbortController,e=setTimeout(()=>t.abort(),3e3),o=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:t.signal,cache:"no-store"});return clearTimeout(e),o.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${o.status}`),!1)}catch(t){return t.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",t),!1}}async function $(){console.log("Fetching leaderboard data...");try{let t=new AbortController,e=setTimeout(()=>t.abort(),5e3),o=await fetch("/api/leaderboard",{signal:t.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(e),!o.ok)throw console.warn(`Leaderboard API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return console.log("Leaderboard data received:",i.length?`${i.length} entries`:"Empty array"),i.length>0&&console.log("First entry:",JSON.stringify(i[0])),i}catch(t){return console.error("Failed to fetch leaderboard:",t),[]}finally{console.log("Leaderboard fetch completed")}}async function dt(t,e){console.log(`Submitting score: ${t} - ${e}`);try{let o=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:e})});if(!o.ok){let r=await o.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${o.status} ${r.message||""}`)}let i=await o.json();return console.log("Submission result:",i.message),!0}catch(o){throw console.error("Error submitting score:",o),o}}var A={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},y={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},x={RADIUS:2,SPEED:500,LIFESPAN:1e3},p={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var V={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var Jt=Math.PI*2;var Qt=.07*3,F=.18*3;var H=120,B=.6*3,U=1.6*3;var te={easy:{playerAcceleration:F,shootCooldown:H,asteroidMinSpeed:B,asteroidSpeedVariation:U,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:F*1.5,shootCooldown:Math.floor(H*.7),asteroidMinSpeed:B*1.5,asteroidSpeedVariation:U*1.2,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:F*2,shootCooldown:Math.floor(H*.5),asteroidMinSpeed:B*2,asteroidSpeedVariation:U*1.5,initialAsteroidCountBase:4,lives:2}},Y={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},ee={[Y.BIG]:{baseSize:45,score:20},[Y.MEDIUM]:{baseSize:25,score:50},[Y.LITTLE]:{baseSize:15,score:100}};var ut={};function ft(t){console.log("Preloading dinosaur images...");let e=0,o=Object.keys(V).length,i=()=>{console.log("All dinosaur images loaded successfully!"),t&&t()},r=n=>{console.log(`${n} dinosaur image loaded.`),e++,e===o&&i()},s=(n,a)=>{console.error(`Error loading ${n} dinosaur image:`,a),e++,e===o&&i()};Object.entries(V).forEach(([n,a])=>{let l=new Image;l.onload=()=>r(n),l.onerror=u=>s(n,u),l.src=a,ut[n]=l})}function mt(t){return ut[t]||null}var z={},W=null,X=null;function gt(){window.addEventListener("keydown",$t),window.addEventListener("keyup",Ft)}function $t(t){z[t.code]=!0,t.code==="Space"&&W&&W(),(t.code==="KeyH"||t.key==="h")&&X&&X()}function Ft(t){z[t.code]=!1}function _(t){return z[t]===!0}function pt(t){W=t}function St(t){X=t}var K=class{constructor(){let{width:e,height:o}=h();this.x=e/2,this.y=o/2,this.radius=y.RADIUS,this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=y.ROTATION_SPEED,this.acceleration=y.ACCELERATION,this.friction=y.FRICTION,this.canShoot=!0,this.shootCooldown=y.SHOOT_COOLDOWN,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0}update(e){if(this.isDestroyed)return null;if(this.invincible&&(this.invincibilityTime-=e,this.invincibilityTime<=0&&(this.invincible=!1)),_("ArrowLeft")&&(this.rotation-=this.rotationSpeed*e),_("ArrowRight")&&(this.rotation+=this.rotationSpeed*e),this.isThrusting=_("ArrowUp"),this.isThrusting){let s=Math.cos(this.rotation)*this.acceleration*e,n=Math.sin(this.rotation)*this.acceleration*e;this.velocityX+=s,this.velocityY+=n}this.velocityX*=1-this.friction*e,this.velocityY*=1-this.friction*e,this.x+=this.velocityX,this.y+=this.velocityY;let{width:o,height:i}=h();this.x<0&&(this.x=o),this.x>o&&(this.x=0),this.y<0&&(this.y=i),this.y>i&&(this.y=0);let r=null;if(_("Space")&&this.canShoot&&!this.isDestroyed){let s=Date.now();s-this.lastShot>this.shootCooldown&&(r={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=s)}return r}draw(e){if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.strokeStyle="white",e.lineWidth=2,e.beginPath(),e.moveTo(this.radius,0),e.lineTo(-this.radius*.7,-this.radius*.7),e.lineTo(-this.radius*.5,0),e.lineTo(-this.radius*.7,this.radius*.7),e.closePath(),e.stroke(),this.isThrusting){e.beginPath(),e.moveTo(-this.radius*.5,0),e.lineTo(-this.radius*1.5,0);let o=Math.random()*.5+.5;e.lineTo(-this.radius*(1+o),.5*this.radius*o),e.lineTo(-this.radius*.5,0),e.fillStyle="orange",e.fill()}e.restore()}}destroy(){this.isDestroyed=!0}reset(){let{width:e,height:o}=h();this.x=e/2,this.y=o/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.invincible=!0,this.invincibilityTime=y.INVINCIBILITY_TIME}isCollidingWith(e){if(this.isDestroyed||this.invincible)return!1;let o=this.x-e.x,i=this.y-e.y;return Math.sqrt(o*o+i*i)<this.radius+e.radius}},Et=K;function It(t,e){return Math.floor(Math.random()*(e-t+1))+t}function m(t,e){return Math.random()*(e-t)+t}var q=class t{constructor(e,o,i,r){let{width:s,height:n}=h();this.type=e||this.getRandomType(),this.size=o||1,this.radius=p.BASE_RADIUS/this.size,this.x=i!==void 0?i:m(0,s),this.y=r!==void 0?r:m(0,n);let a=p.SPEED_MULTIPLIER*this.size;this.velocityX=m(-1,1)*a,this.velocityY=m(-1,1)*a,this.rotation=0,this.rotationSpeed=m(-1,1)*p.ROTATION_SPEED;let l=this.getImageKey();this.image=mt(l),this.points=p.POINTS_BASE*this.size}getRandomType(){let e=["bront","steg","trex"];return e[It(0,e.length-1)]}getImageKey(){return this.type}update(e){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*e;let{width:o,height:i}=h();this.x<-this.radius&&(this.x=o+this.radius),this.x>o+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=i+this.radius),this.y>i+this.radius&&(this.y=-this.radius)}draw(e){if(e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),this.image){let o=this.radius*2/Math.max(this.image.width,this.image.height),i=this.image.width*o,r=this.image.height*o;e.drawImage(this.image,-i/2,-r/2,i,r)}else e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.strokeStyle="gray",e.stroke();e.restore()}break(){if(this.size>=3)return[];let e=this.size+1,o=[];for(let i=0;i<2;i++){let r=m(-10,10),s=m(-10,10),n=new t(this.type,e,this.x+r,this.y+s);n.velocityX=this.velocityX+m(-1,1),n.velocityY=this.velocityY+m(-1,1),o.push(n)}return o}isCollidingWith(e){let o=this.x-e.x,i=this.y-e.y;return Math.sqrt(o*o+i*i)<this.radius+e.radius}},yt=q;var Z=class{constructor(e,o,i){this.x=e,this.y=o,this.angle=i,this.velocityX=Math.cos(i)*x.SPEED,this.velocityY=Math.sin(i)*x.SPEED,this.radius=x.RADIUS,this.lifespan=x.LIFESPAN,this.active=!0}update(e){if(!this.active)return!1;if(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.lifespan-=e*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:o,height:i}=h();return this.x<-this.radius||this.x>o+this.radius||this.y<-this.radius||this.y>i+this.radius?(this.active=!1,!1):!0}draw(e){this.active&&(e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle="white",e.fill())}isCollidingWith(e){if(!this.active)return!1;let o=this.x-e.x,i=this.y-e.y;return Math.sqrt(o*o+i*i)<this.radius+e.radius}deactivate(){this.active=!1}},Tt=Z;function wt(t,e,o,i){let{width:r,height:s}=h();t.fillStyle="white",t.font="20px Arial",t.textAlign="left",t.fillText(`Score: ${e}`,20,30),t.textAlign="center",t.fillText(`Level: ${i}`,r/2,30),Ht(t,o,r-20,30)}function Ht(t,e,o,i){t.textAlign="right",t.fillText("Lives: ",o-30,i);for(let r=0;r<e;r++)Bt(t,o-r*25,i-5,10)}function Bt(t,e,o,i){t.save(),t.translate(e,o),t.strokeStyle="white",t.lineWidth=1.5,t.beginPath(),t.moveTo(i,0),t.lineTo(-i*.7,-i*.7),t.lineTo(-i*.4,0),t.lineTo(-i*.7,i*.7),t.closePath(),t.stroke(),t.restore()}var S="",j=3,b=!1,J=null,Q=null;function N(t,e,o=[]){let{width:i,height:r}=h();if(w("black"),t.fillStyle="white",t.font="bold 48px Arial",t.textAlign="center",t.fillText("GAME OVER",i/2,r/4),t.font="32px Arial",t.fillText(`Score: ${e}`,i/2,r/4+60),Yt(e,o)){t.font="24px Arial",t.fillText("New High Score!",i/2,r/4+100),t.fillText("Enter your initials:",i/2,r/4+140);let n=120,a=40,l=i/2-n/2,u=r/4+160;t.strokeStyle="white",t.lineWidth=2,t.strokeRect(l,u,n,a),t.font="32px Arial",t.fillText(S+(b?"_":""),i/2,u+30),S.length===j&&(t.font="24px Arial",t.fillText("Press ENTER to submit",i/2,u+80))}else t.font="24px Arial",t.fillText("Press SPACE to play again",i/2,r/4+120);o&&o.length>0&&Ut(t,o,i,r)}function Ut(t,e,o,i){t.font="bold 32px Arial",t.fillText("TOP SCORES",o/2,i/2);let r=[...e].sort((n,a)=>a.score-n.score).slice(0,5);t.font="20px Arial",t.textAlign="left";let s=o/2-100;r.forEach((n,a)=>{let l=i/2+40+a*30;t.fillText(`${a+1}. ${n.initials}`,s,l),t.textAlign="right",t.fillText(`${n.score}`,s+200,l),t.textAlign="left"})}function Yt(t,e){if(!e||e.length===0||e.length<5)return!0;let o=[...e].sort((i,r)=>r.score-i.score);return t>o[4].score}function At(t){b?t.key.length===1&&/[A-Za-z]/.test(t.key)?S.length<j&&(S+=t.key.toUpperCase()):t.key==="Backspace"?S=S.slice(0,-1):t.key==="Enter"&&S.length===j&&(J&&J(S),Vt()):t.code==="Space"&&Q&&Q()}function Vt(){S="",b=!1}function vt(){b=!0}function Lt(t){J=t}function Ot(t){Q=t}function Pt(t,e,o,i){if(!e||e.length===0)return;let r=[...e].sort((n,a)=>a.score-n.score).slice(0,5);t.font="16px Arial",t.fillStyle="white",t.textAlign="left",t.font="bold 18px Arial",t.fillText("HIGH SCORES",o,i);let s=22;r.forEach((n,a)=>{let l=i+25+a*s,u="";if(n.createdAt)try{let C=new Date(n.createdAt);u=`${C.getMonth()+1}/${C.getDate()}`}catch{}t.textAlign="left",t.fillText(`${a+1}. ${n.initials||"???"}`,o,l),t.textAlign="right",t.fillText(`${n.score}`,o+120,l),u&&(t.font="12px Arial",t.fillText(u,o+160,l),t.font="16px Arial")}),t.textAlign="left"}var rt=!1,P=!1,R=!1,L=!1,Wt=!1,tt=0,E=0,D=A.INITIAL_LIVES,M=1,et=0,f=[],d=null,g=[],v=[],O=null;function it(){let{canvas:t,ctx:e}=T();w("black"),e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("DINOSTROIDS",t.width/2,t.height/3),e.font="24px Arial",e.fillText("Press SPACE to start",t.width/2,t.height/2),e.fillText("Press H for help",t.width/2,t.height/2+40),et>0&&(e.font="16px Arial",e.fillText(`Games Played: ${et}`,t.width/2,t.height-50)),f&&f.length>0&&Pt(e,f,t.width-200,50)}function xt(){let{canvas:t,ctx:e}=T();w("black"),e.fillStyle="white",e.font="bold 36px Arial",e.textAlign="center",e.fillText("HOW TO PLAY",t.width/2,100),e.font="20px Arial",e.textAlign="left";let o=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 H: Toggle help screen","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible"],i=150,r=30;o.forEach((s,n)=>{e.fillText(s,t.width/4,i+n*r)}),e.font="24px Arial",e.textAlign="center",e.fillText("Press H to return",t.width/2,t.height-50)}function _t(){L||P||R||(console.log("Starting game..."),P=!0,R=!1,rt=!0,E=0,D=A.INITIAL_LIVES,M=1,d=new Et,Rt(A.INITIAL_ASTEROIDS),v=[],ht().catch(t=>console.error("Failed to increment games played:",t)),tt=performance.now(),O=requestAnimationFrame(ot))}function Rt(t){let{width:e,height:o}=h();g=[];for(let i=0;i<t;i++){let r,s,n;do{r=Math.random()*e,s=Math.random()*o;let l=d?d.x-r:e/2-r,u=d?d.y-s:o/2-s;n=Math.sqrt(l*l+u*u)}while(n<p.SPAWN_DISTANCE_MIN);let a=new yt(null,1,r,s);g.push(a)}}function ot(t){let e=(t-tt)/1e3;if(tt=t,Wt||!rt){O=requestAnimationFrame(ot);return}w("black");let{ctx:o}=T();if(d){let i=d.update(e);i&&v.push(new Tt(i.x,i.y,i.rotation)),d.draw(o)}for(let i=v.length-1;i>=0;i--){let r=v[i];if(!r.update(e)){v.splice(i,1);continue}r.draw(o);for(let s=g.length-1;s>=0;s--){let n=g[s];if(r.isCollidingWith(n)){r.deactivate(),v.splice(i,1);let a=n.break();E+=p.SCORE_VALUES[n.size]||100,g.push(...a),g.splice(s,1);break}}}if(g.forEach(i=>{i.update(e),i.draw(o)}),d&&!d.isDestroyed)for(let i=g.length-1;i>=0;i--){let r=g[i];if(d.isCollidingWith(r)){d.destroy(),D-=p.COLLISION_DAMAGE,D<=0?Xt():setTimeout(()=>{d.reset()},1e3);break}}if(g.length===0&&P&&!R){M++;let i=Math.min(A.INITIAL_ASTEROIDS+(M-1)*A.ASTEROID_INCREMENT_PER_LEVEL,20);Rt(i)}wt(o,E,D,M),O=requestAnimationFrame(ot)}function Xt(){console.log("Game over!"),R=!0,rt=!1,O&&(cancelAnimationFrame(O),O=null);let{ctx:t}=T();N(t,E,f),zt()&&(vt(),Lt(async o=>{try{await dt(o,E),f=await $(),N(t,E,f)}catch(i){console.error("Failed to submit score:",i)}})),Ot(()=>{_t()}),document.addEventListener("keydown",At)}function zt(){if(!f||f.length===0||f.length<10)return!0;let t=[...f].sort((e,o)=>o.score-e.score);return E>t[Math.min(9,t.length-1)].score}function Kt(){P||(L=!L,L?xt():it())}function bt(){console.log("Initializing game...");let{canvas:t}=lt();window.addEventListener("resize",()=>{if(G(),!P)L?xt():it();else if(R){let{ctx:e}=T();N(e,E,f)}}),gt(),pt(()=>{!P&&!L&&_t()}),St(()=>{Kt()}),ft(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{et=await ct()}catch(e){console.error("Failed to fetch games played:",e)}})(),(async()=>{try{f=await $()}catch(e){console.error("Failed to fetch leaderboard:",e)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),it()})})}at();document.addEventListener("DOMContentLoaded",()=>{bt()});
