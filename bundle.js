var Me="@vercel/analytics",$e="1.5.0",ke=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function ae(){return typeof window<"u"}function le(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function Ge(e="auto"){if(e==="auto"){window.vam=le();return}window.vam=e}function Fe(){return(ae()?window.vam:le())||"production"}function H(){return Fe()==="development"}function Ue(e){return e.scriptSrc?e.scriptSrc:H()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function ce(e={debug:!0}){var t;if(!ae())return;Ge(e.mode),ke(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));let o=Ue(e);if(document.head.querySelector(`script[src*="${o}"]`))return;let i=document.createElement("script");i.src=o,i.defer=!0,i.dataset.sdkn=Me+(e.framework?`/${e.framework}`:""),i.dataset.sdkv=$e,e.disableAutoTrack&&(i.dataset.disableAutoTrack="1"),e.endpoint?i.dataset.endpoint=e.endpoint:e.basePath&&(i.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(i.dataset.dsn=e.dsn),i.onerror=()=>{let r=H()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${o}. ${r}`)},H()&&e.debug===!1&&(i.dataset.debug="false"),document.head.appendChild(i)}var d,I;function fe(){return d=document.getElementById("gameCanvas"),I=d.getContext("2d"),B(),{canvas:d,ctx:I}}function L(){return{canvas:d,ctx:I}}function B(){d&&(console.log("Resizing canvas to fit window..."),d.width=window.innerWidth,d.height=window.innerHeight)}function P(e="black"){!I||!d||(I.clearRect(0,0,d.width,d.height),I.fillStyle=e,I.fillRect(0,0,d.width,d.height))}function f(){return d?{width:d.width,height:d.height}:{width:0,height:0}}async function de(){console.log("Fetching global games played count...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/gamesPlayed",{signal:e.signal,cache:"no-store"});if(clearTimeout(t),!o.ok)throw console.warn(`API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return typeof i.count=="number"?(console.log(`Global games played count: ${i.count}`),i.count):(console.warn("Received invalid count from API."),50)}catch(e){return e.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",e),console.log("Using fallback games played count: 50"),50}}async function he(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:e.signal,cache:"no-store"});return clearTimeout(t),o.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${o.status}`),!1)}catch(e){return e.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",e),!1}}async function K(){console.log("Fetching leaderboard data...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),o=await fetch("/api/leaderboard",{signal:e.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(t),!o.ok)throw console.warn(`Leaderboard API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return console.log("Leaderboard data received:",i.length?`${i.length} entries`:"Empty array"),i.length>0&&console.log("First entry:",JSON.stringify(i[0])),i}catch(e){return console.error("Failed to fetch leaderboard:",e),[]}finally{console.log("Leaderboard fetch completed")}}async function ue(e,t,o="medium",i=""){console.log(`Submitting score: ${e} points, ${t}ms, ${o} difficulty`);try{let r=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:i,score:e,time:t,difficulty:o})});if(!r.ok){let n=await r.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${r.status} ${n.message||""}`)}let s=await r.json();return console.log("Submission result:",s.message),!0}catch(r){return console.error("Error submitting score:",r),!1}}var $={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},_={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},R={RADIUS:2,SPEED:500,LIFESPAN:1e3},E={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var V={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var nt=Math.PI*2;var st=.07*3,at=.18*3;var lt=.6*3,ct=1.6*3;var w={easy:{playerAcceleration:.54,shootCooldown:120,asteroidSpeed:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},initialAsteroids:2,lives:5},medium:{playerAcceleration:.81,shootCooldown:84,asteroidSpeed:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},initialAsteroids:3,lives:3},difficult:{playerAcceleration:1.08,shootCooldown:60,asteroidSpeed:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}},initialAsteroids:4,lives:2}},z={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},ft={[z.BIG]:{baseSize:45,score:20},[z.MEDIUM]:{baseSize:25,score:50},[z.LITTLE]:{baseSize:15,score:100}};var me={};function ge(e){console.log("Preloading dinosaur images...");let t=0,o=Object.keys(V).length,i=()=>{console.log("All dinosaur images loaded successfully!"),e&&e()},r=n=>{console.log(`${n} dinosaur image loaded.`),t++,t===o&&i()},s=(n,a)=>{console.error(`Error loading ${n} dinosaur image:`,a),t++,t===o&&i()};Object.entries(V).forEach(([n,a])=>{let l=new Image;l.onload=()=>r(n),l.onerror=c=>s(n,c),l.src=a,me[n]=l})}function pe(e){return me[e]||null}var Z={},W=null,X=null,q=null,N=null;function Se(){window.addEventListener("keydown",Ye),window.addEventListener("keyup",He)}function Ye(e){Z[e.code]=!0,e.code==="Space"&&W&&W(),(e.key==="?"||e.code==="Slash"&&e.shiftKey)&&X&&(X(),e.preventDefault()),e.code==="Escape"&&q&&q(),N&&(e.code==="KeyE"?N("easy"):e.code==="KeyM"?N("medium"):e.code==="KeyD"&&N("difficult"))}function He(e){Z[e.code]=!1}function C(e){return Z[e]===!0}function ye(e){W=e}function Te(e){X=e}function Ee(e){q=e}function Ae(e){N=e}var j=class{constructor(t="medium"){let{width:o,height:i}=f();this.x=o/2,this.y=i/2,this.radius=_.RADIUS;let r=w[t];this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=_.ROTATION_SPEED,this.acceleration=r.playerAcceleration,this.friction=_.FRICTION,this.canShoot=!0,this.shootCooldown=r.shootCooldown,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0}update(t){if(this.isDestroyed)return null;if(this.invincible&&(this.invincibilityTime-=t,this.invincibilityTime<=0&&(this.invincible=!1)),C("ArrowLeft")&&(this.rotation-=this.rotationSpeed*t),C("ArrowRight")&&(this.rotation+=this.rotationSpeed*t),this.isThrusting=C("ArrowUp"),this.isThrusting){let s=Math.cos(this.rotation)*this.acceleration*t,n=Math.sin(this.rotation)*this.acceleration*t;this.velocityX+=s,this.velocityY+=n}this.velocityX*=1-this.friction*t,this.velocityY*=1-this.friction*t,this.x+=this.velocityX,this.y+=this.velocityY;let{width:o,height:i}=f();this.x<0&&(this.x=o),this.x>o&&(this.x=0),this.y<0&&(this.y=i),this.y>i&&(this.y=0);let r=null;if(C("Space")&&this.canShoot&&!this.isDestroyed){let s=Date.now();s-this.lastShot>this.shootCooldown&&(r={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=s)}return r}setShootCooldown(t){this.shootCooldown=t}setAcceleration(t){this.acceleration=t}draw(t){if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(this.radius,0),t.lineTo(-this.radius*.7,-this.radius*.7),t.lineTo(-this.radius*.5,0),t.lineTo(-this.radius*.7,this.radius*.7),t.closePath(),t.stroke(),this.isThrusting){t.beginPath(),t.moveTo(-this.radius*.5,0),t.lineTo(-this.radius*1.5,0);let o=Math.random()*.5+.5;t.lineTo(-this.radius*(1+o),.5*this.radius*o),t.lineTo(-this.radius*.5,0),t.fillStyle="orange",t.fill()}t.restore()}}destroy(){this.isDestroyed=!0}reset(){let{width:t,height:o}=f();this.x=t/2,this.y=o/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.invincible=!0,this.invincibilityTime=_.INVINCIBILITY_TIME}isCollidingWith(t){if(this.isDestroyed||this.invincible)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}},Ie=j;function we(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function u(e,t){return Math.random()*(t-e)+e}var J=class e{constructor(t,o,i,r,s="medium"){let{width:n,height:a}=f();this.type=t||this.getRandomType(),this.size=o||1,this.difficulty=s,this.radius=E.BASE_RADIUS/this.size,this.x=i!==void 0?i:u(0,n),this.y=r!==void 0?r:u(0,a);let l=this.getSizeCategory(),c=w[s].asteroidSpeed[l],D=u(c.min,c.max);this.velocityX=u(-1,1)*D,this.velocityY=u(-1,1)*D,this.rotation=0,this.rotationSpeed=u(-1,1)*E.ROTATION_SPEED;let O=this.getImageKey();this.image=pe(O),this.points=E.POINTS_BASE*this.size}getSizeCategory(){switch(this.size){case 1:return"large";case 2:return"medium";case 3:return"small";default:return"large"}}getRandomType(){let t=["bront","steg","trex"];return t[we(0,t.length-1)]}getImageKey(){return this.type}update(t){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*t;let{width:o,height:i}=f();this.x<-this.radius&&(this.x=o+this.radius),this.x>o+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=i+this.radius),this.y>i+this.radius&&(this.y=-this.radius)}draw(t){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),this.image){let o=this.radius*2/Math.max(this.image.width,this.image.height),i=this.image.width*o,r=this.image.height*o;t.drawImage(this.image,-i/2,-r/2,i,r)}else t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.strokeStyle="gray",t.stroke();t.restore()}break(){if(this.size>=3)return[];let t=this.size+1,o=[];for(let i=0;i<2;i++){let r=u(-10,10),s=u(-10,10),n=new e(this.type,t,this.x+r,this.y+s,this.difficulty),a=n.getSizeCategory(),l=w[this.difficulty].asteroidSpeed[a],c=u(l.min,l.max),D=this.velocityX+u(-1,1),O=this.velocityY+u(-1,1),se=Math.sqrt(D*D+O*O);n.velocityX=D/se*c,n.velocityY=O/se*c,o.push(n)}return o}isCollidingWith(t){let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}},ve=J;var Q=class{constructor(t,o,i){this.x=t,this.y=o,this.angle=i,this.velocityX=Math.cos(i)*R.SPEED,this.velocityY=Math.sin(i)*R.SPEED,this.radius=R.RADIUS,this.lifespan=R.LIFESPAN,this.active=!0}update(t){if(!this.active)return!1;if(this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.lifespan-=t*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:o,height:i}=f();return this.x<-this.radius||this.x>o+this.radius||this.y<-this.radius||this.y>i+this.radius?(this.active=!1,!1):!0}draw(t){this.active&&(t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="white",t.fill())}isCollidingWith(t){if(!this.active)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}deactivate(){this.active=!1}},xe=Q;function De(e,t,o,i,r){let{width:s,height:n}=f();e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${t}`,20,30),e.textAlign="center",e.fillText(`Level: ${i}`,s/2,30),Ke(e,o,s-20,30),e.textAlign="left",e.fillText(`Difficulty: ${Be(r)}`,20,60)}function Be(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Ke(e,t,o,i){e.textAlign="right",e.fillText("Lives: ",o-30,i);for(let r=0;r<t;r++)ze(e,o-r*25,i-5,10)}function ze(e,t,o,i){e.save(),e.translate(t,o),e.strokeStyle="white",e.lineWidth=1.5,e.beginPath(),e.moveTo(i,0),e.lineTo(-i*.7,-i*.7),e.lineTo(-i*.4,0),e.lineTo(-i*.7,i*.7),e.closePath(),e.stroke(),e.restore()}var p="",ee=3,k=!1,te=null,ie=null;function G(e,t,o=[]){let{width:i,height:r}=f();if(P("black"),e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",i/2,r/4),e.font="32px Arial",e.fillText(`Score: ${t}`,i/2,r/4+60),We(t,o)){e.font="24px Arial",e.fillText("New High Score!",i/2,r/4+100),e.fillText("Enter your initials:",i/2,r/4+140);let n=120,a=40,l=i/2-n/2,c=r/4+160;e.strokeStyle="white",e.lineWidth=2,e.strokeRect(l,c,n,a),e.font="32px Arial",e.fillText(p+(k?"_":""),i/2,c+30),p.length===ee&&(e.font="24px Arial",e.fillText("Press ENTER to submit",i/2,c+80))}else e.font="24px Arial",e.fillText("Press SPACE to play again",i/2,r/4+120);o&&o.length>0&&Ve(e,o,i,r)}function Ve(e,t,o,i){e.font="bold 32px Arial",e.fillText("TOP SCORES",o/2,i/2);let r=[...t].sort((n,a)=>a.score-n.score).slice(0,5);e.font="20px Arial",e.textAlign="left";let s=o/2-100;r.forEach((n,a)=>{let l=i/2+40+a*30;e.fillText(`${a+1}. ${n.initials}`,s,l),e.textAlign="right",e.fillText(`${n.score}`,s+200,l),e.textAlign="left"})}function We(e,t){if(!t||t.length===0||t.length<5)return!0;let o=[...t].sort((i,r)=>r.score-i.score);return e>o[4].score}function Le(e){k?e.key.length===1&&/[A-Za-z]/.test(e.key)?p.length<ee&&(p+=e.key.toUpperCase()):e.key==="Backspace"?p=p.slice(0,-1):e.key==="Enter"&&p.length===ee&&(te&&te(p),Xe()):e.code==="Space"&&ie&&ie()}function Xe(){p="",k=!1}function Pe(){k=!0}function be(e){te=e}function Oe(e){ie=e}function _e(e,t){let{width:o,height:i}=f();e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("DINOSTROIDS",o/2,i/3),e.font="24px Arial",e.fillText("Select Difficulty:",o/2,i/2-30);let r=[{key:"E",label:"Easy",value:"easy"},{key:"M",label:"Medium",value:"medium"},{key:"D",label:"Difficult",value:"difficult"}],s=i/2+30;r.forEach((n,a)=>{let l=o/2-150+a*150,c=t===n.value;c&&(e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(l-65,s-30,130,40)),e.fillStyle=c?"#ffff00":"white",e.fillText(`${n.key}: ${n.label}`,l,s)}),e.fillStyle="white",e.font="24px Arial",e.fillText("Press SPACE to start",o/2,i*2/3+20),e.fillText("Press ? for help",o/2,i*2/3+60),e.font="16px Arial",e.fillText("Press E, M, or D to change difficulty",o/2,i-50)}var Y=!1,y=!1,g=!1,b=!1,qe=!1,oe=0,A=0,F=$.INITIAL_LIVES,U=1,Ze=0,S=[];var x="medium",h=null,m=[],v=[],T=null;function M(){let{ctx:e}=L();P("black"),_e(e,x)}function je(){console.log("Game ended by user (ESC key)"),y=!1,g=!0,Y=!1,T&&(cancelAnimationFrame(T),T=null),h=null,m=[],v=[],M()}function Re(){let{canvas:e,ctx:t}=L();P("black"),t.fillStyle="white",t.font="bold 36px Arial",t.textAlign="center",t.fillText("HOW TO PLAY",e.width/2,100),t.font="20px Arial",t.textAlign="left";let o=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 ?: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible"],i=150,r=30;o.forEach((s,n)=>{t.fillText(s,e.width/4,i+n*r)}),t.font="24px Arial",t.textAlign="center",t.fillText("Press ? to return",e.width/2,e.height-50)}function Je(){ye(()=>{!b&&!y&&!g?re():g&&(g=!1,re())}),Te(tt),Ee(()=>{y&&!g&&je()}),Ae(e=>{(!y||g)&&(x=e,M())})}function re(){if(b||y||g)return;console.log(`Starting game with ${x} difficulty...`),y=!0,g=!1,Y=!0,A=0;let e=w[x];F=e.lives,U=1,h=new Ie(x),Ne(e.initialAsteroids),v=[],he().catch(t=>console.error("Failed to increment games played:",t)),oe=performance.now(),T=requestAnimationFrame(ne)}function Ne(e){let{width:t,height:o}=f();m=[];for(let i=0;i<e;i++){let r,s,n;do{r=Math.random()*t,s=Math.random()*o;let l=h?h.x-r:t/2-r,c=h?h.y-s:o/2-s;n=Math.sqrt(l*l+c*c)}while(n<E.SPAWN_DISTANCE_MIN);let a=new ve(null,1,r,s,x);m.push(a)}}function ne(e){let t=(e-oe)/1e3;if(oe=e,qe||!Y){T=requestAnimationFrame(ne);return}P("black");let{ctx:o,canvas:i}=L();if(h){let r=h.update(t);r&&v.push(new xe(r.x,r.y,r.rotation)),h.draw(o)}for(let r=v.length-1;r>=0;r--){let s=v[r];if(!s.update(t)){v.splice(r,1);continue}s.draw(o);for(let n=m.length-1;n>=0;n--){let a=m[n];if(s.isCollidingWith(a)){s.deactivate(),v.splice(r,1);let l=a.break();A+=E.SCORE_VALUES[a.size]||100,m.push(...l),m.splice(n,1);break}}}if(m.forEach(r=>{r.update(t),r.draw(o)}),h&&!h.isDestroyed)for(let r=m.length-1;r>=0;r--){let s=m[r];if(h.isCollidingWith(s)){h.destroy(),F-=E.COLLISION_DAMAGE,F<=0?Qe():setTimeout(()=>{h.reset()},1e3);break}}if(m.length===0&&y&&!g){U++;let r=Math.min($.INITIAL_ASTEROIDS+(U-1)*$.ASTEROID_INCREMENT_PER_LEVEL,20);Ne(r)}De(o,A,F,U,x),T=requestAnimationFrame(ne)}function Qe(){console.log("Game over!"),g=!0,Y=!1,T&&(cancelAnimationFrame(T),T=null);let{ctx:e}=L();G(e,A,S),et()&&(Pe(),be(async o=>{try{await ue(o,A),S=await K(),G(e,A,S)}catch(i){console.error("Failed to submit score:",i)}})),Oe(()=>{re()}),document.addEventListener("keydown",Le)}function et(){if(!S||S.length===0||S.length<10)return!0;let e=[...S].sort((t,o)=>o.score-t.score);return A>e[Math.min(9,e.length-1)].score}function tt(){y||(b=!b,b?Re():M())}function Ce(){console.log("Initializing game...");let{canvas:e}=fe();window.addEventListener("resize",()=>{if(B(),!y)b?Re():M();else if(g){let{ctx:t}=L();G(t,A,S)}}),Se(),Je(),ge(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{Ze=await de()}catch(t){console.error("Failed to fetch games played:",t)}})(),(async()=>{try{S=await K()}catch(t){console.error("Failed to fetch leaderboard:",t)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),M()})})}ce();document.addEventListener("DOMContentLoaded",()=>{Ce()});
