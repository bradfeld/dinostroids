var st="@vercel/analytics",nt="1.5.0",rt=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function xe(){return typeof window<"u"}function Pe(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function at(e="auto"){if(e==="auto"){window.vam=Pe();return}window.vam=e}function lt(){return(xe()?window.vam:Pe())||"production"}function j(){return lt()==="development"}function ct(e){return e.scriptSrc?e.scriptSrc:j()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Le(e={debug:!0}){var t;if(!xe())return;at(e.mode),rt(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));let o=ct(e);if(document.head.querySelector(`script[src*="${o}"]`))return;let i=document.createElement("script");i.src=o,i.defer=!0,i.dataset.sdkn=st+(e.framework?`/${e.framework}`:""),i.dataset.sdkv=nt,e.disableAutoTrack&&(i.dataset.disableAutoTrack="1"),e.endpoint?i.dataset.endpoint=e.endpoint:e.basePath&&(i.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(i.dataset.dsn=e.dsn),i.onerror=()=>{let n=j()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${o}. ${n}`)},j()&&e.debug===!1&&(i.dataset.debug="false"),document.head.appendChild(i)}var w,C;function Me(){return w=document.getElementById("gameCanvas"),C=w.getContext("2d"),J(),{canvas:w,ctx:C}}function G(){return{canvas:w,ctx:C}}function J(){w&&(console.log("Resizing canvas to fit window..."),w.width=window.innerWidth,w.height=window.innerHeight)}function Y(e="black"){!C||!w||(C.clearRect(0,0,w.width,w.height),C.fillStyle=e,C.fillRect(0,0,w.width,w.height))}function m(){return w?{width:w.width,height:w.height}:{width:0,height:0}}async function be(){console.log("Fetching global games played count...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/gamesPlayed",{signal:e.signal,cache:"no-store"});if(clearTimeout(t),!o.ok)throw console.warn(`API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return typeof i.count=="number"?(console.log(`Global games played count: ${i.count}`),i.count):(console.warn("Received invalid count from API."),50)}catch(e){return e.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",e),console.log("Using fallback games played count: 50"),50}}async function De(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:e.signal,cache:"no-store"});return clearTimeout(t),o.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${o.status}`),!1)}catch(e){return e.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",e),!1}}async function Q(){console.log("Fetching leaderboard data...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),o=await fetch("/api/leaderboard",{signal:e.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(t),!o.ok)throw console.warn(`Leaderboard API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return console.log("Leaderboard data received:",i.length?`${i.length} entries`:"Empty array"),i.length>0&&console.log("First entry:",JSON.stringify(i[0])),i}catch(e){return console.error("Failed to fetch leaderboard:",e),[]}finally{console.log("Leaderboard fetch completed")}}async function Oe(e,t,o=0,i=1,n="medium"){console.log(`Submitting score: ${t} points, Level ${i}, ${o}ms, ${n} difficulty`);try{let s=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:e,score:t,time:o,level:i,difficulty:n,date:new Date().toISOString()})});if(!s.ok){let a=await s.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${s.status} ${a.message||""}`)}let r=await s.json();return console.log("Submission result:",r.message),!0}catch(s){return console.error("Error submitting score:",s),!1}}var z={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},D={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},V={RADIUS:2,SPEED:500,LIFESPAN:1e3},S={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var te={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var Ot=Math.PI*2;var $t=.07*3,Ct=.18*3;var _t=.6*3,Rt=1.6*3;var K={easy:{shootCooldown:120,asteroidSpeed:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},initialAsteroids:2,lives:5},medium:{shootCooldown:84,asteroidSpeed:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},initialAsteroids:3,lives:3},difficult:{shootCooldown:60,asteroidSpeed:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}},initialAsteroids:4,lives:2}},ee={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},Nt={[ee.BIG]:{baseSize:45,score:20},[ee.MEDIUM]:{baseSize:25,score:50},[ee.LITTLE]:{baseSize:15,score:100}};var $e={};function Ce(e){return console.log("Preloading dinosaur images..."),new Promise((t,o)=>{let i=0,n=Object.keys(te).length;if(n===0){console.log("No dinosaur images to load."),e&&e(),t();return}let s=()=>{console.log("All dinosaur images loaded successfully!"),e&&e(),t()},r=h=>{console.log(`${h} dinosaur image loaded.`),i++,i===n&&s()},a=(h,u)=>{console.error(`Error loading ${h} dinosaur image:`,u),i++,i===n&&s()};Object.entries(te).forEach(([h,u])=>{let l=new Image;l.onload=()=>r(h),l.onerror=f=>a(h,f),l.src=u,$e[h]=l})})}function _e(e){return $e[e]||null}var ne={},ie=null,oe=null,se=null,W=null;function Re(){window.addEventListener("keydown",dt),window.addEventListener("keyup",ht)}function dt(e){ne[e.code]=!0,(e.code==="Enter"||e.code==="NumpadEnter")&&ie&&ie(),(e.key==="?"||e.code==="Slash"&&e.shiftKey)&&oe&&(oe(),e.preventDefault()),e.code==="Escape"&&se&&se(),W&&(e.code==="KeyE"?W("easy"):e.code==="KeyM"?W("medium"):e.code==="KeyD"&&W("difficult"))}function ht(e){ne[e.code]=!1}function H(e){return ne[e]===!0}function re(e){ie=e}function ae(e){oe=e}function le(e){se=e}function ce(e){W=e}var de=class{constructor(){let{width:t,height:o}=m();this.x=t/2,this.y=o/2,this.radius=D.RADIUS,this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=D.ROTATION_SPEED,this.acceleration=D.ACCELERATION,this.friction=D.FRICTION,this.canShoot=!0,this.shootCooldown=D.SHOOT_COOLDOWN,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0,this.explosionParticles=[],this.explosionDuration=2e3,this.explosionElapsed=0,this.exploding=!1,this.isInHyperspace=!1,this.hyperspaceTime=0,this.hyperspaceCooldown=3e3,this.lastHyperspace=0}update(t){if(this.exploding){this.explosionElapsed+=t*1e3;let{width:l,height:f}=m();for(let g=0;g<this.explosionParticles.length;g++){let c=this.explosionParticles[g];c.x+=c.vx*t,c.y+=c.vy*t,c.x<0&&(c.x=l),c.x>l&&(c.x=0),c.y<0&&(c.y=f),c.y>f&&(c.y=0),c.angle+=c.rotationSpeed*t,c.alpha=1-this.explosionElapsed/this.explosionDuration}return this.explosionElapsed>=this.explosionDuration&&(this.exploding=!1,this.explosionParticles=[],console.log("Explosion animation complete")),null}if(this.isDestroyed)return null;this.invincible&&(this.invincibilityTime-=t*1e3,this.invincibilityTime<=0&&(this.invincible=!1,this.invincibilityTime=0));let i=Date.now()-this.lastHyperspace>this.hyperspaceCooldown;if(H("KeyH")&&i&&!this.isInHyperspace)return this.hyperspace(),null;if(H("ArrowLeft")&&(this.rotation-=this.rotationSpeed*t),H("ArrowRight")&&(this.rotation+=this.rotationSpeed*t),this.isThrusting=H("ArrowUp"),this.isThrusting){let l=Math.cos(this.rotation)*this.acceleration,f=Math.sin(this.rotation)*this.acceleration;this.velocityX+=l*t,this.velocityY+=f*t}let n=1-(1-this.friction)*Math.min(1,t*5);this.velocityX*=n,this.velocityY*=n;let s=300,r=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);if(r>s){let l=s/r;this.velocityX*=l,this.velocityY*=l}this.x+=this.velocityX*t,this.y+=this.velocityY*t;let{width:a,height:h}=m();this.x<0&&(this.x=a),this.x>a&&(this.x=0),this.y<0&&(this.y=h),this.y>h&&(this.y=0);let u=null;if(H("Space")&&this.canShoot&&!this.isDestroyed){let l=Date.now();l-this.lastShot>this.shootCooldown&&(u={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=l)}return u}draw(t){if(this.exploding&&this.explosionParticles.length>0){for(let o=0;o<this.explosionParticles.length;o++){let i=this.explosionParticles[o];t.save(),t.globalAlpha=i.alpha,t.strokeStyle=i.color,t.lineWidth=1,t.beginPath(),t.moveTo(i.x,i.y);let n=i.x+Math.cos(i.angle)*i.length,s=i.y+Math.sin(i.angle)*i.length;t.lineTo(n,s),t.stroke(),t.restore()}return}if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(this.radius,0),t.lineTo(-this.radius*.7,-this.radius*.7),t.lineTo(-this.radius*.5,0),t.lineTo(-this.radius*.7,this.radius*.7),t.closePath(),t.stroke(),this.isThrusting){t.beginPath(),t.moveTo(-this.radius*.5,0),t.lineTo(-this.radius*1.5,0);let o=Math.random()*.5+.5;t.lineTo(-this.radius*(1+o),.5*this.radius*o),t.lineTo(-this.radius*.5,0),t.fillStyle="orange",t.fill()}t.restore()}}destroy(){console.log("Player destroy method called!"),this.isDestroyed=!0,this.createExplosion(),console.log("After createExplosion, exploding flag:",this.exploding)}createExplosion(){console.log("Creating ship explosion animation!"),this.exploding=!0,this.explosionElapsed=0,this.explosionParticles=[];let t=15,o="#ffffff";for(let i=0;i<t;i++){let n=Math.random()*Math.PI*2,s=20+Math.random()*80,r=5+Math.random()*10;this.explosionParticles.push({x:this.x,y:this.y,vx:Math.cos(n)*s,vy:Math.sin(n)*s,angle:n,length:r,color:o,alpha:1,rotationSpeed:(Math.random()-.5)*5})}}reset(){let{width:t,height:o}=m();this.x=t/2,this.y=o/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.exploding=!1,this.explosionParticles=[],this.invincible=!0,this.invincibilityTime=D.INVINCIBILITY_TIME}isCollidingWith(t){if(this.isDestroyed||this.invincible)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}hyperspace(){console.log("Hyperspace jump initiated!"),this.lastHyperspace=Date.now(),this.isInHyperspace=!0;let{width:t,height:o}=m(),i=50,n=i+Math.random()*(t-i*2),s=i+Math.random()*(o-i*2);this.x=n,this.y=s,this.velocityX*=.5,this.velocityY*=.5,this.invincible=!0,this.invincibilityTime=D.INVINCIBILITY_TIME,setTimeout(()=>{this.isInHyperspace=!1},100)}},Ne=de;function ke(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function _(e,t){return Math.random()*(t-e)+e}var he=class e{constructor(t,o,i,n,s="medium",r=1,a=null){let{width:h,height:u}=m();console.log(`Asteroid constructor called with type=${t}, size=${o}, difficulty=${s}, speedMultiplier=${r}, fixedBaseSpeed=${a}`),this.type=t||this.getRandomType(),this.size=o||1,this.difficulty=s,this.speedMultiplier=r,this.fixedBaseSpeed=a,this.radius=S.BASE_RADIUS/this.size,this.x=i!==void 0?i:_(0,h),this.y=n!==void 0?n:_(0,u),console.log(`Creating asteroid: type=${this.type}, size=${this.size}, at (${this.x.toFixed(1)}, ${this.y.toFixed(1)})`);let l;if(a!==null)l=a,console.log(`Using fixed base speed: ${l.toFixed(2)}`);else{let E=this.getSizeCategory();console.log(`No fixed speed, using size category: ${E}`);let y=K[s].asteroidSpeed.medium;l=(y.min+y.max)/2}let f=l*r;console.log(`Final speed with multiplier: ${f.toFixed(2)}`);let g=Math.random()*Math.PI*2;this.velocityX=Math.cos(g)*f,this.velocityY=Math.sin(g)*f,console.log(`Velocity: (${this.velocityX.toFixed(2)}, ${this.velocityY.toFixed(2)})`),this.rotation=0,this.rotationSpeed=_(-1,1)*S.ROTATION_SPEED;let c=this.getImageKey();console.log(`Loading asteroid image: ${c}`),this.image=_e(c),this.image||console.error(`Failed to load image for asteroid type: ${c}`),this.points=S.POINTS_BASE*this.size}getSizeCategory(){switch(this.size){case 1:return"large";case 2:return"medium";case 3:return"small";default:return"large"}}getRandomType(){if(console.log("Getting random asteroid type from:",S.TYPES),!S.TYPES||S.TYPES.length===0)return console.warn('No asteroid types defined, defaulting to "bront"'),"bront";let t=ke(0,S.TYPES.length-1),o=S.TYPES[t];return console.log(`Selected random asteroid type: ${o} at index ${t}`),o}getImageKey(){return console.log(`Getting image key for type: ${this.type}`),(!this.type||!S.TYPES.includes(this.type))&&(console.warn(`Invalid asteroid type: ${this.type}, defaulting to 'bront'`),this.type="bront"),this.type}update(t){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*t;let{width:o,height:i}=m();this.x<-this.radius&&(this.x=o+this.radius),this.x>o+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=i+this.radius),this.y>i+this.radius&&(this.y=-this.radius)}draw(t){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),this.image){let o=this.radius*2/Math.max(this.image.width,this.image.height),i=this.image.width*o,n=this.image.height*o;t.drawImage(this.image,-i/2,-n/2,i,n)}else t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.strokeStyle="gray",t.stroke();t.restore()}break(){if(this.size>=3)return[];let t=[];if(this.size===1){let o=Math.random();o<.25?this.createChildAsteroids(2,2,t):o<.45?this.createChildAsteroids(2,3,t):o<.75?(this.createChildAsteroids(1,2,t),this.createChildAsteroids(1,3,t)):o<.9?this.createChildAsteroids(1,2,t):this.createChildAsteroids(1,3,t)}else this.size===2&&(Math.random()<.7?this.createChildAsteroids(2,3,t):this.createChildAsteroids(1,3,t));return t}createChildAsteroids(t,o,i){let n=Math.atan2(this.velocityY,this.velocityX);console.log(`Parent asteroid direction angle: ${(n*180/Math.PI).toFixed(2)} degrees`);for(let s=0;s<t;s++){let r=_(-10,10),a=_(-10,10),h=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);console.log(`Parent asteroid speed: ${h.toFixed(2)}`);let u=new e(this.type,o,this.x+r,this.y+a,this.difficulty,this.speedMultiplier,this.fixedBaseSpeed),l=_(-Math.PI/2,Math.PI/2),f=n+l;console.log(`Child asteroid angle offset: ${(l*180/Math.PI).toFixed(2)} degrees`),console.log(`Child asteroid final direction: ${(f*180/Math.PI).toFixed(2)} degrees`);let g=this.fixedBaseSpeed*this.speedMultiplier;console.log(`Child asteroid using fixed speed: ${g.toFixed(2)}`),u.velocityX=Math.cos(f)*g,u.velocityY=Math.sin(f)*g,i.push(u)}}isCollidingWith(t){let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}},Fe=he;var fe=class{constructor(t,o,i){this.x=t,this.y=o,this.angle=i,this.velocityX=Math.cos(i)*V.SPEED,this.velocityY=Math.sin(i)*V.SPEED,this.radius=V.RADIUS,this.lifespan=V.LIFESPAN,this.active=!0}update(t){if(!this.active)return!1;if(this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.lifespan-=t*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:o,height:i}=m();return this.x<-this.radius||this.x>o+this.radius||this.y<-this.radius||this.y>i+this.radius?(this.active=!1,!1):!0}draw(t){this.active&&(t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="white",t.fill())}isCollidingWith(t){if(!this.active)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}deactivate(){this.active=!1}},Ge=fe;function Ye(e,t,o,i,n){let{width:s,height:r}=m();e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${t}`,20,30),e.textAlign="center",e.fillText(`Level: ${i}`,s/2,30),ft(e,o,s-20,30)}function ft(e,t,o,i){for(let n=0;n<t;n++)ut(e,o-n*25,i-5,10)}function ut(e,t,o,i){e.save(),e.translate(t,o),e.rotate(-Math.PI/2),e.strokeStyle="white",e.lineWidth=1.5,e.beginPath(),e.moveTo(i,0),e.lineTo(-i*.7,-i*.7),e.lineTo(-i*.4,0),e.lineTo(-i*.7,i*.7),e.closePath(),e.stroke(),e.restore()}var A="",ue=3,me=!1,q=null,pe=null,R=null,Z=null;function ge(e,t,o=[],i=1,n=0){let{width:s,height:r}=m();if(Y("black"),e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",s/2,r/4),e.font="32px Arial",e.fillText(`Score: ${t}`,s/2,r/4+60),pt(t,o)){e.font="24px Arial",e.fillText("New High Score!",s/2,r/4+100),e.fillText("Enter your initials (up to 3 letters):",s/2,r/4+140),e.font="48px Arial",e.fillStyle="white",e.textAlign="center";let h=A?A+(A.length<ue?"_":""):"_";e.clearRect(s/2-100,r/4+170,200,60),e.fillText(h,s/2,r/4+200),e.font="16px Arial",e.fillText("Press ENTER when done or type up to 3 letters",s/2,r/4+240)}else e.font="24px Arial",e.fillText("Press SPACE to play again",s/2,r/4+120)}function pt(e,t){if(!t||t.length===0||t.length<20)return!0;let o=[...t].sort((n,s)=>s.score-n.score),i=o[o.length-1].score;return e>i}function Ue(e){R=e}function N(e){if(me){if(e.key==="Enter"){A.length>0&&q&&(q(A),He());return}e.key.length===1&&/[A-Za-z]/.test(e.key)?A.length<ue&&(A+=e.key.toUpperCase(),R&&R(),A.length===ue&&q&&setTimeout(()=>{q(A),He()},1e3)):e.key==="Backspace"&&(A=A.slice(0,-1),R&&R())}else e.code==="Space"&&pe&&pe()}function He(){A="",me=!1,Z&&(clearInterval(Z),Z=null)}function Be(){me=!0,A="",R&&!Z&&(Z=setInterval(()=>{R()},100))}function Xe(e){q=e}function ze(e){pe=e}function ye(e,t,o,i){o&&o.length>0&&(console.log("Leaderboard data keys:",Object.keys(o[0])),console.log("Sample entry:",o[0]));let n=[...o].sort((c,E)=>E.score-c.score).slice(0,20),s=Math.min(n.length,20,Math.floor((i.canvas.height-t-50)/25)),r=500;i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(e-r/2,t,r,s*25+50),i.fillStyle="white",i.font="bold 24px Arial",i.textAlign="center",i.fillText("High Scores",e,t+30);let a=e-r/2+50,h=e-r/2+120,u=e-r/2+190,l=e-r/2+250,f=e-r/2+340,g=e-r/2+430;i.font="16px Arial",i.textAlign="right",i.fillText("Rank",a,t+60),i.fillText("Score",h,t+60),i.fillText("Initials",u,t+60),i.fillText("Level",l,t+60),i.fillText("Date",f,t+60),i.fillText("Time",g,t+60),i.font="16px Arial";for(let c=0;c<s;c++){let E=n[c],y=t+85+c*25;E.isCurrent&&(i.fillStyle="rgba(255, 255, 0, 0.3)",i.fillRect(e-r/2+10,y-15,r-20,20),i.fillStyle="white"),i.textAlign="right",i.fillText(`${c+1}`,a,y),i.fillText(`${E.score}`,h,y),i.fillText(E.initials||"---",u,y),i.fillText(`${E.level||"1"}`,l,y);let Ae=E.date||E.createdAt||E.created_at;if(Ae)try{let b=new Date(Ae);if(isNaN(b.getTime()))i.fillText("--/--/--",f,y),i.fillText("--:--",g,y);else{let et=`${b.getMonth()+1}/${b.getDate()}/${b.getFullYear().toString().substr(2)}`;i.fillText(et,f,y);let ve=b.getHours(),tt=b.getMinutes(),it=ve>=12?"PM":"AM",ot=`${ve%12||12}:${tt.toString().padStart(2,"0")} ${it}`;i.fillText(ot,g,y)}}catch(b){console.error("Error parsing date:",b,"for score:",E),i.fillText("--/--/--",f,y),i.fillText("--:--",g,y)}else i.fillText("--/--/--",f,y),i.fillText("--:--",g,y)}o.length>s&&(i.textAlign="center",i.font="14px Arial",i.fillText(`Showing ${s} of ${o.length} scores`,e,t+s*25+40))}function Ve(e,t,o=[],i=0){let{width:n,height:s}=m();e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("DINOSTROIDS",n/2,s/3),e.font="24px Arial",e.fillText("Select Difficulty:",n/2,s/2-30);let r=[{key:"E",label:"Easy",value:"easy"},{key:"M",label:"Medium",value:"medium"},{key:"D",label:"Difficult",value:"difficult"}],a=s/2+30;r.forEach((h,u)=>{let l=n/2-150+u*150,f=t===h.value;f?(e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(l-65,a-30,130,40),e.font="bold 24px Arial"):e.font="24px Arial",e.fillStyle=f?"#ffffff":"rgba(255, 255, 255, 0.8)",e.fillText(`${h.key}: ${h.label}`,l,a)}),e.font="24px Arial",e.fillStyle="white",e.font="24px Arial",e.fillText("Press RETURN to start",n/2,s*2/3+20),e.fillText("Press ? for help",n/2,s*2/3+60),i>0&&(e.font="16px Arial",e.fillText(`Games Played: ${i}`,n/2,s-80)),e.font="14px Arial",e.fillText("\xA9 Intensity Ventures, 2025",n/2,s-20),o&&o.length>0&&ye(n-300,50,o,e)}var X=!1,P=!1,v=!1,F=!1,mt=!1,Se=0,L=0,U=z.INITIAL_LIVES,k=1,We=0,M=[],we=0,qe=0;var x="medium",Te=0,T={active:!1,text:"+1 SHIP",x:0,y:0,alpha:0,duration:2e3,startTime:0},d=null,I=[],O=[],p=null;var gt,yt,St,Tt,B=1;function $(){let{ctx:e}=G();console.log("Showing start screen"),P=!1,F=!1,X=!1,v=!1,p&&(cancelAnimationFrame(p),p=null),document.removeEventListener("keydown",N),Ie(),je(),Y("black"),Ve(e,x,M,We)}function Et(){console.log("Game ended by user (ESC key)"),P=!1,v=!0,X=!1,p&&(cancelAnimationFrame(p),p=null),d=null,I=[],O=[],$()}function Ze(){let{canvas:e,ctx:t}=G();Y("black"),t.fillStyle="white",t.font="bold 36px Arial",t.textAlign="center",t.fillText("HOW TO PLAY",e.width/2,100),t.font="20px Arial",t.textAlign="left";let o=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 H: Hyperspace jump (random teleport)","\u2022 ?: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible","","TIPS:","\u2022 Use hyperspace to escape danger","\u2022 You're invincible for 3 seconds after hyperspace"],i=150,n=30;o.forEach((s,r)=>{t.fillText(s,e.width/4,i+r*n)}),t.font="24px Arial",t.textAlign="center",t.fillText("Press ? to return",e.width/2,e.height-50)}function je(){Ie(),re(()=>{console.log("Start key pressed"),!F&&!P&&wt()}),ae(vt),le(()=>{P&&!v&&Et()}),ce(e=>{(!P||v)&&(x=e,xt(),$())})}function Ie(){re(null),ae(null),le(null),ce(null)}function wt(){if(F||P||v)return;console.log(`Starting game with ${x} difficulty...`),P=!0,v=!1,X=!0,L=0,Te=0;let e=K[x];U=e.lives,k=1,B=1,d=new Ne,d.acceleration=100,x==="medium"?d.acceleration=150:x==="difficult"&&(d.acceleration=200),d.shootCooldown=e.shootCooldown,console.log(`Player acceleration set to: ${d.acceleration}`),Je(e.initialAsteroids),O=[],qe=Date.now(),we=0,De().catch(t=>console.error("Failed to increment games played:",t)),Se=performance.now(),p=requestAnimationFrame(Ee)}function Je(e){let{width:t,height:o}=m();I=[],console.log(`Creating ${e} asteroids with speed multiplier: ${B}`);let i;x==="easy"?i=1:x==="medium"?i=2.5:i=5;let n=i*B;console.log(`Base speed for ALL asteroids: ${i.toFixed(2)}, With level multiplier: ${n.toFixed(2)}`);for(let s=0;s<e;s++){let r,a,h;do{Math.random()<.5?(r=Math.random()<.5?0:t,a=Math.random()*o):(r=Math.random()*t,a=Math.random()<.5?0:o);let E=d?d.x-r:t/2-r,y=d?d.y-a:o/2-a;h=Math.sqrt(E*E+y*y)}while(d&&h<S.SPAWN_DISTANCE_MIN);let u=S.TYPES[Math.floor(Math.random()*S.TYPES.length)],l=1;console.log(`Creating large asteroid type: ${u}, at (${r}, ${a})`);let f=new Fe(u,l,r,a,x,B,i),g=Math.random()*Math.PI*2,c=n;f.velocityX=Math.cos(g)*c,f.velocityY=Math.sin(g)*c,console.log(`Setting asteroid velocity to (${f.velocityX.toFixed(2)}, ${f.velocityY.toFixed(2)}) with speed: ${c.toFixed(2)}`),I.push(f)}}function Ee(e){let t=(e-Se)/1e3;Se=e;let o=Math.min(t,.1);if(mt||!X){p=requestAnimationFrame(Ee);return}we=Date.now()-qe,Y("black");let{ctx:i,canvas:n}=G();if(d){(d.isDestroyed||d.exploding||d.isInHyperspace)&&console.log(`Player state: destroyed=${d.isDestroyed}, exploding=${d.exploding}, hyperspace=${d.isInHyperspace}`);let s=d.update(o);s&&O.push(new Ge(s.x,s.y,s.rotation)),d.draw(i)}for(let s=O.length-1;s>=0;s--){let r=O[s];if(!r.update(o)){O.splice(s,1);continue}r.draw(i);for(let a=I.length-1;a>=0;a--){let h=I[a];if(r.isCollidingWith(h)){r.deactivate(),O.splice(s,1);let u=h.break();L+=S.SCORE_VALUES[h.size]||100,Ke(L),I.push(...u),I.splice(a,1);break}}}if(I.forEach(s=>{s.update(o),s.draw(i)}),d&&!d.isDestroyed&&!d.exploding&&!d.isInHyperspace&&!d.invincible)for(let s=I.length-1;s>=0;s--){let r=I[s];if(d.isCollidingWith(r)){console.log("Player hit by asteroid!"),d.destroy(),U-=S.COLLISION_DAMAGE,L+=S.SCORE_VALUES[r.size]||100,console.log(`Scored ${S.SCORE_VALUES[r.size]||100} points for asteroid collision`),Ke(L);let a=r.break();I.push(...a),I.splice(s,1),U<=0?setTimeout(()=>{It()},2e3):setTimeout(()=>{d.reset()},2e3);break}}if(I.length===0&&P&&!v){k++,B*=1.05,console.log(`Level ${k}: Speed multiplier increased to ${B.toFixed(2)}`);let s=Math.min(z.INITIAL_ASTEROIDS+(k-1)*z.ASTEROID_INCREMENT_PER_LEVEL,20);Je(s)}if(Ye(i,L,U,k,x),T.active){let s=Date.now()-T.startTime;if(s<T.duration){let r=s/T.duration;T.alpha=r<.5?r*2:2-r*2,T.y-=20*o,i.save(),i.fillStyle="rgba(255, 255, 255, "+T.alpha+")",i.font="bold 24px Arial",i.textAlign="center",i.fillText(T.text,T.x,T.y),i.restore()}else T.active=!1}p=requestAnimationFrame(Ee)}function It(){console.log("Game over!"),v=!0,X=!1,p&&(cancelAnimationFrame(p),p=null);let e=we;d&&(d=null),I=[],O=[],document.removeEventListener("keydown",N);let t=At();console.log(`Game over check - Is high score: ${t}, Score: ${L}`);let{ctx:o}=G(),i=()=>{ge(o,L,M,k,e)};Ue(i),i(),document.addEventListener("keydown",N),console.log("Added keydown event listener for game over screen"),t?(console.log("New high score detected!"),Be(),setTimeout(i,100),Xe(async n=>{try{console.log(`Submitting high score with initials: ${n}`),await Oe(n,L,e,k,x),M=await Q(),document.removeEventListener("keydown",N),v=!1,P=!1,X=!1,p&&(cancelAnimationFrame(p),p=null),$()}catch(s){console.error("Failed to submit score:",s),document.removeEventListener("keydown",N),v=!1,p&&(cancelAnimationFrame(p),p=null),$()}})):ze(()=>{console.log("Restarting game..."),document.removeEventListener("keydown",N),v=!1,P=!1,Ie(),p&&(cancelAnimationFrame(p),p=null),$()})}function At(){if(!M||M.length===0||M.length<20)return!0;let e=[...M].sort((t,o)=>o.score-t.score);return L>e[Math.min(19,e.length-1)].score}function vt(){P||(F=!F,F?Ze():$())}function Qe(){console.log("Initializing game...");let{canvas:e}=Me();window.addEventListener("resize",()=>{if(J(),!P)F?Ze():$();else if(v){let{ctx:t}=G();ge(t,L,M)}}),Re(),je(),Ce(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{We=await be()}catch(t){console.error("Failed to fetch games played:",t)}})(),(async()=>{try{M=await Q()}catch(t){console.error("Failed to fetch leaderboard:",t)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),$()})})}function xt(){let e=K[x];gt=e.shootCooldown,yt=e.asteroidSpeed,St=e.initialAsteroids,Tt=e.lives}function Ke(e){let t=z.EXTRA_LIFE_SCORE_THRESHOLD,o=Math.floor(Te/t)*t;Math.floor(e/t)*t>o&&(U++,Te=e,console.log(`BONUS SHIP! Extra life awarded at ${e} points. Lives: ${U}`),Pt())}function Pt(){let{width:e}=m();T.active=!0,T.x=e-100,T.y=90,T.alpha=0,T.startTime=Date.now()}Le();document.addEventListener("DOMContentLoaded",()=>{Qe()});
