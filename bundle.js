var tt="@vercel/analytics",it="1.5.0",ot=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function Le(){return typeof window<"u"}function Me(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function st(t="auto"){if(t==="auto"){window.vam=Me();return}window.vam=t}function nt(){return(Le()?window.vam:Me())||"production"}function te(){return nt()==="development"}function rt(t){return t.scriptSrc?t.scriptSrc:te()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Re(t={debug:!0}){var e;if(!Le())return;st(t.mode),ot(),t.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",t.beforeSend));let i=rt(t);if(document.head.querySelector(`script[src*="${i}"]`))return;let o=document.createElement("script");o.src=i,o.defer=!0,o.dataset.sdkn=tt+(t.framework?`/${t.framework}`:""),o.dataset.sdkv=it,t.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),t.endpoint?o.dataset.endpoint=t.endpoint:t.basePath&&(o.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(o.dataset.dsn=t.dsn),o.onerror=()=>{let s=te()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${i}. ${s}`)},te()&&t.debug===!1&&(o.dataset.debug="false"),document.head.appendChild(o)}function M(){let t=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t.toLowerCase())}var p=null,U=null;function Ce(){return p=document.createElement("canvas"),U=p.getContext("2d"),document.body.appendChild(p),ie(),{canvas:p,ctx:U}}function R(){return{canvas:p,ctx:U}}function ie(){if(p){if(console.log("Resizing canvas to fit window..."),M()){let t=window.innerWidth,e=window.innerHeight;p.width=t,p.height=e,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0",document.body.style.padding="0";let i=document.querySelector("meta[name=viewport]");i||(i=document.createElement("meta"),i.name="viewport",document.head.appendChild(i)),i.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",p.style.position="fixed",p.style.top="0",p.style.left="0",p.style.width="100%",p.style.height="100%",console.log(`Mobile canvas size set to: ${p.width}x${p.height}`)}else{let t=Math.min(1920,window.innerWidth-40),e=Math.min(1080,window.innerHeight-40),i=t,o=i*(9/16);o>e&&(o=e,i=o*(16/9)),p.width=i,p.height=o,p.style.position="absolute",p.style.left="50%",p.style.top="50%",p.style.transform="translate(-50%, -50%)"}p.style.backgroundColor="black"}}function B(t="black"){!U||!p||(U.fillStyle=t,U.fillRect(0,0,p.width,p.height))}function T(){return{width:p.width,height:p.height}}async function Oe(){console.log("Fetching global games played count...");try{let t=new AbortController,e=setTimeout(()=>t.abort(),3e3),i=await fetch("/api/gamesPlayed",{signal:t.signal,cache:"no-store"});if(clearTimeout(e),!i.ok)throw console.warn(`API returned error status: ${i.status}`),new Error(`HTTP error! status: ${i.status}`);let o=await i.json();return typeof o.count=="number"?(console.log(`Global games played count: ${o.count}`),o.count):(console.warn("Received invalid count from API."),50)}catch(t){return t.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",t),console.log("Using fallback games played count: 50"),50}}async function De(){try{let t=new AbortController,e=setTimeout(()=>t.abort(),3e3),i=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:t.signal,cache:"no-store"});return clearTimeout(e),i.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${i.status}`),!1)}catch(t){return t.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",t),!1}}async function oe(){console.log("Fetching leaderboard data...");try{let t=new AbortController,e=setTimeout(()=>t.abort(),5e3),i=await fetch("/api/leaderboard",{signal:t.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(e),!i.ok)throw console.warn(`Leaderboard API returned error status: ${i.status}`),new Error(`HTTP error! status: ${i.status}`);let o=await i.json();return console.log("Leaderboard data received:",o.length?`${o.length} entries`:"Empty array"),o.length>0&&console.log("First entry:",JSON.stringify(o[0])),o}catch(t){return console.error("Failed to fetch leaderboard:",t),[]}finally{console.log("Leaderboard fetch completed")}}async function $e(t,e,i=0,o=1,s="medium"){console.log(`Submitting score: ${e} points, Level ${o}, ${i}ms, ${s} difficulty`);try{let n=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:e,time:i,level:o,difficulty:s,date:new Date().toISOString()})});if(!n.ok){let a=await n.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${n.status} ${a.message||""}`)}let r=await n.json();return console.log("Submission result:",r.message),!0}catch(n){return console.error("Error submitting score:",n),!1}}var V={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},_={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},K={RADIUS:2,SPEED:500,LIFESPAN:1e3},E={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var ne={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var bt=Math.PI*2;var Pt=.07*3,Lt=.18*3;var Mt=.6*3,Rt=1.6*3;var X={easy:{shootCooldown:120,asteroidSpeed:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},initialAsteroids:2,lives:5},medium:{shootCooldown:84,asteroidSpeed:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},initialAsteroids:3,lives:3},difficult:{shootCooldown:60,asteroidSpeed:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}},initialAsteroids:4,lives:2}},se={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},Ct={[se.BIG]:{baseSize:45,score:20},[se.MEDIUM]:{baseSize:25,score:50},[se.LITTLE]:{baseSize:15,score:100}};var Ne={};function _e(t){return console.log("Preloading dinosaur images..."),new Promise((e,i)=>{let o=0,s=Object.keys(ne).length;if(s===0){console.log("No dinosaur images to load."),t&&t(),e();return}let n=()=>{console.log("All dinosaur images loaded successfully!"),t&&t(),e()},r=l=>{console.log(`${l} dinosaur image loaded.`),o++,o===s&&n()},a=(l,d)=>{console.error(`Error loading ${l} dinosaur image:`,d),o++,o===s&&n()};Object.entries(ne).forEach(([l,d])=>{let c=new Image;c.onload=()=>r(l),c.onerror=u=>a(l,u),c.src=d,Ne[l]=c})})}function ke(t){return Ne[t]||null}var ce={},re=null,ae=null,le=null,q=null;function Fe(){window.addEventListener("keydown",at),window.addEventListener("keyup",lt)}function at(t){ce[t.code]=!0,(t.code==="Enter"||t.code==="NumpadEnter")&&re&&re(),(t.key==="?"||t.code==="Slash"&&t.shiftKey)&&ae&&(ae(),t.preventDefault()),t.code==="Escape"&&le&&le(),q&&(t.code==="KeyE"?q("easy"):t.code==="KeyM"?q("medium"):t.code==="KeyD"&&q("difficult"))}function lt(t){ce[t.code]=!1}function W(t){return ce[t]===!0}function he(t){re=t}function de(t){ae=t}function fe(t){le=t}function ue(t){q=t}var pe=class{constructor(){let{width:e,height:i}=T();this.x=e/2,this.y=i/2,this.radius=_.RADIUS,this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=_.ROTATION_SPEED,this.acceleration=_.ACCELERATION,this.friction=_.FRICTION,this.canShoot=!0,this.shootCooldown=_.SHOOT_COOLDOWN,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0,this.explosionParticles=[],this.explosionDuration=2e3,this.explosionElapsed=0,this.exploding=!1,this.isInHyperspace=!1,this.hyperspaceTime=0,this.hyperspaceCooldown=3e3,this.lastHyperspace=0}update(e){if(this.exploding){this.explosionElapsed+=e*1e3;let{width:c,height:u}=T();for(let m=0;m<this.explosionParticles.length;m++){let h=this.explosionParticles[m];h.x+=h.vx*e,h.y+=h.vy*e,h.x<0&&(h.x=c),h.x>c&&(h.x=0),h.y<0&&(h.y=u),h.y>u&&(h.y=0),h.angle+=h.rotationSpeed*e,h.alpha=1-this.explosionElapsed/this.explosionDuration}return this.explosionElapsed>=this.explosionDuration&&(this.exploding=!1,this.explosionParticles=[],console.log("Explosion animation complete")),null}if(this.isDestroyed)return null;this.invincible&&(this.invincibilityTime-=e*1e3,this.invincibilityTime<=0&&(this.invincible=!1,this.invincibilityTime=0));let o=Date.now()-this.lastHyperspace>this.hyperspaceCooldown;if(W("KeyH")&&o&&!this.isInHyperspace)return this.hyperspace(),null;if(W("ArrowLeft")&&(this.rotation-=this.rotationSpeed*e),W("ArrowRight")&&(this.rotation+=this.rotationSpeed*e),this.isThrusting=W("ArrowUp"),this.isThrusting){let c=Math.cos(this.rotation)*this.acceleration,u=Math.sin(this.rotation)*this.acceleration;this.velocityX+=c*e,this.velocityY+=u*e}let s=1-(1-this.friction)*Math.min(1,e*5);this.velocityX*=s,this.velocityY*=s;let n=300,r=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);if(r>n){let c=n/r;this.velocityX*=c,this.velocityY*=c}this.x+=this.velocityX*e,this.y+=this.velocityY*e;let{width:a,height:l}=T();this.x<0&&(this.x=a),this.x>a&&(this.x=0),this.y<0&&(this.y=l),this.y>l&&(this.y=0);let d=null;if(W("Space")&&this.canShoot&&!this.isDestroyed){let c=Date.now();c-this.lastShot>this.shootCooldown&&(d={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=c)}return d}draw(e){if(this.exploding&&this.explosionParticles.length>0){for(let i=0;i<this.explosionParticles.length;i++){let o=this.explosionParticles[i];e.save(),e.globalAlpha=o.alpha,e.strokeStyle=o.color,e.lineWidth=1,e.beginPath(),e.moveTo(o.x,o.y);let s=o.x+Math.cos(o.angle)*o.length,n=o.y+Math.sin(o.angle)*o.length;e.lineTo(s,n),e.stroke(),e.restore()}return}if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.strokeStyle="white",e.lineWidth=2,e.beginPath(),e.moveTo(this.radius,0),e.lineTo(-this.radius*.7,-this.radius*.7),e.lineTo(-this.radius*.5,0),e.lineTo(-this.radius*.7,this.radius*.7),e.closePath(),e.stroke(),this.isThrusting){e.beginPath(),e.moveTo(-this.radius*.5,0),e.lineTo(-this.radius*1.5,0);let i=Math.random()*.5+.5;e.lineTo(-this.radius*(1+i),.5*this.radius*i),e.lineTo(-this.radius*.5,0),e.fillStyle="orange",e.fill()}e.restore()}}destroy(){console.log("Player destroy method called!"),this.isDestroyed=!0,this.createExplosion(),console.log("After createExplosion, exploding flag:",this.exploding)}createExplosion(){console.log("Creating ship explosion animation!"),this.exploding=!0,this.explosionElapsed=0,this.explosionParticles=[];let e=15,i="#ffffff";for(let o=0;o<e;o++){let s=Math.random()*Math.PI*2,n=20+Math.random()*80,r=5+Math.random()*10;this.explosionParticles.push({x:this.x,y:this.y,vx:Math.cos(s)*n,vy:Math.sin(s)*n,angle:s,length:r,color:i,alpha:1,rotationSpeed:(Math.random()-.5)*5})}}reset(){let{width:e,height:i}=T();this.x=e/2,this.y=i/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.exploding=!1,this.explosionParticles=[],this.invincible=!0,this.invincibilityTime=_.INVINCIBILITY_TIME}isCollidingWith(e){if(this.isDestroyed||this.invincible)return!1;let i=this.x-e.x,o=this.y-e.y;return Math.sqrt(i*i+o*o)<this.radius+e.radius}hyperspace(){console.log("Hyperspace jump initiated!"),this.lastHyperspace=Date.now(),this.isInHyperspace=!0;let{width:e,height:i}=T(),o=50,s=o+Math.random()*(e-o*2),n=o+Math.random()*(i-o*2);this.x=s,this.y=n,this.velocityX*=.5,this.velocityY*=.5,this.invincible=!0,this.invincibilityTime=_.INVINCIBILITY_TIME,setTimeout(()=>{this.isInHyperspace=!1},100)}},He=pe;function Ge(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function F(t,e){return Math.random()*(e-t)+t}function me(t){let e=t/1e3,i=Math.floor(e/60),o=Math.floor(e%60),s=Math.floor((e-Math.floor(e))*1e3),n=String(i).padStart(2,"0"),r=String(o).padStart(2,"0"),a=String(s).padStart(3,"0");return`${n}:${r}.${a}`}var ge=class t{constructor(e,i,o,s,n="medium",r=1,a=null){let{width:l,height:d}=T();console.log(`Asteroid constructor called with type=${e}, size=${i}, difficulty=${n}, speedMultiplier=${r}, fixedBaseSpeed=${a}`),this.type=e||this.getRandomType(),this.size=i||1,this.difficulty=n,this.speedMultiplier=r,this.fixedBaseSpeed=a,this.radius=E.BASE_RADIUS/this.size,this.x=o!==void 0?o:F(0,l),this.y=s!==void 0?s:F(0,d),console.log(`Creating asteroid: type=${this.type}, size=${this.size}, at (${this.x.toFixed(1)}, ${this.y.toFixed(1)})`);let c;if(a!==null)c=a,console.log(`Using fixed base speed: ${c.toFixed(2)}`);else{let g=this.getSizeCategory();console.log(`No fixed speed, using size category: ${g}`);let y=X[n].asteroidSpeed.medium;c=(y.min+y.max)/2}let u=c*r;console.log(`Final speed with multiplier: ${u.toFixed(2)}`);let m=Math.random()*Math.PI*2;this.velocityX=Math.cos(m)*u,this.velocityY=Math.sin(m)*u,console.log(`Velocity: (${this.velocityX.toFixed(2)}, ${this.velocityY.toFixed(2)})`),this.rotation=0,this.rotationSpeed=F(-1,1)*E.ROTATION_SPEED;let h=this.getImageKey();console.log(`Loading asteroid image: ${h}`),this.image=ke(h),this.image||console.error(`Failed to load image for asteroid type: ${h}`),this.points=E.POINTS_BASE*this.size}getSizeCategory(){switch(this.size){case 1:return"large";case 2:return"medium";case 3:return"small";default:return"large"}}getRandomType(){if(console.log("Getting random asteroid type from:",E.TYPES),!E.TYPES||E.TYPES.length===0)return console.warn('No asteroid types defined, defaulting to "bront"'),"bront";let e=Ge(0,E.TYPES.length-1),i=E.TYPES[e];return console.log(`Selected random asteroid type: ${i} at index ${e}`),i}getImageKey(){return console.log(`Getting image key for type: ${this.type}`),(!this.type||!E.TYPES.includes(this.type))&&(console.warn(`Invalid asteroid type: ${this.type}, defaulting to 'bront'`),this.type="bront"),this.type}update(e){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*e;let{width:i,height:o}=T();this.x<-this.radius&&(this.x=i+this.radius),this.x>i+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=o+this.radius),this.y>o+this.radius&&(this.y=-this.radius)}draw(e){if(e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),this.image){let i=this.radius*2/Math.max(this.image.width,this.image.height),o=this.image.width*i,s=this.image.height*i;e.drawImage(this.image,-o/2,-s/2,o,s)}else e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.strokeStyle="gray",e.stroke();e.restore()}break(){if(this.size>=3)return[];let e=[];if(this.size===1){let i=Math.random();i<.25?this.createChildAsteroids(2,2,e):i<.45?this.createChildAsteroids(2,3,e):i<.75?(this.createChildAsteroids(1,2,e),this.createChildAsteroids(1,3,e)):i<.9?this.createChildAsteroids(1,2,e):this.createChildAsteroids(1,3,e)}else this.size===2&&(Math.random()<.7?this.createChildAsteroids(2,3,e):this.createChildAsteroids(1,3,e));return e}createChildAsteroids(e,i,o){let s=Math.atan2(this.velocityY,this.velocityX);console.log(`Parent asteroid direction angle: ${(s*180/Math.PI).toFixed(2)} degrees`);for(let n=0;n<e;n++){let r=F(-10,10),a=F(-10,10),l=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);console.log(`Parent asteroid speed: ${l.toFixed(2)}`);let d=new t(this.type,i,this.x+r,this.y+a,this.difficulty,this.speedMultiplier,this.fixedBaseSpeed),c=F(-Math.PI/2,Math.PI/2),u=s+c;console.log(`Child asteroid angle offset: ${(c*180/Math.PI).toFixed(2)} degrees`),console.log(`Child asteroid final direction: ${(u*180/Math.PI).toFixed(2)} degrees`);let m=this.fixedBaseSpeed*this.speedMultiplier;console.log(`Child asteroid using fixed speed: ${m.toFixed(2)}`),d.velocityX=Math.cos(u)*m,d.velocityY=Math.sin(u)*m,o.push(d)}}isCollidingWith(e){let i=this.x-e.x,o=this.y-e.y;return Math.sqrt(i*i+o*o)<this.radius+e.radius}},Ye=ge;var ye=class{constructor(e,i,o){this.x=e,this.y=i,this.angle=o,this.velocityX=Math.cos(o)*K.SPEED,this.velocityY=Math.sin(o)*K.SPEED,this.radius=K.RADIUS,this.lifespan=K.LIFESPAN,this.active=!0}update(e){if(!this.active)return!1;if(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.lifespan-=e*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:i,height:o}=T();return this.x<-this.radius||this.x>i+this.radius||this.y<-this.radius||this.y>o+this.radius?(this.active=!1,!1):!0}draw(e){this.active&&(e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle="white",e.fill())}isCollidingWith(e){if(!this.active)return!1;let i=this.x-e.x,o=this.y-e.y;return Math.sqrt(i*i+o*o)<this.radius+e.radius}deactivate(){this.active=!1}},Ue=ye;function Se(t,e,i,o,s){let{width:n,height:r}=T();t.fillStyle="white",t.font="20px Arial",t.textAlign="left",t.fillText(`Score: ${e}`,20,30),t.textAlign="center",t.fillText(`Level: ${o}`,n/2,30),ct(t,i,n-20,30)}function ct(t,e,i,o){for(let s=0;s<e;s++)ht(t,i-s*25,o-5,10)}function ht(t,e,i,o){t.save(),t.translate(e,i),t.rotate(-Math.PI/2),t.strokeStyle="white",t.lineWidth=1.5,t.beginPath(),t.moveTo(o,0),t.lineTo(-o*.7,-o*.7),t.lineTo(-o*.4,0),t.lineTo(-o*.7,o*.7),t.closePath(),t.stroke(),t.restore()}var P="",Te=3,Ee=!1,J=null,we=null,H=null,j=null;function Ae(t,e,i=[],o=1,s=0){let{width:n,height:r}=T();if(B("black"),t.fillStyle="white",t.font="bold 48px Arial",t.textAlign="center",t.fillText("GAME OVER",n/2,r/4),t.font="32px Arial",t.fillText(`Score: ${e}`,n/2,r/4+60),dt(e,i)){t.font="24px Arial",t.fillText("New High Score!",n/2,r/4+100),t.fillText("Enter your initials (up to 3 letters):",n/2,r/4+140),t.font="48px Arial",t.fillStyle="white",t.textAlign="center";let l=P?P+(P.length<Te?"_":""):"_";t.clearRect(n/2-100,r/4+170,200,60),t.fillText(l,n/2,r/4+200),t.font="16px Arial",t.fillText("Press ENTER when done or type up to 3 letters",n/2,r/4+240)}else t.font="24px Arial",t.fillText("Press SPACE to play again",n/2,r/4+120)}function dt(t,e){if(!e||e.length===0||e.length<20)return!0;let i=[...e].sort((s,n)=>n.score-s.score),o=i[i.length-1].score;return t>o}function Xe(t){H=t}function G(t){if(Ee){if(t.key==="Enter"){P.length>0&&J&&(J(P),Be());return}t.key.length===1&&/[A-Za-z]/.test(t.key)?P.length<Te&&(P+=t.key.toUpperCase(),H&&H(),P.length===Te&&J&&setTimeout(()=>{J(P),Be()},1e3)):t.key==="Backspace"&&(P=P.slice(0,-1),H&&H())}else t.code==="Space"&&we&&we()}function Be(){P="",Ee=!1,j&&(clearInterval(j),j=null)}function We(){Ee=!0,P="",H&&!j&&(j=setInterval(()=>{H()},100))}function ze(t){we=t}function Q(t,e,i,o){i&&i.length>0&&(console.log("Leaderboard data keys:",Object.keys(i[0])),console.log("Sample entry:",i[0]));let s=[...i].sort((h,g)=>g.score-h.score).slice(0,20),n=Math.min(s.length,20,Math.floor((o.canvas.height-e-50)/25)),r=500;o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(t-r/2,e,r,n*25+50),o.fillStyle="white",o.font="bold 24px Arial",o.textAlign="center",o.fillText("High Scores",t,e+30);let a=t-r/2+50,l=t-r/2+120,d=t-r/2+190,c=t-r/2+250,u=t-r/2+340,m=t-r/2+430;o.font="16px Arial",o.textAlign="right",o.fillText("Rank",a,e+60),o.fillText("Score",l,e+60),o.fillText("Initials",d,e+60),o.fillText("Level",c,e+60),o.fillText("Date",u,e+60),o.fillText("Time",m,e+60),o.font="16px Arial";for(let h=0;h<n;h++){let g=s[h],y=e+85+h*25;g.isCurrent&&(o.fillStyle="rgba(255, 255, 0, 0.3)",o.fillRect(t-r/2+10,y-15,r-20,20),o.fillStyle="white"),o.textAlign="right",o.fillText(`${h+1}`,a,y),o.fillText(`${g.score}`,l,y),o.fillText(g.initials||"---",d,y),o.fillText(`${g.level||"1"}`,c,y);let $=g.date||g.createdAt||g.created_at;if($)try{let N=new Date($);if(isNaN(N.getTime()))o.fillText("--/--/--",u,y),o.fillText("--:--",m,y);else{let Ze=`${N.getMonth()+1}/${N.getDate()}/${N.getFullYear().toString().substr(2)}`;o.fillText(Ze,u,y);let Pe=N.getHours(),Je=N.getMinutes(),Qe=Pe>=12?"PM":"AM",et=`${Pe%12||12}:${Je.toString().padStart(2,"0")} ${Qe}`;o.fillText(et,m,y)}}catch(N){console.error("Error parsing date:",N,"for score:",g),o.fillText("--/--/--",u,y),o.fillText("--:--",m,y)}else o.fillText("--/--/--",u,y),o.fillText("--:--",m,y)}i.length>n&&(o.textAlign="center",o.font="14px Arial",o.fillText(`Showing ${n} of ${i.length} scores`,t,e+n*25+40))}function Ve(t,e,i,o){let{width:s,height:n}=t.canvas;t.fillStyle="black",t.fillRect(0,0,s,n),M()?ft(t,e,i,o):ut(t,e,i,o)}function ft(t,e,i,o){let{width:s,height:n}=t.canvas;console.log(`Drawing mobile start screen at ${s}x${n}`),t.fillStyle="white",t.font=`bold ${Math.floor(n*.05)}px Arial`,t.textAlign="center",t.fillText("DINOSTROIDS",s*.5,n*.15),t.font=`${Math.floor(n*.03)}px Arial`,t.fillText("SELECT DIFFICULTY:",s*.5,n*.25);let r=["EASY","MEDIUM","DIFFICULT"],a=n*.08,l=n*.02,d=Math.min(s*.8,400),c=n*.3;r.forEach((m,h)=>{let g=c+(a+l)*h,y=m.toLowerCase()===e,$=(s-d)*.5;t.fillStyle=y?"rgba(255, 255, 255, 0.3)":"rgba(255, 255, 255, 0.1)",t.fillRect($,g,d,a),t.strokeStyle="white",t.lineWidth=1,t.strokeRect($,g,d,a),t.fillStyle="white",t.font=`${Math.floor(n*.03)}px Arial`,t.textAlign="center",t.fillText(m,s*.5,g+a*.6)}),t.fillStyle="white",t.font=`${Math.floor(n*.025)}px Arial`,t.textAlign="center";let u=n*.65;t.fillText("TAP DIFFICULTY TO SELECT",s*.5,u),t.fillText("TAP SCREEN TO START",s*.5,u+n*.04),t.fillText("? FOR HELP",s*.5,u+n*.08),i&&i.length>0&&(t.font=`${Math.floor(n*.025)}px Arial`,t.fillText("TOP SCORES:",s*.5,n*.85),i.slice(0,3).forEach((h,g)=>{t.fillText(`${h.initials}: ${h.score}`,s*.5,n*.85+(g+1)*(n*.03))}))}function ut(t,e,i,o){let{width:s,height:n}=T();t.fillStyle="white",t.font="bold 48px Arial",t.textAlign="center",t.fillText("DINOSTROIDS",s/2,n/3),t.font="24px Arial",t.fillText("Select Difficulty:",s/2,n/2-30);let r=[{key:"E",label:"Easy",value:"easy"},{key:"M",label:"Medium",value:"medium"},{key:"D",label:"Difficult",value:"difficult"}],a=n/2+30;r.forEach((l,d)=>{let c=s/2-150+d*150,u=e===l.value;u?(t.fillStyle="rgba(255, 255, 255, 0.2)",t.fillRect(c-65,a-30,130,40),t.font="bold 24px Arial"):t.font="24px Arial",t.fillStyle=u?"#ffffff":"rgba(255, 255, 255, 0.8)",t.fillText(`${l.key}: ${l.label}`,c,a)}),t.font="24px Arial",t.fillStyle="white",t.font="24px Arial",t.fillText("Press RETURN to start",s/2,n*2/3+20),t.fillText("Press ? for help",s/2,n*2/3+60),o>0&&(t.font="16px Arial",t.fillText(`Games Played: ${o}`,s/2,n-80)),t.font="14px Arial",t.fillText("\xA9 Intensity Ventures, 2025",s/2,n-20),i&&i.length>0&&Q(s-300,50,i,t)}var ee=class{constructor(e,i){this.canvas=e,this.ctx=e.getContext("2d"),this.gameController=i,this.buttonRadius=40,this.buttonPadding=20,this.buttons={left:{x:this.buttonPadding+this.buttonRadius,y:e.height-(this.buttonPadding+this.buttonRadius),label:"\u2190"},right:{x:3*this.buttonPadding+3*this.buttonRadius,y:e.height-(this.buttonPadding+this.buttonRadius),label:"\u2192"},shoot:{x:e.width-(3*this.buttonPadding+3*this.buttonRadius),y:e.height-(this.buttonPadding+this.buttonRadius),label:"SHOOT"},thrust:{x:e.width-(this.buttonPadding+this.buttonRadius),y:e.height-(this.buttonPadding+this.buttonRadius),label:"THRUST"},hyperspace:{x:e.width-(2*this.buttonPadding+2*this.buttonRadius),y:e.height-(3*this.buttonPadding+3*this.buttonRadius),label:"HYPER"}},this.activeTouches=new Map,M()&&this.setupTouchEvents()}setupTouchEvents(){this.canvas.addEventListener("touchstart",e=>{e.preventDefault(),Array.from(e.touches).forEach(i=>{let o=this.getButtonAtPosition(i.clientX,i.clientY);o&&(this.activeTouches.set(i.identifier,o),this.handleButtonPress(o))})}),this.canvas.addEventListener("touchend",e=>{e.preventDefault(),Array.from(e.changedTouches).forEach(i=>{let o=this.activeTouches.get(i.identifier);o&&(this.handleButtonRelease(o),this.activeTouches.delete(i.identifier))})}),this.canvas.addEventListener("touchcancel",e=>{e.preventDefault(),Array.from(e.changedTouches).forEach(i=>{let o=this.activeTouches.get(i.identifier);o&&(this.handleButtonRelease(o),this.activeTouches.delete(i.identifier))})})}getButtonAtPosition(e,i){let o=this.canvas.getBoundingClientRect(),s=this.canvas.width/o.width,n=this.canvas.height/o.height,r=(e-o.left)*s,a=(i-o.top)*n;for(let[l,d]of Object.entries(this.buttons))if(Math.sqrt(Math.pow(r-d.x,2)+Math.pow(a-d.y,2))<=this.buttonRadius)return l;return null}handleButtonPress(e){switch(e){case"left":this.gameController.setRotateLeft(!0);break;case"right":this.gameController.setRotateRight(!0);break;case"thrust":this.gameController.setThrusting(!0);break;case"shoot":this.gameController.setFiring(!0);break;case"hyperspace":this.gameController.activateHyperspace();break}}handleButtonRelease(e){switch(e){case"left":this.gameController.setRotateLeft(!1);break;case"right":this.gameController.setRotateRight(!1);break;case"thrust":this.gameController.setThrusting(!1);break;case"shoot":this.gameController.setFiring(!1);break}}draw(){if(M()){this.ctx.save(),this.ctx.globalAlpha=.3,this.ctx.strokeStyle="#00ff00",this.ctx.lineWidth=2,this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(let[e,i]of Object.entries(this.buttons)){let o=Array.from(this.activeTouches.values()).includes(e);this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.buttonRadius,0,Math.PI*2),this.ctx.fillStyle=o?"#00ff00":"#003300",this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="#00ff00",this.ctx.globalAlpha=.8,this.ctx.fillText(i.label,i.x,i.y)}this.ctx.restore()}}};var Y=!1,v=!1,x=!1,C=!1,pt=!1,Ie=0,I=0,O=V.INITIAL_LIVES,D=1,ve=0,L=[],Z=0,Ke=0,qe=null,w="medium",xe=0,A={active:!1,text:"+1 SHIP",x:0,y:0,alpha:0,duration:2e3,startTime:0},f=null,b=[],k=[],S=null;var mt,gt,yt,St,z=1,be=class{constructor(){this.mobileControls=null,this.gameLoop=this.gameLoop.bind(this),this.toggleHelpScreen=this.toggleHelpScreen.bind(this)}showStartScreen(){let{ctx:e}=R();console.log("Showing start screen"),v=!1,C=!1,Y=!1,x=!1,S&&(cancelAnimationFrame(S),S=null),document.removeEventListener("keydown",G),this.cleanupInputHandlers(),this.setupInputHandlers(),B("black"),Ve(e,w,L,ve)}endGame(){console.log("Game ended by user (ESC key)"),v=!1,x=!0,Y=!1,S&&(cancelAnimationFrame(S),S=null),f=null,b=[],k=[],this.showStartScreen()}drawHelpScreen(){let{canvas:e,ctx:i}=R();if(B("black"),M()){i.fillStyle="white",i.font="bold 28px Arial",i.textAlign="center",i.fillText("HOW TO PLAY",e.width/2,e.height*.1),i.font="18px Arial";let o=["CONTROLS:","\u2022 Left/Right buttons to rotate","\u2022 THRUST button to move forward","\u2022 SHOOT button to fire","\u2022 HYPER button for random teleport","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score points to earn extra ships","","TAP ? TO RETURN"],s=e.height*.2,n=e.height*.05;o.forEach((r,a)=>{r.startsWith("\u2022")?(i.textAlign="left",i.fillText(r,e.width*.15,s+a*n)):(i.textAlign="center",i.fillText(r,e.width/2,s+a*n))})}else{i.fillStyle="white",i.font="bold 36px Arial",i.textAlign="center",i.fillText("HOW TO PLAY",e.width/2,100),i.font="20px Arial",i.textAlign="left";let o=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 H: Hyperspace jump (random teleport)","\u2022 ?: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible","","TIPS:","\u2022 Use hyperspace to escape danger","\u2022 You're invincible for 3 seconds after hyperspace"],s=150,n=30;o.forEach((r,a)=>{i.fillText(r,e.width/4,s+a*n)}),i.font="24px Arial",i.textAlign="center",i.fillText("Press ? to return",e.width/2,e.height-50)}}cleanupInputHandlers(){he(null),de(null),fe(null),ue(null)}setupInputHandlers(){this.cleanupInputHandlers(),he(()=>{console.log("Start key pressed"),!C&&!v&&this.startGame()}),de(this.toggleHelpScreen),fe(()=>{v&&!x&&this.endGame()}),ue(e=>{(!v||x)&&(w=e,this.updateDifficultySettings(),this.showStartScreen())})}startGame(){if(C||v||x)return;console.log(`Starting game with ${w} difficulty...`),v=!0,x=!1,Y=!0,I=0,xe=0;let e=X[w];O=e.lives,D=1,z=1,f=new He,f.acceleration=101,w==="medium"?f.acceleration=150:w==="difficult"&&(f.acceleration=200),f.shootCooldown=e.shootCooldown,console.log(`Player acceleration set to: ${f.acceleration}`),this.createAsteroids(e.initialAsteroids),k=[],Ke=Date.now(),Z=0,De().catch(i=>console.error("Failed to increment games played:",i)),Ie=performance.now(),S=requestAnimationFrame(this.gameLoop)}createAsteroids(e){let{width:i,height:o}=T();b=[],console.log(`Creating ${e} asteroids with speed multiplier: ${z}`);let s;w==="easy"?s=1:w==="medium"?s=2.5:s=5;let n=s*z;console.log(`Base speed for ALL asteroids: ${s.toFixed(2)}, With level multiplier: ${n.toFixed(2)}`);for(let r=0;r<e;r++){let a,l,d;do{Math.random()<.5?(a=Math.random()<.5?0:i,l=Math.random()*o):(a=Math.random()*i,l=Math.random()<.5?0:o);let y=f?f.x-a:i/2-a,$=f?f.y-l:o/2-l;d=Math.sqrt(y*y+$*$)}while(f&&d<E.SPAWN_DISTANCE_MIN);let c=E.TYPES[Math.floor(Math.random()*E.TYPES.length)],u=1;console.log(`Creating large asteroid type: ${c}, at (${a}, ${l})`);let m=new Ye(c,u,a,l,w,z,s),h=Math.random()*Math.PI*2,g=n;m.velocityX=Math.cos(h)*g,m.velocityY=Math.sin(h)*g,console.log(`Setting asteroid velocity to (${m.velocityX.toFixed(2)}, ${m.velocityY.toFixed(2)}) with speed: ${g.toFixed(2)}`),b.push(m)}}gameLoop(e){let i=(e-Ie)/1e3;Ie=e;let o=Math.min(i,.1);if(pt||!Y){S=requestAnimationFrame(this.gameLoop);return}Z=Date.now()-Ke,B("black");let{ctx:s,canvas:n}=R();if(f){(f.isDestroyed||f.exploding||f.isInHyperspace)&&console.log(`Player state: destroyed=${f.isDestroyed}, exploding=${f.exploding}, hyperspace=${f.isInHyperspace}`);let r=f.update(o);r&&k.push(new Ue(r.x,r.y,r.rotation)),f.draw(s)}for(let r=k.length-1;r>=0;r--){let a=k[r];if(!a.update(o)){k.splice(r,1);continue}a.draw(s);for(let l=b.length-1;l>=0;l--){let d=b[l];if(a.isCollidingWith(d)){a.deactivate(),k.splice(r,1);let c=d.break();I+=E.SCORE_VALUES[d.size]||100,this.checkExtraLife(I),b.push(...c),b.splice(l,1);break}}}if(b.forEach(r=>{r.update(o),r.draw(s)}),f&&!f.isDestroyed&&!f.exploding&&!f.isInHyperspace&&!f.invincible)for(let r=b.length-1;r>=0;r--){let a=b[r];if(f.isCollidingWith(a)){console.log("Player hit by asteroid!"),f.destroy(),O-=E.COLLISION_DAMAGE,I+=E.SCORE_VALUES[a.size]||100,console.log(`Scored ${E.SCORE_VALUES[a.size]||100} points for asteroid collision`),this.checkExtraLife(I);let l=a.break();b.push(...l),b.splice(r,1),O<=0?setTimeout(()=>{this.handleGameOver()},2e3):setTimeout(()=>{f.reset()},2e3);break}}if(b.length===0&&v&&!x){D++,z*=1.05,console.log(`Level ${D}: Speed multiplier increased to ${z.toFixed(2)}`);let r=Math.min(V.INITIAL_ASTEROIDS+(D-1)*V.ASTEROID_INCREMENT_PER_LEVEL,20);this.createAsteroids(r)}if(Se(s,I,O,D,w),A.active){let r=Date.now()-A.startTime;if(r<A.duration){let a=r/A.duration;A.alpha=a<.5?a*2:2-a*2,A.y-=20*o,s.save(),s.fillStyle="rgba(255, 255, 255, "+A.alpha+")",s.font="bold 24px Arial",s.textAlign="center",s.fillText(A.text,A.x,A.y),s.restore()}else A.active=!1}this.mobileControls&&this.mobileControls.draw(),S=requestAnimationFrame(this.gameLoop)}handleGameOver(){console.log("Game over!"),x=!0,Y=!1,S&&(cancelAnimationFrame(S),S=null);let e=Z;f&&(f=null),b=[],k=[],document.removeEventListener("keydown",G);let i=this.isNewHighScore();console.log(`Game over check - Is high score: ${i}, Score: ${I}`);let{ctx:o}=R(),s=()=>{Ae(o,I,L,D,e)};Xe(s),s(),document.addEventListener("keydown",G),console.log("Added keydown event listener for game over screen"),i?(console.log("New high score detected!"),We(),setTimeout(s,100),onSubmitScore(async n=>{try{console.log(`Submitting high score with initials: ${n}`),await $e(n,I,e,D,w),L=await oe(),document.removeEventListener("keydown",G),x=!1,v=!1,Y=!1,S&&(cancelAnimationFrame(S),S=null),this.showStartScreen()}catch(r){console.error("Failed to submit score:",r),document.removeEventListener("keydown",G),x=!1,S&&(cancelAnimationFrame(S),S=null),this.showStartScreen()}})):ze(()=>{console.log("Restarting game..."),document.removeEventListener("keydown",G),x=!1,v=!1,this.cleanupInputHandlers(),S&&(cancelAnimationFrame(S),S=null),this.showStartScreen()})}isNewHighScore(){if(!L||L.length===0||L.length<20)return!0;let e=[...L].sort((i,o)=>o.score-i.score);return I>e[Math.min(19,e.length-1)].score}toggleHelpScreen(){v||(C=!C,C?this.drawHelpScreen():this.showStartScreen())}initGame(){console.log("Initializing game...");let{canvas:e}=Ce();this.mobileControls=new ee(e,this),window.addEventListener("resize",()=>{if(ie(),!v)C?this.drawHelpScreen():this.showStartScreen();else if(x){let{ctx:i}=R();Ae(i,I,L)}}),Fe(),this.setupInputHandlers(),_e(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{ve=await Oe()}catch(i){console.error("Failed to fetch games played:",i)}})(),(async()=>{try{L=await oe()}catch(i){console.error("Failed to fetch leaderboard:",i)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),this.showStartScreen()})})}getGameState(){return{gameRunning:Y,isGameStarted:v,isGameOver:x,isHelpScreenVisible:C,score:I,lives:O,level:D,gamesPlayedCount:ve,leaderboardData:L}}updateDifficultySettings(){let e=X[w];mt=e.shootCooldown,gt=e.asteroidSpeed,yt=e.initialAsteroids,St=e.lives}changeDifficulty(e){(!v||x)&&(w=e,this.updateDifficultySettings(),C||this.showStartScreen())}drawHUD(){let{ctx:e}=R();e.fillStyle="white",e.font="24px Arial",e.textAlign="left",e.fillText(`Score: ${I}`,20,30);let i=me(Z);e.fillText(`Time: ${i}`,20,60),e.font="24px Arial",e.fillText(`Lives: ${O}`,20,90),e.font="24px Arial",e.fillText(`Difficulty: ${w.charAt(0).toUpperCase()+w.slice(1)}`,20,120)}drawGameOverScreen(){let{ctx:e}=R();e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",e.canvas.width/2,80),e.font="24px Arial",e.textAlign="center",e.fillText(`Score: ${I}`,e.canvas.width/2,150),e.fillText(`Time: ${me(Z)}`,e.canvas.width/2,190),e.fillText(`Difficulty: ${w.charAt(0).toUpperCase()+w.slice(1)}`,e.canvas.width/2,230),e.font="24px Arial",e.textAlign="center",e.fillText("Press SPACE to play again",e.canvas.width/2,e.canvas.height-100),Q(e.canvas.width/2,e.canvas.height-80)}cleanupGame(){qe&&cancelAnimationFrame(qe)}getAsteroidSpeed(e){let i=X[w].asteroidSpeed[e];return i.min+Math.random()*(i.max-i.min)}updateHUD(){let{ctx:e}=R();Se(e,I,O,D,w)}checkExtraLife(e){let i=V.EXTRA_LIFE_SCORE_THRESHOLD,o=Math.floor(xe/i)*i;Math.floor(e/i)*i>o&&(O++,xe=e,console.log(`BONUS SHIP! Extra life awarded at ${e} points. Lives: ${O}`),this.startExtraLifeAnimation())}startExtraLifeAnimation(){let{width:e}=T();A.active=!0,A.x=e-100,A.y=90,A.alpha=0,A.startTime=Date.now()}},Tt=new be,je=()=>Tt.initGame();Re();document.addEventListener("DOMContentLoaded",()=>{je()});
