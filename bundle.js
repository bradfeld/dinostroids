var fe="@vercel/analytics",he="1.5.0",ue=()=>{window.va||(window.va=function(...n){(window.vaq=window.vaq||[]).push(n)})};function K(){return typeof window<"u"}function Q(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function ge(t="auto"){if(t==="auto"){window.vam=Q();return}window.vam=t}function me(){return(K()?window.vam:Q())||"production"}function Y(){return me()==="development"}function we(t){return t.scriptSrc?t.scriptSrc:Y()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function j(t={debug:!0}){var n;if(!K())return;ge(t.mode),ue(),t.beforeSend&&((n=window.va)==null||n.call(window,"beforeSend",t.beforeSend));let i=we(t);if(document.head.querySelector(`script[src*="${i}"]`))return;let o=document.createElement("script");o.src=i,o.defer=!0,o.dataset.sdkn=fe+(t.framework?`/${t.framework}`:""),o.dataset.sdkv=he,t.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),t.endpoint?o.dataset.endpoint=t.endpoint:t.basePath&&(o.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(o.dataset.dsn=t.dsn),o.onerror=()=>{let a=Y()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${i}. ${a}`)},Y()&&t.debug===!1&&(o.dataset.debug="false"),document.head.appendChild(o)}j();var s=document.getElementById("gameCanvas"),e=s.getContext("2d");s.width=window.innerWidth;s.height=window.innerHeight;var M=Math.PI*2;var xe=20,pe=.07*3,k=.1,ye=.98,se=3e3,Te=2,Se=8,Ae=50,N=120,F=.6*3,V=1.6*3,oe={large:45,medium:25,small:15},X={easy:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},medium:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},difficult:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}}},W=10,A={easy:{playerAcceleration:k,shootCooldown:N,asteroidMinSpeed:F,asteroidSpeedVariation:V,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:k*1.5,shootCooldown:Math.floor(N*.7),asteroidMinSpeed:F*1.5,asteroidSpeedVariation:V*1.2,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:k*2,shootCooldown:Math.floor(N*.5),asteroidMinSpeed:F*2,asteroidSpeedVariation:V*1.5,initialAsteroidCountBase:4,lives:2}},$="medium",ve=A.medium.playerAcceleration,ae=A.medium.shootCooldown,Ee=A.medium.asteroidMinSpeed,Ie=A.medium.asteroidSpeedVariation,be=A.medium.initialAsteroidCountBase,ee=A.medium.lives,q={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},Ne={[q.BIG]:{baseSize:45,score:20},[q.MEDIUM]:{baseSize:25,score:50},[q.LITTLE]:{baseSize:15,score:100}};var b={small:"images/bront.png",medium:"images/steg.png",large:"images/trex.png"},le={},te=!1,P=0,ie=Object.keys(b).length;function Re(t){console.log("Preloading images..."),Object.keys(b).forEach(n=>{let i=new Image;i.onload=()=>{console.log(`Image loaded: ${b[n]}`),P++,le[n]=i,P===ie&&(console.log("All images successfully preloaded."),te=!0,t&&t())},i.onerror=()=>{console.error(`Failed to load image: ${b[n]}`),P++,P===ie&&(console.warn("Finished processing images, some failed to load."),te=!0,t&&t())},i.src=b[n]})}var r={x:s.width/2,y:s.height/2,angle:-Math.PI/2,speed:0,rotationSpeed:pe,acceleration:k,friction:ye,size:xe,canShoot:!0,lastShotTime:0,isInvulnerable:!1},u=[],m=[],v=0,O=3,D=1,_=!0;var R=!1,L=!1,h=null,g=null,C=!1,H=class{constructor(n,i,o){this.sizeType=n,this.x=i,this.y=o,this.radius=oe[this.sizeType],this.size=this.radius,this.speed=Math.random()*(X[$][this.sizeType].max-X[$][this.sizeType].min)+X[$][this.sizeType].min,this.angle=Math.random()*M,this.rotation=Math.random()*M,this.rotationSpeed=(Math.random()-.5)*.05,this.image=le[this.sizeType],this.image||console.error(`Image not loaded for sizeType: ${this.sizeType}. Asteroid may not render correctly.`)}draw(){if(this.x+this.radius<0||this.x-this.radius>s.width||this.y+this.radius<0||this.y-this.radius>s.height)return;if(!this.image){e.beginPath(),e.arc(this.x,this.y,this.radius,0,M),e.strokeStyle="grey",e.stroke();return}e.save(),e.translate(this.x,this.y),e.rotate(this.rotation);let n=this.image.naturalWidth/this.image.naturalHeight,i=this.radius*2,o,a;n>1?(o=i,a=i/n):(a=i,o=i*n);let l=-o/2,c=-a/2;e.drawImage(this.image,l,c,o,a),e.restore()}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.rotation+=this.rotationSpeed,Z(this)}},U=class{constructor(n,i,o){this.x=n,this.y=i,this.angle=o,this.speed=Se,this.radius=Te,this.size=this.radius,this.lifespan=Ae}draw(){this.x<-this.radius||this.x>s.width+this.radius||this.y<-this.radius||this.y>s.height+this.radius||(e.beginPath(),e.arc(this.x,this.y,this.radius,0,M),e.fillStyle="white",e.fill())}update(){return this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.lifespan--,this.lifespan>0&&this.x>=-this.radius&&this.x<=s.width+this.radius&&this.y>=-this.radius&&this.y<=s.height+this.radius}},S={};document.addEventListener("keydown",t=>{if(S[t.key]=!0,t.key==="?"&&(R=!R,t.preventDefault()),!L&&!R){let n=t.key.toLowerCase(),i=null;n==="e"?i="easy":n==="m"?i="medium":n==="d"&&(i="difficult"),i&&(ke(i),$e(),t.preventDefault())}t.key==="Escape"&&L&&!R&&(_&&ce(),t.preventDefault())});document.addEventListener("keyup",t=>{S[t.key]=!1});function Z(t){let n=typeof t.radius<"u"?t.radius:t.size;t.x<-n&&(t.x=s.width+n),t.x>s.width+n&&(t.x=-n),t.y<-n&&(t.y=s.height+n),t.y>s.height+n&&(t.y=-n)}function G(t="large",n=null,i=null){let o=oe[t],a=r.size+o+100;if(n===null||i===null){let c=0;do n=o+Math.random()*(s.width-2*o),i=o+Math.random()*(s.height-2*o),c++;while(c<50&&Math.sqrt(Math.pow(n-r.x,2)+Math.pow(i-r.y,2))<a);c>=50&&console.warn("Could not find a safe spawn location far from the player after 50 attempts. Spawning anyway."),console.log(`Spawning ${t} asteroid randomly inside canvas at (${n.toFixed(1)}, ${i.toFixed(1)})`)}else console.log(`Spawning split ${t} asteroid at provided location (${n.toFixed(1)}, ${i.toFixed(1)})`);let l=new H(t,n,i);m.push(l),console.log(`Asteroids array length: ${m.length}`)}function ne(t,n){let i=t.x-n.x,o=t.y-n.y,a=Math.sqrt(i*i+o*o),l=typeof t.radius<"u"?t.radius:t.size,c=typeof n.radius<"u"?n.radius:n.size;return a<l+c}async function ce(){_=!1;let t=v;await re();let n=!1;h&&!g?h.length<W?n=t>0:n=t>h[h.length-1].score:g&&console.error("Cannot check leaderboard qualification due to fetch error.");let i=null,o=!1,a=null;if(n){for(;;){if(i=prompt(`You made the leaderboard! Score: ${t}
Enter your initials (1-3 characters):`),i===null){i=null;break}if(i=i.trim().toUpperCase(),i.length>0&&i.length<=3)break;alert("Please enter 1 to 3 characters for your initials.")}if(i)try{o=await De(i,t),o&&await re()}catch(w){a=w.message}}e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.textAlign="center",e.textBaseline="middle";let l=s.width/2,c=s.height/2;e.font="48px Arial",e.fillText("GAME OVER",l,c-150),e.font="30px Arial",e.fillText(`Final Score: ${t}`,l,c-100),e.font="20px Arial",n?i?o?e.fillText("Score submitted to leaderboard!",l,c-60):a?(e.fillText(`Submission Error: ${a}`,l,c-60),e.fillText("Your score was not saved.",l,c-30)):e.fillText("Score qualified, but was not submitted.",l,c-60):e.fillText("You qualified, but did not enter initials.",l,c-60):g?e.fillText("Could not check leaderboard ranking.",l,c-60):e.fillText("Better luck next time!",l,c-60),e.font="20px Arial",e.fillText("Returning to Title Screen...",l,c+150),setTimeout(()=>{J()},3e3)}async function De(t,n){console.log(`Submitting score: ${t} - ${n}`);try{let i=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:n})});if(!i.ok){let a=await i.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${i.status} ${a.message||""}`)}let o=await i.json();return console.log("Submission result:",o.message),!0}catch(i){throw console.error("Error submitting score:",i),i}}async function z(t){if(R){Pe(),requestAnimationFrame(z);return}if(!L){Me(),requestAnimationFrame(z);return}if(e.clearRect(0,0,s.width,s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height),S.ArrowLeft&&(r.angle-=r.rotationSpeed),S.ArrowRight&&(r.angle+=r.rotationSpeed),S.ArrowUp?r.speed+=r.acceleration:r.speed*=r.friction,S[" "]&&r.canShoot){let i=r.x+Math.cos(r.angle)*r.size,o=r.y+Math.sin(r.angle)*r.size;u.push(new U(i,o,r.angle)),r.canShoot=!1,r.lastShotTime=t}!r.canShoot&&t-r.lastShotTime>ae&&(r.canShoot=!0),r.x+=Math.cos(r.angle)*r.speed,r.y+=Math.sin(r.angle)*r.speed,Z(r);for(let i=u.length-1;i>=0;i--)u[i].update()||u.splice(i,1);Oe(),e.fillStyle="white",e.font="20px Arial",e.textBaseline="top",e.textAlign="left",e.fillText("Level: "+D,10,10),e.textAlign="center",e.fillText("Score: "+v,s.width/2,10),e.textAlign="right",e.fillText("Lives: "+O,s.width-10,10),Le();for(let i of u)i.draw();let n=[];for(let i of m)n.push(i.draw());try{await Promise.all(n)}catch(i){console.error("Error during asteroid drawing batch:",i)}requestAnimationFrame(z)}function Le(){e.save(),e.translate(r.x,r.y),e.rotate(r.angle),e.beginPath(),e.moveTo(r.size,0),e.lineTo(-r.size*.7,r.size*.7),e.lineTo(-r.size*.4,0),e.lineTo(-r.size*.7,-r.size*.7),e.closePath(),e.strokeStyle="cyan",e.lineWidth=2,e.stroke(),S.ArrowUp&&(e.beginPath(),e.moveTo(-r.size*.5,0),e.lineTo(-r.size*.9,r.size*.4),e.lineTo(-r.size*1.2,0),e.lineTo(-r.size*.9,-r.size*.4),e.closePath(),e.fillStyle="orange",e.fill()),e.restore()}function Pe(){e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.font="32px Arial",e.textAlign="center",e.textBaseline="middle";let t=s.width/2,n=s.height/2-100,i=40;e.fillText("Controls",t,n),e.font="20px Arial",e.fillText("Arrow Left: Rotate Left",t,n+i*1.5),e.fillText("Arrow Right: Rotate Right",t,n+i*2.5),e.fillText("Arrow Up: Thrust",t,n+i*3.5),e.fillText("Spacebar: Shoot",t,n+i*4.5),e.fillText("?: Toggle Help / Pause",t,n+i*5.5),e.fillText("Esc: End Game",t,n+i*6.5),e.font="24px Arial",e.fillText("Press ? to close",t,n+i*8.5)}async function re(){C=!0,g=null;try{let t=await fetch("/api/leaderboard");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);h=await t.json()}catch(t){console.error("Failed to fetch leaderboard:",t),g=t.message}finally{C=!1}}function Me(){e.clearRect(0,0,s.width,s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.textAlign="center";let t=s.width/2,n=s.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,n);let i=n+100,o=i+40,a=25;e.font="32px Arial",e.fillText("TOP SCORES",t,i),e.font="16px Arial",e.textBaseline="top";let l=o;if(C)e.fillText("Loading...",t,o),l+=a;else if(g)e.fillText(`Error loading scores: ${g}`,t,o),l+=a;else if(h&&h.length>0){let w=t-180,E=t-100,I=t+50,x=t+110,f=o;e.textAlign="left",e.fillText("Rank",w,f),e.fillText("Initials",E,f),e.textAlign="right",e.fillText("Score",I+40,f),e.textAlign="left",e.fillText("Date",x,f),e.font="14px Arial",h.forEach((p,y)=>{if(y>=W)return;let d=f+a*(y+1.5);e.textAlign="left",e.fillText(`${y+1}.`,w,d),e.fillText(p.initials,E,d),e.textAlign="right",e.fillText(p.score.toLocaleString(),I+40,d),e.textAlign="left";try{let T=new Date(p.createdAt),B=`${T.toLocaleDateString()} ${T.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(B,x,d)}catch{e.fillText("Invalid Date",x,d)}l=d+a})}else e.fillText("No scores yet! Be the first!",t,o),l+=a;let c=l+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,s.height-50),e.font="16px Arial",e.fillText("(c) Intensity Ventures, 2025",t,s.height-20)}function ke(t){$=t;let n=A[t];ve=n.playerAcceleration,ae=n.shootCooldown,Ee=n.asteroidMinSpeed,Ie=n.asteroidSpeedVariation,be=n.initialAsteroidCountBase,ee=n.lives,O=ee,console.log(`Difficulty set to: ${t}`)}function $e(){L||(L=!0,_=!0,v=0,D=1,r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,u=[],m=[],de())}function J(){console.log("Initializing game..."),resizeCanvas(),window.addEventListener("resize",resizeCanvas),Re(()=>{console.log("Image preloading complete, proceeding with game setup."),ze()})}function ze(){e.clearRect(0,0,s.width,s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.textAlign="center";let t=s.width/2,n=s.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,n);let i=n+100,o=i+40,a=25;e.font="32px Arial",e.fillText("TOP SCORES",t,i),e.font="16px Arial",e.textBaseline="top";let l=o;if(C)e.fillText("Loading...",t,o),l+=a;else if(g)e.fillText(`Error loading scores: ${g}`,t,o),l+=a;else if(h&&h.length>0){let w=t-180,E=t-100,I=t+50,x=t+110,f=o;e.textAlign="left",e.fillText("Rank",w,f),e.fillText("Initials",E,f),e.textAlign="right",e.fillText("Score",I+40,f),e.textAlign="left",e.fillText("Date",x,f),e.font="14px Arial",h.forEach((p,y)=>{if(y>=W)return;let d=f+a*(y+1.5);e.textAlign="left",e.fillText(`${y+1}.`,w,d),e.fillText(p.initials,E,d),e.textAlign="right",e.fillText(p.score.toLocaleString(),I+40,d),e.textAlign="left";try{let T=new Date(p.createdAt),B=`${T.toLocaleDateString()} ${T.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(B,x,d)}catch{e.fillText("Invalid Date",x,d)}l=d+a})}else e.fillText("No scores yet! Be the first!",t,o),l+=a;let c=l+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,s.height-50),e.font="16px Arial",e.fillText("(c) Intensity Ventures, 2025",t,s.height-20)}function de(){m=[],u=[];let t=5+D*2;console.log(`Level ${D}: Spawning ${t} asteroids.`);for(let n=0;n<t;n++)G("large");r.isInvulnerable=!0,setTimeout(()=>{r.isInvulnerable=!1},se)}window.addEventListener("resize",()=>{s.width=window.innerWidth,s.height=window.innerHeight,r&&(r.x>s.width+r.size&&(r.x=s.width/2),r.y>s.height+r.size&&(r.y=s.height/2))});J();requestAnimationFrame(z);function Oe(){for(let t=m.length-1;t>=0;t--){let n=m[t],i=!1;_&&!r.isInvulnerable&&ne(r,n)&&_e();for(let o=u.length-1;o>=0;o--){let a=u[o];if(ne(a,n)){u.splice(o,1),Ce(n,t),i=!0;break}}i||(n.update(),Z(n))}}function Ce(t,n){switch(m.splice(n,1),t.sizeType){case"large":v+=20;for(let i=0;i<2;i++)G("medium",t.x,t.y);break;case"medium":v+=50;for(let i=0;i<2;i++)G("small",t.x,t.y);break;case"small":v+=100;break}m.length===0&&(D++,de())}function _e(){if(!r.isInvulnerable){if(O--,O<=0){ce();return}r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,r.isInvulnerable=!0,setTimeout(()=>{r.isInvulnerable=!1},se)}}J();
