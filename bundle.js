var Fe="@vercel/analytics",He="1.5.0",Be=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function he(){return typeof window<"u"}function de(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function Ue(e="auto"){if(e==="auto"){window.vam=de();return}window.vam=e}function Ye(){return(he()?window.vam:de())||"production"}function U(){return Ye()==="development"}function Ve(e){return e.scriptSrc?e.scriptSrc:U()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function fe(e={debug:!0}){var t;if(!he())return;Ue(e.mode),Be(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));let i=Ve(e);if(document.head.querySelector(`script[src*="${i}"]`))return;let o=document.createElement("script");o.src=i,o.defer=!0,o.dataset.sdkn=Fe+(e.framework?`/${e.framework}`:""),o.dataset.sdkv=He,e.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),e.endpoint?o.dataset.endpoint=e.endpoint:e.basePath&&(o.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(o.dataset.dsn=e.dsn),o.onerror=()=>{let r=U()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${i}. ${r}`)},U()&&e.debug===!1&&(o.dataset.debug="false"),document.head.appendChild(o)}var h,A;function ue(){return h=document.getElementById("gameCanvas"),A=h.getContext("2d"),Y(),{canvas:h,ctx:A}}function P(){return{canvas:h,ctx:A}}function Y(){h&&(console.log("Resizing canvas to fit window..."),h.width=window.innerWidth,h.height=window.innerHeight)}function x(e="black"){!A||!h||(A.clearRect(0,0,h.width,h.height),A.fillStyle=e,A.fillRect(0,0,h.width,h.height))}function c(){return h?{width:h.width,height:h.height}:{width:0,height:0}}async function me(){console.log("Fetching global games played count...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),i=await fetch("/api/gamesPlayed",{signal:e.signal,cache:"no-store"});if(clearTimeout(t),!i.ok)throw console.warn(`API returned error status: ${i.status}`),new Error(`HTTP error! status: ${i.status}`);let o=await i.json();return typeof o.count=="number"?(console.log(`Global games played count: ${o.count}`),o.count):(console.warn("Received invalid count from API."),50)}catch(e){return e.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",e),console.log("Using fallback games played count: 50"),50}}async function ge(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),i=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:e.signal,cache:"no-store"});return clearTimeout(t),i.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${i.status}`),!1)}catch(e){return e.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",e),!1}}async function V(){console.log("Fetching leaderboard data...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),i=await fetch("/api/leaderboard",{signal:e.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(t),!i.ok)throw console.warn(`Leaderboard API returned error status: ${i.status}`),new Error(`HTTP error! status: ${i.status}`);let o=await i.json();return console.log("Leaderboard data received:",o.length?`${o.length} entries`:"Empty array"),o.length>0&&console.log("First entry:",JSON.stringify(o[0])),o}catch(e){return console.error("Failed to fetch leaderboard:",e),[]}finally{console.log("Leaderboard fetch completed")}}async function pe(e,t){console.log(`Submitting score: ${e} - ${t}`);try{let i=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:e,score:t})});if(!i.ok){let r=await i.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${i.status} ${r.message||""}`)}let o=await i.json();return console.log("Submission result:",o.message),!0}catch(i){throw console.error("Error submitting score:",i),i}}var _={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},w={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},R={RADIUS:2,SPEED:500,LIFESPAN:1e3},p={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var Z={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var st=Math.PI*2;var at=.07*3,W=.18*3;var X=120,z=.6*3,K=1.6*3;var lt={easy:{playerAcceleration:W,shootCooldown:X,asteroidMinSpeed:z,asteroidSpeedVariation:K,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:W*1.5,shootCooldown:Math.floor(X*.7),asteroidMinSpeed:z*1.5,asteroidSpeedVariation:K*1.2,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:W*2,shootCooldown:Math.floor(X*.5),asteroidMinSpeed:z*2,asteroidSpeedVariation:K*1.5,initialAsteroidCountBase:4,lives:2}},q={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},ct={[q.BIG]:{baseSize:45,score:20},[q.MEDIUM]:{baseSize:25,score:50},[q.LITTLE]:{baseSize:15,score:100}};var Se={};function Ee(e){console.log("Preloading dinosaur images...");let t=0,i=Object.keys(Z).length,o=()=>{console.log("All dinosaur images loaded successfully!"),e&&e()},r=n=>{console.log(`${n} dinosaur image loaded.`),t++,t===i&&o()},s=(n,a)=>{console.error(`Error loading ${n} dinosaur image:`,a),t++,t===i&&o()};Object.entries(Z).forEach(([n,a])=>{let l=new Image;l.onload=()=>r(n),l.onerror=m=>s(n,m),l.src=a,Se[n]=l})}function ye(e){return Se[e]||null}var ee={},j=null,J=null,Q=null;function Ie(){window.addEventListener("keydown",We),window.addEventListener("keyup",Xe)}function We(e){ee[e.code]=!0,e.code==="Space"&&j&&j(),(e.code==="KeyH"||e.key==="h")&&J&&J(),e.code==="Escape"&&Q&&Q()}function Xe(e){ee[e.code]=!1}function D(e){return ee[e]===!0}function Te(e){j=e}function Ae(e){J=e}function we(e){Q=e}var te=class{constructor(){let{width:t,height:i}=c();this.x=t/2,this.y=i/2,this.radius=w.RADIUS,this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=w.ROTATION_SPEED,this.acceleration=w.ACCELERATION,this.friction=w.FRICTION,this.canShoot=!0,this.shootCooldown=w.SHOOT_COOLDOWN,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0}update(t){if(this.isDestroyed)return null;if(this.invincible&&(this.invincibilityTime-=t,this.invincibilityTime<=0&&(this.invincible=!1)),D("ArrowLeft")&&(this.rotation-=this.rotationSpeed*t),D("ArrowRight")&&(this.rotation+=this.rotationSpeed*t),this.isThrusting=D("ArrowUp"),this.isThrusting){let s=Math.cos(this.rotation)*this.acceleration*t,n=Math.sin(this.rotation)*this.acceleration*t;this.velocityX+=s,this.velocityY+=n}this.velocityX*=1-this.friction*t,this.velocityY*=1-this.friction*t,this.x+=this.velocityX,this.y+=this.velocityY;let{width:i,height:o}=c();this.x<0&&(this.x=i),this.x>i&&(this.x=0),this.y<0&&(this.y=o),this.y>o&&(this.y=0);let r=null;if(D("Space")&&this.canShoot&&!this.isDestroyed){let s=Date.now();s-this.lastShot>this.shootCooldown&&(r={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=s)}return r}draw(t){if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(this.radius,0),t.lineTo(-this.radius*.7,-this.radius*.7),t.lineTo(-this.radius*.5,0),t.lineTo(-this.radius*.7,this.radius*.7),t.closePath(),t.stroke(),this.isThrusting){t.beginPath(),t.moveTo(-this.radius*.5,0),t.lineTo(-this.radius*1.5,0);let i=Math.random()*.5+.5;t.lineTo(-this.radius*(1+i),.5*this.radius*i),t.lineTo(-this.radius*.5,0),t.fillStyle="orange",t.fill()}t.restore()}}destroy(){this.isDestroyed=!0}reset(){let{width:t,height:i}=c();this.x=t/2,this.y=i/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.invincible=!0,this.invincibilityTime=w.INVINCIBILITY_TIME}isCollidingWith(t){if(this.isDestroyed||this.invincible)return!1;let i=this.x-t.x,o=this.y-t.y;return Math.sqrt(i*i+o*o)<this.radius+t.radius}},ve=te;function Le(e,t){return Math.floor(Math.random()*(t-e+1))+e}function g(e,t){return Math.random()*(t-e)+e}var ie=class e{constructor(t,i,o,r){let{width:s,height:n}=c();this.type=t||this.getRandomType(),this.size=i||1,this.radius=p.BASE_RADIUS/this.size,this.x=o!==void 0?o:g(0,s),this.y=r!==void 0?r:g(0,n);let a=p.SPEED_MULTIPLIER*this.size;this.velocityX=g(-1,1)*a,this.velocityY=g(-1,1)*a,this.rotation=0,this.rotationSpeed=g(-1,1)*p.ROTATION_SPEED;let l=this.getImageKey();this.image=ye(l),this.points=p.POINTS_BASE*this.size}getRandomType(){let t=["bront","steg","trex"];return t[Le(0,t.length-1)]}getImageKey(){return this.type}update(t){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*t;let{width:i,height:o}=c();this.x<-this.radius&&(this.x=i+this.radius),this.x>i+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=o+this.radius),this.y>o+this.radius&&(this.y=-this.radius)}draw(t){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),this.image){let i=this.radius*2/Math.max(this.image.width,this.image.height),o=this.image.width*i,r=this.image.height*i;t.drawImage(this.image,-o/2,-r/2,o,r)}else t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.strokeStyle="gray",t.stroke();t.restore()}break(){if(this.size>=3)return[];let t=this.size+1,i=[];for(let o=0;o<2;o++){let r=g(-10,10),s=g(-10,10),n=new e(this.type,t,this.x+r,this.y+s);n.velocityX=this.velocityX+g(-1,1),n.velocityY=this.velocityY+g(-1,1),i.push(n)}return i}isCollidingWith(t){let i=this.x-t.x,o=this.y-t.y;return Math.sqrt(i*i+o*o)<this.radius+t.radius}},Oe=ie;var oe=class{constructor(t,i,o){this.x=t,this.y=i,this.angle=o,this.velocityX=Math.cos(o)*R.SPEED,this.velocityY=Math.sin(o)*R.SPEED,this.radius=R.RADIUS,this.lifespan=R.LIFESPAN,this.active=!0}update(t){if(!this.active)return!1;if(this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.lifespan-=t*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:i,height:o}=c();return this.x<-this.radius||this.x>i+this.radius||this.y<-this.radius||this.y>o+this.radius?(this.active=!1,!1):!0}draw(t){this.active&&(t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="white",t.fill())}isCollidingWith(t){if(!this.active)return!1;let i=this.x-t.x,o=this.y-t.y;return Math.sqrt(i*i+o*o)<this.radius+t.radius}deactivate(){this.active=!1}},Pe=oe;function xe(e,t,i,o){let{width:r,height:s}=c();e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${t}`,20,30),e.textAlign="center",e.fillText(`Level: ${o}`,r/2,30),ze(e,i,r-20,30)}function ze(e,t,i,o){e.textAlign="right",e.fillText("Lives: ",i-30,o);for(let r=0;r<t;r++)Ke(e,i-r*25,o-5,10)}function Ke(e,t,i,o){e.save(),e.translate(t,i),e.strokeStyle="white",e.lineWidth=1.5,e.beginPath(),e.moveTo(o,0),e.lineTo(-o*.7,-o*.7),e.lineTo(-o*.4,0),e.lineTo(-o*.7,o*.7),e.closePath(),e.stroke(),e.restore()}var S="",re=3,N=!1,ne=null,se=null;function M(e,t,i=[]){let{width:o,height:r}=c();if(x("black"),e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",o/2,r/4),e.font="32px Arial",e.fillText(`Score: ${t}`,o/2,r/4+60),Ze(t,i)){e.font="24px Arial",e.fillText("New High Score!",o/2,r/4+100),e.fillText("Enter your initials:",o/2,r/4+140);let n=120,a=40,l=o/2-n/2,m=r/4+160;e.strokeStyle="white",e.lineWidth=2,e.strokeRect(l,m,n,a),e.font="32px Arial",e.fillText(S+(N?"_":""),o/2,m+30),S.length===re&&(e.font="24px Arial",e.fillText("Press ENTER to submit",o/2,m+80))}else e.font="24px Arial",e.fillText("Press SPACE to play again",o/2,r/4+120);i&&i.length>0&&qe(e,i,o,r)}function qe(e,t,i,o){e.font="bold 32px Arial",e.fillText("TOP SCORES",i/2,o/2);let r=[...t].sort((n,a)=>a.score-n.score).slice(0,5);e.font="20px Arial",e.textAlign="left";let s=i/2-100;r.forEach((n,a)=>{let l=o/2+40+a*30;e.fillText(`${a+1}. ${n.initials}`,s,l),e.textAlign="right",e.fillText(`${n.score}`,s+200,l),e.textAlign="left"})}function Ze(e,t){if(!t||t.length===0||t.length<5)return!0;let i=[...t].sort((o,r)=>r.score-o.score);return e>i[4].score}function _e(e){N?e.key.length===1&&/[A-Za-z]/.test(e.key)?S.length<re&&(S+=e.key.toUpperCase()):e.key==="Backspace"?S=S.slice(0,-1):e.key==="Enter"&&S.length===re&&(ne&&ne(S),je()):e.code==="Space"&&se&&se()}function je(){S="",N=!1}function be(){N=!0}function Re(e){ne=e}function De(e){se=e}function Ne(e,t,i,o){if(!t||t.length===0)return;let{height:r}=c(),s=[...t].sort((T,O)=>O.score-T.score).slice(0,20);e.font="16px Arial",e.fillStyle="white",e.textAlign="left",e.font="bold 18px Arial",e.fillText("HIGH SCORES",i,o);let n=22,a=Math.min(Math.floor((r-o-30)/n),20,s.length),l=10,m=180,$e=n*a+35;e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(i-l,o-20,m,$e),e.fillStyle="white";for(let T=0;T<a;T++){let O=s[T],F=o+25+T*n,H="";if(O.createdAt)try{let B=new Date(O.createdAt);H=`${B.getMonth()+1}/${B.getDate()}`}catch{}e.textAlign="left",e.fillText(`${T+1}. ${O.initials||"???"}`,i,F),e.textAlign="right",e.fillText(`${O.score}`,i+120,F),H&&(e.font="12px Arial",e.fillText(H,i+160,F),e.font="16px Arial")}s.length>a&&(e.textAlign="center",e.font="14px Arial",e.fillText("...",i+80,o+25+a*n)),e.textAlign="left"}var $=!1,y=!1,L=!1,b=!1,Je=!1,ae=0,I=0,C=_.INITIAL_LIVES,k=1,le=0,f=[],d=null,u=[],v=[],E=null;function G(){let{canvas:e,ctx:t}=P();x("black"),t.fillStyle="white",t.font="bold 48px Arial",t.textAlign="center",t.fillText("DINOSTROIDS",e.width/2,e.height/3),t.font="24px Arial",t.fillText("Press SPACE to start",e.width/2,e.height/2),t.fillText("Press H for help",e.width/2,e.height/2+40),le>0&&(t.font="16px Arial",t.fillText(`Games Played: ${le}`,e.width/2,e.height-50)),t.font="14px Arial",t.fillText("\xA9 Intensity Ventures, 2025",e.width/2,e.height-20),f&&f.length>0&&Ne(t,f,e.width-200,50)}function Qe(){console.log("Game ended by user (ESC key)"),y=!1,L=!1,$=!1,E&&(cancelAnimationFrame(E),E=null),d=null,u=[],v=[],G()}function Me(){let{canvas:e,ctx:t}=P();x("black"),t.fillStyle="white",t.font="bold 36px Arial",t.textAlign="center",t.fillText("HOW TO PLAY",e.width/2,100),t.font="20px Arial",t.textAlign="left";let i=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 H: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible"],o=150,r=30;i.forEach((s,n)=>{t.fillText(s,e.width/4,o+n*r)}),t.font="24px Arial",t.textAlign="center",t.fillText("Press H to return",e.width/2,e.height-50)}function Ce(){b||y||L||(console.log("Starting game..."),y=!0,L=!1,$=!0,I=0,C=_.INITIAL_LIVES,k=1,d=new ve,ke(_.INITIAL_ASTEROIDS),v=[],ge().catch(e=>console.error("Failed to increment games played:",e)),ae=performance.now(),E=requestAnimationFrame(ce))}function ke(e){let{width:t,height:i}=c();u=[];for(let o=0;o<e;o++){let r,s,n;do{r=Math.random()*t,s=Math.random()*i;let l=d?d.x-r:t/2-r,m=d?d.y-s:i/2-s;n=Math.sqrt(l*l+m*m)}while(n<p.SPAWN_DISTANCE_MIN);let a=new Oe(null,1,r,s);u.push(a)}}function ce(e){let t=(e-ae)/1e3;if(ae=e,Je||!$){E=requestAnimationFrame(ce);return}x("black");let{ctx:i,canvas:o}=P();if(d){let r=d.update(t);r&&v.push(new Pe(r.x,r.y,r.rotation)),d.draw(i)}for(let r=v.length-1;r>=0;r--){let s=v[r];if(!s.update(t)){v.splice(r,1);continue}s.draw(i);for(let n=u.length-1;n>=0;n--){let a=u[n];if(s.isCollidingWith(a)){s.deactivate(),v.splice(r,1);let l=a.break();I+=p.SCORE_VALUES[a.size]||100,u.push(...l),u.splice(n,1);break}}}if(u.forEach(r=>{r.update(t),r.draw(i)}),d&&!d.isDestroyed)for(let r=u.length-1;r>=0;r--){let s=u[r];if(d.isCollidingWith(s)){d.destroy(),C-=p.COLLISION_DAMAGE,C<=0?et():setTimeout(()=>{d.reset()},1e3);break}}if(u.length===0&&y&&!L){k++;let r=Math.min(_.INITIAL_ASTEROIDS+(k-1)*_.ASTEROID_INCREMENT_PER_LEVEL,20);ke(r)}xe(i,I,C,k),E=requestAnimationFrame(ce)}function et(){console.log("Game over!"),L=!0,$=!1,E&&(cancelAnimationFrame(E),E=null);let{ctx:e}=P();M(e,I,f),tt()&&(be(),Re(async i=>{try{await pe(i,I),f=await V(),M(e,I,f)}catch(o){console.error("Failed to submit score:",o)}})),De(()=>{Ce()}),document.addEventListener("keydown",_e)}function tt(){if(!f||f.length===0||f.length<10)return!0;let e=[...f].sort((t,i)=>i.score-t.score);return I>e[Math.min(9,e.length-1)].score}function it(){y||(b=!b,b?Me():G())}function Ge(){console.log("Initializing game...");let{canvas:e}=ue();window.addEventListener("resize",()=>{if(Y(),!y)b?Me():G();else if(L){let{ctx:t}=P();M(t,I,f)}}),Ie(),Te(()=>{!y&&!b&&Ce()}),Ae(()=>{it()}),we(()=>{y&&!L&&Qe()}),Ee(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{le=await me()}catch(t){console.error("Failed to fetch games played:",t)}})(),(async()=>{try{f=await V()}catch(t){console.error("Failed to fetch leaderboard:",t)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),G()})})}fe();document.addEventListener("DOMContentLoaded",()=>{Ge()});
