var oe="@vercel/analytics",le="1.5.0",ce=()=>{window.va||(window.va=function(...i){(window.vaq=window.vaq||[]).push(i)})};function W(){return typeof window<"u"}function X(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function de(t="auto"){if(t==="auto"){window.vam=X();return}window.vam=t}function fe(){return(W()?window.vam:X())||"production"}function D(){return fe()==="development"}function he(t){return t.scriptSrc?t.scriptSrc:D()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Z(t={debug:!0}){var i;if(!W())return;de(t.mode),ce(),t.beforeSend&&((i=window.va)==null||i.call(window,"beforeSend",t.beforeSend));let s=he(t);if(document.head.querySelector(`script[src*="${s}"]`))return;let a=document.createElement("script");a.src=s,a.defer=!0,a.dataset.sdkn=oe+(t.framework?`/${t.framework}`:""),a.dataset.sdkv=le,t.disableAutoTrack&&(a.dataset.disableAutoTrack="1"),t.endpoint?a.dataset.endpoint=t.endpoint:t.basePath&&(a.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(a.dataset.dsn=t.dsn),a.onerror=()=>{let l=D()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${s}. ${l}`)},D()&&t.debug===!1&&(a.dataset.debug="false"),document.head.appendChild(a)}Z();var r=document.getElementById("gameCanvas"),e=r.getContext("2d");r.width=window.innerWidth;r.height=window.innerHeight;var F=Math.PI*2;var ue=15,xe=.07*3,E=.18*3,ye=.98,Q=3e3,me=2,ge=8,we=50,$=120,z=.6*3,O=1.6*3,j={large:45,medium:25,small:15},C={easy:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},medium:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},difficult:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}}},ee=10,m={easy:{playerAcceleration:E,shootCooldown:$,asteroidMinSpeed:z,asteroidSpeedVariation:O,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:E*1.5,shootCooldown:Math.floor($*.7),asteroidMinSpeed:z*1.5,asteroidSpeedVariation:O*1.2,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:E*2,shootCooldown:Math.floor($*.5),asteroidMinSpeed:z*2,asteroidSpeedVariation:O*1.5,initialAsteroidCountBase:4,lives:2}},b="medium",pe=m.medium.playerAcceleration,te=m.medium.shootCooldown,Se=m.medium.asteroidMinSpeed,Te=m.medium.asteroidSpeedVariation,Ae=m.medium.initialAsteroidCountBase,J=m.medium.lives,_={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},ze={[_.BIG]:{baseSize:45,score:20},[_.MEDIUM]:{baseSize:25,score:50},[_.LITTLE]:{baseSize:15,score:100}};var B=[[{x:.8,y:-.6},{x:1,y:-.4},{x:.9,y:0},{x:.5,y:.3},{x:.2,y:.8},{x:-.5,y:.7},{x:-1,y:.5},{x:-.8,y:0},{x:-.9,y:-.3},{x:-.4,y:-.6},{x:0,y:-.7},{x:.3,y:-.6},{x:.6,y:-.8}],[{x:.5,y:-.9},{x:.9,y:-.7},{x:.6,y:-.2},{x:.9,y:.1},{x:.5,y:.3},{x:.4,y:.8},{x:-.3,y:.9},{x:-.8,y:.6},{x:-1,y:0},{x:-.8,y:-.3},{x:-.9,y:-.6},{x:-.7,y:-.7},{x:-.3,y:-.8},{x:.2,y:-.3},{x:.3,y:-.5},{x:.1,y:-.8}],[{x:.4,y:-.8},{x:.8,y:-.6},{x:1,y:-.7},{x:.6,y:0},{x:.8,y:.4},{x:.3,y:.1},{x:.9,y:.9},{x:.5,y:1},{x:0,y:.5},{x:-.6,y:.8},{x:-1,y:.6},{x:-.7,y:.1},{x:-.5,y:.3},{x:-.6,y:-.5},{x:-.4,y:-.6},{x:0,y:-.3}]],n={x:r.width/2,y:r.height/2,angle:-Math.PI/2,speed:0,rotationSpeed:xe,acceleration:E,friction:ye,size:ue,canShoot:!0,lastShotTime:0,isInvulnerable:!1},d=[],f=[],x=0,A=3,p=1,k=!0;var w=!1,S=!1,h=null,y=null,N=!1,Y=class{constructor(i,s,a){switch(this.sizeType=i,this.x=s,this.y=a,this.radius=j[this.sizeType],this.size=this.radius,this.speed=Math.random()*(C[b][this.sizeType].max-C[b][this.sizeType].min)+C[b][this.sizeType].min,this.angle=Math.random()*F,this.rotation=Math.random()*F,this.rotationSpeed=(Math.random()-.5)*.05,this.sizeType){case"large":this.vertices=B[1];break;case"medium":this.vertices=B[2];break;case"small":this.vertices=B[0];break}}draw(){if(console.log(`Drawing asteroid at (${this.x.toFixed(1)}, ${this.y.toFixed(1)}) with radius ${this.radius}`),!(this.x+this.radius<0||this.x-this.radius>r.width||this.y+this.radius<0||this.y-this.radius>r.height)){e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.beginPath(),e.moveTo(this.vertices[0].x*this.radius,this.vertices[0].y*this.radius);for(let i=1;i<this.vertices.length;i++)e.lineTo(this.vertices[i].x*this.radius,this.vertices[i].y*this.radius);e.closePath(),e.strokeStyle="white",e.lineWidth=2,e.stroke(),e.restore()}}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.rotation+=this.rotationSpeed}},V=class{constructor(i,s,a){this.x=i,this.y=s,this.angle=a,this.speed=ge,this.radius=me,this.size=this.radius,this.lifespan=we}draw(){this.x<-this.radius||this.x>r.width+this.radius||this.y<-this.radius||this.y>r.height+this.radius||(e.beginPath(),e.arc(this.x,this.y,this.radius,0,F),e.fillStyle="white",e.fill())}update(){return this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.lifespan--,this.lifespan>0&&this.x>=-this.radius&&this.x<=r.width+this.radius&&this.y>=-this.radius&&this.y<=r.height+this.radius}},u={};document.addEventListener("keydown",t=>{if(u[t.key]=!0,t.key==="?"&&(w=!w,t.preventDefault()),!S&&!w){let i=t.key.toLowerCase(),s=null;i==="e"?s="easy":i==="m"?s="medium":i==="d"&&(s="difficult"),s&&(ke(s),Me(),t.preventDefault())}t.key==="Escape"&&S&&!w&&(k&&ne(),t.preventDefault())});document.addEventListener("keyup",t=>{u[t.key]=!1});function ie(t){let i=typeof t.radius<"u"?t.radius:t.size;t.x<-i&&(t.x=r.width+i),t.x>r.width+i&&(t.x=-i),t.y<-i&&(t.y=r.height+i),t.y>r.height+i&&(t.y=-i)}function q(t="large",i=null,s=null){let a=j[t],l=n.size+a+100;if(i===null||s===null){let c=0;do i=a+Math.random()*(r.width-2*a),s=a+Math.random()*(r.height-2*a),c++;while(c<50&&Math.sqrt(Math.pow(i-n.x,2)+Math.pow(s-n.y,2))<l);c>=50&&console.warn("Could not find a safe spawn location far from the player after 50 attempts. Spawning anyway."),console.log(`Spawning ${t} asteroid randomly inside canvas at (${i.toFixed(1)}, ${s.toFixed(1)})`)}else console.log(`Spawning split ${t} asteroid at provided location (${i.toFixed(1)}, ${s.toFixed(1)})`);let o=new Y(t,i,s);f.push(o),console.log(`Asteroids array length: ${f.length}`)}function K(t,i){let s=t.x-i.x,a=t.y-i.y,l=Math.sqrt(s*s+a*a),o=typeof t.radius<"u"?t.radius:t.size,c=typeof i.radius<"u"?i.radius:i.size;return l<o+c}async function ne(){k=!1;let t=x;await U();let i=!1;h&&!y?h.length<ee?i=t>0:i=t>h[h.length-1].score:y&&console.error("Cannot check leaderboard qualification due to fetch error.");let s=null,a=!1,l=null;if(i){for(;;){if(s=prompt(`You made the leaderboard! Score: ${t}
Enter your initials (1-3 characters):`),s===null){s=null;break}if(s=s.trim().toUpperCase(),s.length>0&&s.length<=3)break;alert("Please enter 1 to 3 characters for your initials.")}if(s)try{a=await ve(s,t),a&&await U()}catch(v){l=v.message}}e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.textAlign="center",e.textBaseline="middle";let o=r.width/2,c=r.height/2;e.font="48px Arial",e.fillText("GAME OVER",o,c-150),e.font="30px Arial",e.fillText(`Final Score: ${t}`,o,c-100),e.font="20px Arial",i?s?a?e.fillText("Score submitted to leaderboard!",o,c-60):l?(e.fillText(`Submission Error: ${l}`,o,c-60),e.fillText("Your score was not saved.",o,c-30)):e.fillText("Score qualified, but was not submitted.",o,c-60):e.fillText("You qualified, but did not enter initials.",o,c-60):y?e.fillText("Could not check leaderboard ranking.",o,c-60):e.fillText("Better luck next time!",o,c-60),e.font="20px Arial",e.fillText("Returning to Title Screen...",o,c+150),setTimeout(()=>{se()},3e3)}async function ve(t,i){console.log(`Submitting score: ${t} - ${i}`);try{let s=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:i})});if(!s.ok){let l=await s.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${s.status} ${l.message||""}`)}let a=await s.json();return console.log("Submission result:",a.message),!0}catch(s){throw console.error("Error submitting score:",s),s}}function I(t){if(w){be(),requestAnimationFrame(I);return}if(!S){Ie(),requestAnimationFrame(I);return}if(e.clearRect(0,0,r.width,r.height),e.fillStyle="black",e.fillRect(0,0,r.width,r.height),u.ArrowLeft&&(n.angle-=n.rotationSpeed),u.ArrowRight&&(n.angle+=n.rotationSpeed),u.ArrowUp?n.speed+=n.acceleration:n.speed*=n.friction,u[" "]&&n.canShoot){let i=n.x+Math.cos(n.angle)*n.size,s=n.y+Math.sin(n.angle)*n.size;d.push(new V(i,s,n.angle)),n.canShoot=!1,n.lastShotTime=t}!n.canShoot&&t-n.lastShotTime>te&&(n.canShoot=!0),n.x+=Math.cos(n.angle)*n.speed,n.y+=Math.sin(n.angle)*n.speed,ie(n);for(let i=d.length-1;i>=0;i--)d[i].update()||d.splice(i,1);Pe(),e.fillStyle="white",e.font="20px Arial",e.textBaseline="top",e.textAlign="left",e.fillText("Level: "+p,10,10),e.textAlign="center",e.fillText("Score: "+x,r.width/2,10),e.textAlign="right",e.fillText("Lives: "+A,r.width-10,10),Ee();for(let i of d)i.draw();for(let i of f)i.draw();requestAnimationFrame(I)}function Ee(){e.save(),e.translate(n.x,n.y),e.rotate(n.angle),e.beginPath(),e.moveTo(n.size,0),e.lineTo(-n.size*.7,n.size*.7),e.lineTo(-n.size*.4,0),e.lineTo(-n.size*.7,-n.size*.7),e.closePath(),e.strokeStyle="cyan",e.lineWidth=2,e.stroke(),u.ArrowUp&&(e.beginPath(),e.moveTo(-n.size*.5,0),e.lineTo(-n.size*.9,n.size*.4),e.lineTo(-n.size*1.2,0),e.lineTo(-n.size*.9,-n.size*.4),e.closePath(),e.fillStyle="orange",e.fill()),e.restore()}function be(){e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.font="32px Arial",e.textAlign="center",e.textBaseline="middle";let t=r.width/2,i=r.height/2-100,s=40;e.fillText("Controls",t,i),e.font="20px Arial",e.fillText("Arrow Left: Rotate Left",t,i+s*1.5),e.fillText("Arrow Right: Rotate Right",t,i+s*2.5),e.fillText("Arrow Up: Thrust",t,i+s*3.5),e.fillText("Spacebar: Shoot",t,i+s*4.5),e.fillText("?: Toggle Help / Pause",t,i+s*5.5),e.fillText("Esc: End Game",t,i+s*6.5),e.font="24px Arial",e.fillText("Press ? to close",t,i+s*8.5)}async function U(){N=!0,y=null;try{let t=await fetch("/api/leaderboard");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);h=await t.json()}catch(t){console.error("Failed to fetch leaderboard:",t),y=t.message}finally{N=!1}}function Ie(){e.clearRect(0,0,r.width,r.height),e.fillStyle="black",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.textAlign="center";let t=r.width/2,i=r.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,i);let s=i+100,a=s+40,l=25;e.font="32px Arial",e.fillText("TOP SCORES",t,s),e.font="16px Arial",e.textBaseline="top";let o=a;if(N)e.fillText("Loading...",t,a),o+=l;else if(y)e.fillText(`Error loading scores: ${y}`,t,a),o+=l;else if(h&&h.length>0){let v=t-180,H=t-100,G=t+50,M=t+110,T=a;e.textAlign="left",e.fillText("Rank",v,T),e.fillText("Initials",H,T),e.textAlign="right",e.fillText("Score",G+40,T),e.textAlign="left",e.fillText("Date",M,T),e.font="14px Arial",h.forEach((P,R)=>{if(R>=ee)return;let g=T+l*(R+1.5);e.textAlign="left",e.fillText(`${R+1}.`,v,g),e.fillText(P.initials,H,g),e.textAlign="right",e.fillText(P.score.toLocaleString(),G+40,g),e.textAlign="left";try{let L=new Date(P.createdAt),ae=`${L.toLocaleDateString()} ${L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(ae,M,g)}catch{e.fillText("Invalid Date",M,g)}o=g+l})}else e.fillText("No scores yet! Be the first!",t,a),o+=l;let c=o+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,r.height-50),e.font="16px Arial",e.fillText("(c) Brad Feld, 2025",t,r.height-20)}function ke(t){b=t;let i=m[t];pe=i.playerAcceleration,te=i.shootCooldown,Se=i.asteroidMinSpeed,Te=i.asteroidSpeedVariation,Ae=i.initialAsteroidCountBase,J=i.lives,A=J,console.log(`Difficulty set to: ${t}`)}function Me(){S||(S=!0,k=!0,x=0,p=1,n.x=r.width/2,n.y=r.height/2,n.speed=0,n.angle=-Math.PI/2,d=[],f=[],re())}function se(){x=0,A=3,p=1,S=!1,w=!1,n.x=r.width/2,n.y=r.height/2,n.speed=0,n.angle=-Math.PI/2,d=[],f=[],U()}function re(){f=[],d=[];let t=5+p*2;console.log(`Level ${p}: Spawning ${t} asteroids.`);for(let i=0;i<t;i++)q("large");n.isInvulnerable=!0,setTimeout(()=>{n.isInvulnerable=!1},Q)}window.addEventListener("resize",()=>{r.width=window.innerWidth,r.height=window.innerHeight,n&&(n.x>r.width+n.size&&(n.x=r.width/2),n.y>r.height+n.size&&(n.y=r.height/2))});se();requestAnimationFrame(I);function Pe(){for(let t=f.length-1;t>=0;t--){let i=f[t],s=!1;k&&!n.isInvulnerable&&K(n,i)&&Le();for(let a=d.length-1;a>=0;a--){let l=d[a];if(K(l,i)){d.splice(a,1),Re(i,t),s=!0;break}}s||(i.update(),ie(i))}}function Re(t,i){switch(f.splice(i,1),t.sizeType){case"large":x+=20;for(let s=0;s<2;s++)q("medium",t.x,t.y);break;case"medium":x+=50;for(let s=0;s<2;s++)q("small",t.x,t.y);break;case"small":x+=100;break}f.length===0&&(p++,re())}function Le(){if(!n.isInvulnerable){if(A--,A<=0){ne();return}n.x=r.width/2,n.y=r.height/2,n.speed=0,n.angle=-Math.PI/2,n.isInvulnerable=!0,setTimeout(()=>{n.isInvulnerable=!1},Q)}}
