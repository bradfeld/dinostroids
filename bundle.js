var ge="@vercel/analytics",me="1.5.0",we=()=>{window.va||(window.va=function(...n){(window.vaq=window.vaq||[]).push(n)})};function K(){return typeof window<"u"}function Q(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function xe(t="auto"){if(t==="auto"){window.vam=Q();return}window.vam=t}function pe(){return(K()?window.vam:Q())||"production"}function N(){return pe()==="development"}function ye(t){return t.scriptSrc?t.scriptSrc:N()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function j(t={debug:!0}){var n;if(!K())return;xe(t.mode),we(),t.beforeSend&&((n=window.va)==null||n.call(window,"beforeSend",t.beforeSend));let i=ye(t);if(document.head.querySelector(`script[src*="${i}"]`))return;let o=document.createElement("script");o.src=i,o.defer=!0,o.dataset.sdkn=ge+(t.framework?`/${t.framework}`:""),o.dataset.sdkv=me,t.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),t.endpoint?o.dataset.endpoint=t.endpoint:t.basePath&&(o.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(o.dataset.dsn=t.dsn),o.onerror=()=>{let l=N()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${i}. ${l}`)},N()&&t.debug===!1&&(o.dataset.debug="false"),document.head.appendChild(o)}j();var s=document.getElementById("gameCanvas"),e=s.getContext("2d");s.width=window.innerWidth;s.height=window.innerHeight;var P=Math.PI*2;var ee=Math.PI/18,Te=20,$=.1,Se=.98,le=3e3,Ae=2,ve=8,Ie=50,Y=120,F=.6*3,V=1.6*3,ae={large:45,medium:25,small:15},H={easy:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},medium:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},difficult:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}}},W=10,I={easy:{playerAcceleration:$*.67,shootCooldown:Y,asteroidMinSpeed:F*.67,asteroidSpeedVariation:V*.67,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:$*1,shootCooldown:Math.floor(Y*.7),asteroidMinSpeed:F*1,asteroidSpeedVariation:V*.8,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:$*1.33,shootCooldown:Math.floor(Y*.5),asteroidMinSpeed:F*1.33,asteroidSpeedVariation:V*1,initialAsteroidCountBase:4,lives:2}},z="medium",Ee=I.medium.playerAcceleration,ce=I.medium.shootCooldown,be=I.medium.asteroidMinSpeed,Re=I.medium.asteroidSpeedVariation,Me=I.medium.initialAsteroidCountBase,te=I.medium.lives,X={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},He={[X.BIG]:{baseSize:45,score:20},[X.MEDIUM]:{baseSize:25,score:50},[X.LITTLE]:{baseSize:15,score:100}};var M={small:"images/bront.png",medium:"images/steg.png",large:"images/trex.png"},de={},ie=!1,L=0,ne=Object.keys(M).length;function ke(t){console.log("Preloading images..."),Object.keys(M).forEach(n=>{let i=new Image;i.onload=()=>{console.log(`Image loaded: ${M[n]}`),L++,de[n]=i,L===ne&&(console.log("All images successfully preloaded."),ie=!0,t&&t())},i.onerror=()=>{console.error(`Failed to load image: ${M[n]}`),L++,L===ne&&(console.warn("Finished processing images, some failed to load."),ie=!0,t&&t())},i.src=M[n]})}var r={x:s.width/2,y:s.height/2,angle:-Math.PI/2,speed:0,acceleration:$,friction:Se,size:Te,canShoot:!0,lastShotTime:0,isInvulnerable:!1},h=[],g=[],A=0,C=3,E=1,D=!0;var v=!1,m=!1,u=null,w=null,_=!1,q=class{constructor(n,i,o){this.sizeType=n,this.x=i,this.y=o,this.radius=ae[this.sizeType],this.size=this.radius,this.speed=Math.random()*(H[z][this.sizeType].max-H[z][this.sizeType].min)+H[z][this.sizeType].min,this.angle=Math.random()*P,this.rotation=Math.random()*P,this.rotationSpeed=(Math.random()-.5)*.05,this.image=de[this.sizeType],this.image||console.error(`Image not loaded for sizeType: ${this.sizeType}. Asteroid may not render correctly.`)}draw(){if(this.x+this.radius<0||this.x-this.radius>s.width||this.y+this.radius<0||this.y-this.radius>s.height)return;if(!this.image){e.beginPath(),e.arc(this.x,this.y,this.radius,0,P),e.strokeStyle="grey",e.stroke();return}e.save(),e.translate(this.x,this.y),e.rotate(this.rotation);let n=this.image.naturalWidth/this.image.naturalHeight,i=this.radius*2,o,l;n>1?(o=i,l=i/n):(l=i,o=i*n);let a=-o/2,c=-l/2;e.drawImage(this.image,a,c,o,l),e.restore()}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.rotation+=this.rotationSpeed,Z(this)}},U=class{constructor(n,i,o){this.x=n,this.y=i,this.angle=o,this.speed=ve,this.radius=Ae,this.size=this.radius,this.lifespan=Ie}draw(){this.x<-this.radius||this.x>s.width+this.radius||this.y<-this.radius||this.y>s.height+this.radius||(e.beginPath(),e.arc(this.x,this.y,this.radius,0,P),e.fillStyle="white",e.fill())}update(){return this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.lifespan--,this.lifespan>0&&this.x>=-this.radius&&this.x<=s.width+this.radius&&this.y>=-this.radius&&this.y<=s.height+this.radius}},k={};window.addEventListener("keydown",t=>{if(k[t.key]=!0,t.key==="?"&&(Ye(),t.preventDefault()),!m&&!v){let n=t.key.toLowerCase(),i=null;n==="e"?i="easy":n==="m"?i="medium":n==="d"&&(i="difficult"),i&&(Oe(i),Ce(),t.preventDefault())}m&&!v&&(t.key==="ArrowLeft"?r.angle-=ee:t.key==="ArrowRight"&&(r.angle+=ee)),t.key==="Escape"&&m&&Pe(),t.key===" "&&t.preventDefault()});window.addEventListener("keyup",t=>{k[t.key]=!1});function Z(t){let n=typeof t.radius<"u"?t.radius:t.size;t.x<-n&&(t.x=s.width+n),t.x>s.width+n&&(t.x=-n),t.y<-n&&(t.y=s.height+n),t.y>s.height+n&&(t.y=-n)}function G(t="large",n=null,i=null){let o=ae[t],l=r.size+o+100;if(n===null||i===null){let c=0;do n=o+Math.random()*(s.width-2*o),i=o+Math.random()*(s.height-2*o),c++;while(c<50&&Math.sqrt(Math.pow(n-r.x,2)+Math.pow(i-r.y,2))<l);c>=50&&console.warn("Could not find a safe spawn location far from the player after 50 attempts. Spawning anyway."),console.log(`Spawning ${t} asteroid randomly inside canvas at (${n.toFixed(1)}, ${i.toFixed(1)})`)}else console.log(`Spawning split ${t} asteroid at provided location (${n.toFixed(1)}, ${i.toFixed(1)})`);let a=new q(t,n,i);g.push(a),console.log(`Asteroids array length: ${g.length}`)}function re(t,n){let i=t.x-n.x,o=t.y-n.y,l=Math.sqrt(i*i+o*o),a=typeof t.radius<"u"?t.radius:t.size,c=typeof n.radius<"u"?n.radius:n.size;return l<a+c}async function De(){D=!1;let t=A;await se();let n=!1;u&&!w?u.length<W?n=t>0:n=t>u[u.length-1].score:w&&console.error("Cannot check leaderboard qualification due to fetch error.");let i=null,o=!1,l=null;if(n){for(;;){if(i=prompt(`You made the leaderboard! Score: ${t}
Enter your initials (1-3 characters):`),i===null){i=null;break}if(i=i.trim().toUpperCase(),i.length>0&&i.length<=3)break;alert("Please enter 1 to 3 characters for your initials.")}if(i)try{o=await Le(i,t),o&&await se()}catch(x){l=x.message}}e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.textAlign="center",e.textBaseline="middle";let a=s.width/2,c=s.height/2;e.font="48px Arial",e.fillText("GAME OVER",a,c-150),e.font="30px Arial",e.fillText(`Final Score: ${t}`,a,c-100),e.font="20px Arial",n?i?o?e.fillText("Score submitted to leaderboard!",a,c-60):l?(e.fillText(`Submission Error: ${l}`,a,c-60),e.fillText("Your score was not saved.",a,c-30)):e.fillText("Score qualified, but was not submitted.",a,c-60):e.fillText("You qualified, but did not enter initials.",a,c-60):w?e.fillText("Could not check leaderboard ranking.",a,c-60):e.fillText("Better luck next time!",a,c-60),e.font="20px Arial",e.fillText("Returning to Title Screen...",a,c+150),setTimeout(()=>{J()},3e3)}async function Le(t,n){console.log(`Submitting score: ${t} - ${n}`);try{let i=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:n})});if(!i.ok){let l=await i.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${i.status} ${l.message||""}`)}let o=await i.json();return console.log("Submission result:",o.message),!0}catch(i){throw console.error("Error submitting score:",i),i}}function Pe(){console.log("Returning to main menu via Esc key..."),m=!1,D=!1,g=[],h=[],r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,r.canShoot=!0,A=0,E=1}async function O(t){if(v){fe(),requestAnimationFrame(O);return}if(!m){ze(),requestAnimationFrame(O);return}if(e.clearRect(0,0,s.width,s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height),k.ArrowUp?r.speed+=r.acceleration:r.speed*=r.friction,k[" "]&&r.canShoot){let i=r.x+Math.cos(r.angle)*r.size,o=r.y+Math.sin(r.angle)*r.size;h.push(new U(i,o,r.angle)),r.canShoot=!1,r.lastShotTime=t}!r.canShoot&&t-r.lastShotTime>ce&&(r.canShoot=!0),r.x+=Math.cos(r.angle)*r.speed,r.y+=Math.sin(r.angle)*r.speed,Z(r);for(let i=h.length-1;i>=0;i--)h[i].update()||h.splice(i,1);_e(),e.fillStyle="white",e.font="20px Arial",e.textBaseline="top",e.textAlign="left",e.fillText("Level: "+E,10,10),e.textAlign="center",e.fillText("Score: "+A,s.width/2,10),e.textAlign="right",e.fillText("Lives: "+C,s.width-10,10),$e();for(let i of h)i.draw();let n=[];for(let i of g)n.push(i.draw());try{await Promise.all(n)}catch(i){console.error("Error during asteroid drawing batch:",i)}requestAnimationFrame(O)}function $e(){e.save(),e.translate(r.x,r.y),e.rotate(r.angle),e.beginPath(),e.moveTo(r.size,0),e.lineTo(-r.size*.7,r.size*.7),e.lineTo(-r.size*.4,0),e.lineTo(-r.size*.7,-r.size*.7),e.closePath(),e.strokeStyle="cyan",e.lineWidth=2,e.stroke(),k.ArrowUp&&(e.beginPath(),e.moveTo(-r.size*.5,0),e.lineTo(-r.size*.9,r.size*.4),e.lineTo(-r.size*1.2,0),e.lineTo(-r.size*.9,-r.size*.4),e.closePath(),e.fillStyle="orange",e.fill()),e.restore()}function fe(){e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.font="32px Arial",e.textAlign="center",e.textBaseline="middle";let t=s.width/2,n=s.height/2-100,i=40;e.fillText("Controls",t,n),e.font="20px Arial",e.fillText("Arrow Left: Rotate Left",t,n+i*1.5),e.fillText("Arrow Right: Rotate Right",t,n+i*2.5),e.fillText("Arrow Up: Thrust",t,n+i*3.5),e.fillText("Spacebar: Shoot",t,n+i*4.5),e.fillText("?: Toggle Help / Pause",t,n+i*5.5),e.fillText("Esc: End Game",t,n+i*6.5),e.font="24px Arial",e.fillText("Press ? to close",t,n+i*8.5)}async function se(){_=!0,w=null;try{let t=await fetch("/api/leaderboard");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);u=await t.json()}catch(t){console.error("Failed to fetch leaderboard:",t),w=t.message}finally{_=!1}}function ze(){e.clearRect(0,0,s.width,s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.textAlign="center";let t=s.width/2,n=s.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,n);let i=n+100,o=i+40,l=25;e.font="32px Arial",e.fillText("TOP SCORES",t,i),e.font="16px Arial",e.textBaseline="top";let a=o;if(_)e.fillText("Loading...",t,o),a+=l;else if(w)e.fillText(`Error loading scores: ${w}`,t,o),a+=l;else if(u&&u.length>0){let x=t-180,b=t-100,R=t+50,p=t+110,f=o;e.textAlign="left",e.fillText("Rank",x,f),e.fillText("Initials",b,f),e.textAlign="right",e.fillText("Score",R+40,f),e.textAlign="left",e.fillText("Date",p,f),e.font="14px Arial",u.forEach((y,T)=>{if(T>=W)return;let d=f+l*(T+1.5);e.textAlign="left",e.fillText(`${T+1}.`,x,d),e.fillText(y.initials,b,d),e.textAlign="right",e.fillText(y.score.toLocaleString(),R+40,d),e.textAlign="left";try{let S=new Date(y.createdAt),B=`${S.toLocaleDateString()} ${S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(B,p,d)}catch{e.fillText("Invalid Date",p,d)}a=d+l})}else e.fillText("No scores yet! Be the first!",t,o),a+=l;let c=a+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,s.height-50),e.font="16px Arial",e.fillText("(c) Intensity Ventures, 2025",t,s.height-20)}function Oe(t){z=t;let n=I[t];Ee=n.playerAcceleration,ce=n.shootCooldown,be=n.asteroidMinSpeed,Re=n.asteroidSpeedVariation,Me=n.initialAsteroidCountBase,te=n.lives,C=te,console.log(`Difficulty set to: ${t}`)}function Ce(){m||(m=!0,D=!0,A=0,E=1,r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,h=[],g=[],ue())}function oe(){console.log("Resizing canvas..."),s.width=window.innerWidth,s.height=window.innerHeight,v?fe():m||he()}function J(){console.log("Initializing game..."),oe(),window.addEventListener("resize",oe),ke(()=>{console.log("Image preloading complete, proceeding with game setup."),he()})}function he(){e.clearRect(0,0,s.width,s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height),e.fillStyle="white",e.textAlign="center";let t=s.width/2,n=s.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,n);let i=n+100,o=i+40,l=25;e.font="32px Arial",e.fillText("TOP SCORES",t,i),e.font="16px Arial",e.textBaseline="top";let a=o;if(_)e.fillText("Loading...",t,o),a+=l;else if(w)e.fillText(`Error loading scores: ${w}`,t,o),a+=l;else if(u&&u.length>0){let x=t-180,b=t-100,R=t+50,p=t+110,f=o;e.textAlign="left",e.fillText("Rank",x,f),e.fillText("Initials",b,f),e.textAlign="right",e.fillText("Score",R+40,f),e.textAlign="left",e.fillText("Date",p,f),e.font="14px Arial",u.forEach((y,T)=>{if(T>=W)return;let d=f+l*(T+1.5);e.textAlign="left",e.fillText(`${T+1}.`,x,d),e.fillText(y.initials,b,d),e.textAlign="right",e.fillText(y.score.toLocaleString(),R+40,d),e.textAlign="left";try{let S=new Date(y.createdAt),B=`${S.toLocaleDateString()} ${S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(B,p,d)}catch{e.fillText("Invalid Date",p,d)}a=d+l})}else e.fillText("No scores yet! Be the first!",t,o),a+=l;let c=a+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,s.height-50),e.font="16px Arial",e.fillText("(c) Intensity Ventures, 2025",t,s.height-20)}function ue(){g=[],h=[];let t=5+E*2;console.log(`Level ${E}: Spawning ${t} asteroids.`);for(let n=0;n<t;n++)G("large");r.isInvulnerable=!0,setTimeout(()=>{r.isInvulnerable=!1},le)}window.addEventListener("resize",()=>{s.width=window.innerWidth,s.height=window.innerHeight,r&&(r.x>s.width+r.size&&(r.x=s.width/2),r.y>s.height+r.size&&(r.y=s.height/2))});J();requestAnimationFrame(O);function _e(){for(let t=g.length-1;t>=0;t--){let n=g[t],i=!1;D&&!r.isInvulnerable&&re(r,n)&&Ne();for(let o=h.length-1;o>=0;o--){let l=h[o];if(re(l,n)){h.splice(o,1),Be(n,t),i=!0;break}}i||(n.update(),Z(n))}}function Be(t,n){switch(g.splice(n,1),t.sizeType){case"large":A+=20;for(let i=0;i<2;i++)G("medium",t.x,t.y);break;case"medium":A+=50;for(let i=0;i<2;i++)G("small",t.x,t.y);break;case"small":A+=100;break}g.length===0&&(E++,ue())}function Ne(){if(!r.isInvulnerable){if(C--,C<=0){De();return}r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,r.isInvulnerable=!0,setTimeout(()=>{r.isInvulnerable=!1},le)}}function Ye(){v=!v}J();
