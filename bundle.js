var ge="@vercel/analytics",me="1.5.0",we=()=>{window.va||(window.va=function(...n){(window.vaq=window.vaq||[]).push(n)})};function Q(){return typeof window<"u"}function j(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function xe(t="auto"){if(t==="auto"){window.vam=j();return}window.vam=t}function pe(){return(Q()?window.vam:j())||"production"}function N(){return pe()==="development"}function ye(t){return t.scriptSrc?t.scriptSrc:N()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function ee(t={debug:!0}){var n;if(!Q())return;xe(t.mode),we(),t.beforeSend&&((n=window.va)==null||n.call(window,"beforeSend",t.beforeSend));let i=ye(t);if(document.head.querySelector(`script[src*="${i}"]`))return;let o=document.createElement("script");o.src=i,o.defer=!0,o.dataset.sdkn=ge+(t.framework?`/${t.framework}`:""),o.dataset.sdkv=me,t.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),t.endpoint?o.dataset.endpoint=t.endpoint:t.basePath&&(o.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(o.dataset.dsn=t.dsn),o.onerror=()=>{let a=N()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${i}. ${a}`)},N()&&t.debug===!1&&(o.dataset.debug="false"),document.head.appendChild(o)}ee();var r=document.getElementById("gameCanvas"),e=r.getContext("2d");r.width=window.innerWidth;r.height=window.innerHeight;var z=Math.PI*2;var te=Math.PI/18,Te=20,O=.1,Se=.98,ae=3e3,Ae=2,ve=8,Ie=50,Y=120,F=.6*3,V=1.6*3,le={large:45,medium:25,small:15},H={easy:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},medium:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},difficult:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}}},Z=10,E={easy:{playerAcceleration:O*.67,shootCooldown:Y,asteroidMinSpeed:F*.67,asteroidSpeedVariation:V*.67,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:O*1,shootCooldown:Math.floor(Y*.7),asteroidMinSpeed:F*1,asteroidSpeedVariation:V*.8,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:O*1.33,shootCooldown:Math.floor(Y*.5),asteroidMinSpeed:F*1.33,asteroidSpeedVariation:V*1,initialAsteroidCountBase:4,lives:2}},C="medium",Ee=E.medium.playerAcceleration,ce=E.medium.shootCooldown,be=E.medium.asteroidMinSpeed,Me=E.medium.asteroidSpeedVariation,Re=E.medium.initialAsteroidCountBase,ie=E.medium.lives,q={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},He={[q.BIG]:{baseSize:45,score:20},[q.MEDIUM]:{baseSize:25,score:50},[q.LITTLE]:{baseSize:15,score:100}};var k={small:"images/bront.png",medium:"images/steg.png",large:"images/trex.png"},de={},ne=!1,$=0,se=Object.keys(k).length;function ke(t){console.log("Preloading images..."),Object.keys(k).forEach(n=>{let i=new Image;i.onload=()=>{console.log(`Image loaded: ${k[n]}`),$++,de[n]=i,$===se&&(console.log("All images successfully preloaded."),ne=!0,t&&t())},i.onerror=()=>{console.error(`Failed to load image: ${k[n]}`),$++,$===se&&(console.warn("Finished processing images, some failed to load."),ne=!0,t&&t())},i.src=k[n]})}var s={x:r.width/2,y:r.height/2,angle:-Math.PI/2,speed:0,acceleration:O,friction:Se,size:Te,canShoot:!0,lastShotTime:0,isInvulnerable:!1},f=[],g=[],x=0,D=3,I=1,b=!0;var p=!1,m=!1,u=null,w=null,_=!1,X=class{constructor(n,i,o){this.sizeType=n,this.x=i,this.y=o,this.radius=le[this.sizeType],this.size=this.radius,this.speed=Math.random()*(H[C][this.sizeType].max-H[C][this.sizeType].min)+H[C][this.sizeType].min,this.angle=Math.random()*z,this.rotation=Math.random()*z,this.rotationSpeed=(Math.random()-.5)*.05,this.image=de[this.sizeType],this.image||console.error(`Image not loaded for sizeType: ${this.sizeType}. Asteroid may not render correctly.`)}draw(){if(this.x+this.radius<0||this.x-this.radius>r.width||this.y+this.radius<0||this.y-this.radius>r.height)return;if(!this.image){e.beginPath(),e.arc(this.x,this.y,this.radius,0,z),e.strokeStyle="grey",e.stroke();return}e.save(),e.translate(this.x,this.y),e.rotate(this.rotation);let n=this.image.naturalWidth/this.image.naturalHeight,i=this.radius*2,o,a;n>1?(o=i,a=i/n):(a=i,o=i*n);let l=-o/2,c=-a/2;e.drawImage(this.image,l,c,o,a),e.restore()}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.rotation+=this.rotationSpeed,J(this)}},U=class{constructor(n,i,o){this.x=n,this.y=i,this.angle=o,this.speed=ve,this.radius=Ae,this.size=this.radius,this.lifespan=Ie}draw(){this.x<-this.radius||this.x>r.width+this.radius||this.y<-this.radius||this.y>r.height+this.radius||(e.beginPath(),e.arc(this.x,this.y,this.radius,0,z),e.fillStyle="white",e.fill())}update(){return this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.lifespan--,this.lifespan>0&&this.x>=-this.radius&&this.x<=r.width+this.radius&&this.y>=-this.radius&&this.y<=r.height+this.radius}},L={};window.addEventListener("keydown",t=>{if(L[t.key]=!0,t.key==="?"&&(Ye(),t.preventDefault()),!m&&!p){let n=t.key.toLowerCase(),i=null;n==="e"?i="easy":n==="m"?i="medium":n==="d"&&(i="difficult"),i&&(Oe(i),Ce(),t.preventDefault())}m&&!p&&(t.key==="ArrowLeft"?s.angle-=te:t.key==="ArrowRight"&&(s.angle+=te)),t.key==="Escape"&&m&&Le(),t.key===" "&&t.preventDefault()});window.addEventListener("keyup",t=>{L[t.key]=!1});function J(t){let n=typeof t.radius<"u"?t.radius:t.size;t.x<-n&&(t.x=r.width+n),t.x>r.width+n&&(t.x=-n),t.y<-n&&(t.y=r.height+n),t.y>r.height+n&&(t.y=-n)}function G(t="large",n=null,i=null){let o=le[t],a=s.size+o+100;if(n===null||i===null){let c=0;do n=o+Math.random()*(r.width-2*o),i=o+Math.random()*(r.height-2*o),c++;while(c<50&&Math.sqrt(Math.pow(n-s.x,2)+Math.pow(i-s.y,2))<a);c>=50&&console.warn("Could not find a safe spawn location far from the player after 50 attempts. Spawning anyway."),console.log(`Spawning ${t} asteroid randomly inside canvas at (${n.toFixed(1)}, ${i.toFixed(1)})`)}else console.log(`Spawning split ${t} asteroid at provided location (${n.toFixed(1)}, ${i.toFixed(1)})`);let l=new X(t,n,i);g.push(l),console.log(`Asteroids array length: ${g.length}`)}function re(t,n){let i=t.x-n.x,o=t.y-n.y,a=Math.sqrt(i*i+o*o),l=typeof t.radius<"u"?t.radius:t.size,c=typeof n.radius<"u"?n.radius:n.size;return a<l+c}async function Pe(){b=!1;let t=x;await W();let n=!1;u&&!w?u.length<Z?n=t>0:n=t>u[u.length-1].score:w&&console.error("Cannot check leaderboard qualification due to fetch error.");let i=null,o=!1,a=null;if(n){for(;;){if(i=prompt(`You made the leaderboard! Score: ${t}
Enter your initials (1-3 characters):`),i===null){i=null;break}if(i=i.trim().toUpperCase(),i.length>0&&i.length<=3)break;alert("Please enter 1 to 3 characters for your initials.")}if(i)try{o=await De(i,t),o&&await W()}catch(y){a=y.message}}e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.textAlign="center",e.textBaseline="middle";let l=r.width/2,c=r.height/2;e.font="48px Arial",e.fillText("GAME OVER",l,c-150),e.font="30px Arial",e.fillText(`Final Score: ${t}`,l,c-100),e.font="20px Arial",n?i?o?e.fillText("Score submitted to leaderboard!",l,c-60):a?(e.fillText(`Submission Error: ${a}`,l,c-60),e.fillText("Your score was not saved.",l,c-30)):e.fillText("Score qualified, but was not submitted.",l,c-60):e.fillText("You qualified, but did not enter initials.",l,c-60):w?e.fillText("Could not check leaderboard ranking.",l,c-60):e.fillText("Better luck next time!",l,c-60),e.font="20px Arial",e.fillText("Returning to Title Screen...",l,c+150),setTimeout(()=>{K()},3e3)}async function De(t,n){console.log(`Submitting score: ${t} - ${n}`);try{let i=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:n})});if(!i.ok){let a=await i.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${i.status} ${a.message||""}`)}let o=await i.json();return console.log("Submission result:",o.message),!0}catch(i){throw console.error("Error submitting score:",i),i}}function Le(){console.log("Returning to main menu via Esc key..."),m=!1,b=!1,g=[],f=[],s.x=r.width/2,s.y=r.height/2,s.speed=0,s.angle=-Math.PI/2,s.canShoot=!0,x=0,I=1}async function P(t){if(p){fe(),requestAnimationFrame(P);return}if(!m){ze(),requestAnimationFrame(P);return}if(!b)return;if(e.clearRect(0,0,r.width,r.height),e.fillStyle="black",e.fillRect(0,0,r.width,r.height),L.ArrowUp?s.speed+=s.acceleration:s.speed*=s.friction,L[" "]&&s.canShoot){let i=s.x+Math.cos(s.angle)*s.size,o=s.y+Math.sin(s.angle)*s.size;f.push(new U(i,o,s.angle)),s.canShoot=!1,s.lastShotTime=t}!s.canShoot&&t-s.lastShotTime>ce&&(s.canShoot=!0),s.x+=Math.cos(s.angle)*s.speed,s.y+=Math.sin(s.angle)*s.speed,J(s);for(let i=f.length-1;i>=0;i--)f[i].update()||f.splice(i,1);_e(),e.fillStyle="white",e.font="20px Arial",e.textBaseline="top",e.textAlign="left",e.fillText("Level: "+I,10,10),e.textAlign="center",e.fillText("Score: "+x,r.width/2,10),e.textAlign="right",e.fillText("Lives: "+D,r.width-10,10),$e();for(let i of f)i.draw();let n=[];for(let i of g)n.push(i.draw());try{await Promise.all(n)}catch(i){console.error("Error during asteroid drawing batch:",i)}requestAnimationFrame(P)}function $e(){e.save(),e.translate(s.x,s.y),e.rotate(s.angle),e.beginPath(),e.moveTo(s.size,0),e.lineTo(-s.size*.7,s.size*.7),e.lineTo(-s.size*.4,0),e.lineTo(-s.size*.7,-s.size*.7),e.closePath(),e.strokeStyle="cyan",e.lineWidth=2,e.stroke(),L.ArrowUp&&(e.beginPath(),e.moveTo(-s.size*.5,0),e.lineTo(-s.size*.9,s.size*.4),e.lineTo(-s.size*1.2,0),e.lineTo(-s.size*.9,-s.size*.4),e.closePath(),e.fillStyle="orange",e.fill()),e.restore()}function fe(){e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.font="32px Arial",e.textAlign="center",e.textBaseline="middle";let t=r.width/2,n=r.height/2-100,i=40;e.fillText("Controls",t,n),e.font="20px Arial",e.fillText("Arrow Left: Rotate Left",t,n+i*1.5),e.fillText("Arrow Right: Rotate Right",t,n+i*2.5),e.fillText("Arrow Up: Thrust",t,n+i*3.5),e.fillText("Spacebar: Shoot",t,n+i*4.5),e.fillText("?: Toggle Help / Pause",t,n+i*5.5),e.fillText("Esc: End Game",t,n+i*6.5),e.font="24px Arial",e.fillText("Press ? to close",t,n+i*8.5)}async function W(){_=!0,w=null;try{let t=await fetch("/api/leaderboard");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);u=await t.json()}catch(t){console.error("Failed to fetch leaderboard:",t),w=t.message}finally{_=!1}}function ze(){e.clearRect(0,0,r.width,r.height),e.fillStyle="black",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.textAlign="center";let t=r.width/2,n=r.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,n);let i=n+100,o=i+40,a=25;e.font="32px Arial",e.fillText("TOP SCORES",t,i),e.font="16px Arial",e.textBaseline="top";let l=o;if(_)e.fillText("Loading...",t,o),l+=a;else if(w)e.fillText(`Error loading scores: ${w}`,t,o),l+=a;else if(u&&u.length>0){let y=t-180,M=t-100,R=t+50,T=t+110,h=o;e.textAlign="left",e.fillText("Rank",y,h),e.fillText("Initials",M,h),e.textAlign="right",e.fillText("Score",R+40,h),e.textAlign="left",e.fillText("Date",T,h),e.font="14px Arial",u.forEach((S,A)=>{if(A>=Z)return;let d=h+a*(A+1.5);e.textAlign="left",e.fillText(`${A+1}.`,y,d),e.fillText(S.initials,M,d),e.textAlign="right",e.fillText(S.score.toLocaleString(),R+40,d),e.textAlign="left";try{let v=new Date(S.createdAt),B=`${v.toLocaleDateString()} ${v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(B,T,d)}catch{e.fillText("Invalid Date",T,d)}l=d+a})}else e.fillText("No scores yet! Be the first!",t,o),l+=a;let c=l+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,r.height-50),e.font="16px Arial",e.fillText("(c) Intensity Ventures, 2025",t,r.height-20)}function Oe(t){C=t;let n=E[t];Ee=n.playerAcceleration,ce=n.shootCooldown,be=n.asteroidMinSpeed,Me=n.asteroidSpeedVariation,Re=n.initialAsteroidCountBase,ie=n.lives,D=ie,console.log(`Difficulty set to: ${t}`)}function Ce(){m||(m=!0,b=!0,x=0,I=1,s.x=r.width/2,s.y=r.height/2,s.speed=0,s.angle=-Math.PI/2,f=[],g=[],ue())}function oe(){console.log("Resizing canvas..."),r.width=window.innerWidth,r.height=window.innerHeight,p?fe():m||he()}function K(){console.log("Initializing game..."),W(),oe(),window.addEventListener("resize",oe),m=!1,p=!1,x=0,I=1,D=3,g=[],f=[],s.x=r.width/2,s.y=r.height/2,s.speed=0,s.angle=-Math.PI/2,s.canShoot=!0,s.isInvulnerable=!1,ke(()=>{console.log("Image loading complete, showing start screen."),he()}),requestAnimationFrame(P)}function he(){e.clearRect(0,0,r.width,r.height),e.fillStyle="black",e.fillRect(0,0,r.width,r.height),e.fillStyle="white",e.textAlign="center";let t=r.width/2,n=r.height*.15;e.font="84px Arial",e.textBaseline="middle",e.fillText("DINOSTROIDS",t,n);let i=n+100,o=i+40,a=25;e.font="32px Arial",e.fillText("TOP SCORES",t,i),e.font="16px Arial",e.textBaseline="top";let l=o;if(_)e.fillText("Loading...",t,o),l+=a;else if(w)e.fillText(`Error loading scores: ${w}`,t,o),l+=a;else if(u&&u.length>0){let y=t-180,M=t-100,R=t+50,T=t+110,h=o;e.textAlign="left",e.fillText("Rank",y,h),e.fillText("Initials",M,h),e.textAlign="right",e.fillText("Score",R+40,h),e.textAlign="left",e.fillText("Date",T,h),e.font="14px Arial",u.forEach((S,A)=>{if(A>=Z)return;let d=h+a*(A+1.5);e.textAlign="left",e.fillText(`${A+1}.`,y,d),e.fillText(S.initials,M,d),e.textAlign="right",e.fillText(S.score.toLocaleString(),R+40,d),e.textAlign="left";try{let v=new Date(S.createdAt),B=`${v.toLocaleDateString()} ${v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;e.fillText(B,T,d)}catch{e.fillText("Invalid Date",T,d)}l=d+a})}else e.fillText("No scores yet! Be the first!",t,o),l+=a;let c=l+60;e.textAlign="center",e.font="28px Arial",e.fillText("Start Game:",t,c),e.font="24px Arial",e.fillText("E)asy   M)edium   D)ifficult",t,c+40),e.font="20px Arial",e.textBaseline="bottom",e.fillText("? for Help",t,r.height-50),e.font="16px Arial",e.fillText("(c) Intensity Ventures, 2025",t,r.height-20)}function ue(){g=[],f=[];let t=5+I*2;console.log(`Level ${I}: Spawning ${t} asteroids.`);for(let n=0;n<t;n++)G("large");s.isInvulnerable=!0,setTimeout(()=>{s.isInvulnerable=!1},ae)}window.addEventListener("resize",()=>{r.width=window.innerWidth,r.height=window.innerHeight,s&&(s.x>r.width+s.size&&(s.x=r.width/2),s.y>r.height+s.size&&(s.y=r.height/2))});K();requestAnimationFrame(P);function _e(){for(let t=g.length-1;t>=0;t--){let n=g[t],i=!1;b&&!s.isInvulnerable&&re(s,n)&&Ne();for(let o=f.length-1;o>=0;o--){let a=f[o];if(re(a,n)){f.splice(o,1),Be(n,t),i=!0;break}}i||(n.update(),J(n))}}function Be(t,n){switch(g.splice(n,1),t.sizeType){case"large":x+=20;for(let i=0;i<2;i++)G("medium",t.x,t.y);break;case"medium":x+=50;for(let i=0;i<2;i++)G("small",t.x,t.y);break;case"small":x+=100;break}g.length===0&&(I++,ue())}function Ne(){if(!s.isInvulnerable){if(D--,D<=0){Pe();return}s.x=r.width/2,s.y=r.height/2,s.speed=0,s.angle=-Math.PI/2,s.isInvulnerable=!0,setTimeout(()=>{s.isInvulnerable=!1},ae)}}function Ye(){p=!p}K();
