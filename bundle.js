var pt="@vercel/analytics",yt="1.5.0",St=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function He(){return typeof window<"u"}function _e(){try{let t="production";if(t==="development"||t==="test")return"development"}catch{}return"production"}function Tt(t="auto"){if(t==="auto"){window.vam=_e();return}window.vam=t}function Et(){return(He()?window.vam:_e())||"production"}function ge(){return Et()==="development"}function wt(t){return t.scriptSrc?t.scriptSrc:ge()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?`${t.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Ge(t={debug:!0}){var e;if(!He())return;Tt(t.mode),St(),t.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",t.beforeSend));let o=wt(t);if(document.head.querySelector(`script[src*="${o}"]`))return;let i=document.createElement("script");i.src=o,i.defer=!0,i.dataset.sdkn=pt+(t.framework?`/${t.framework}`:""),i.dataset.sdkv=yt,t.disableAutoTrack&&(i.dataset.disableAutoTrack="1"),t.endpoint?i.dataset.endpoint=t.endpoint:t.basePath&&(i.dataset.endpoint=`${t.basePath}/insights`),t.dsn&&(i.dataset.dsn=t.dsn),i.onerror=()=>{let s=ge()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${o}. ${s}`)},ge()&&t.debug===!1&&(i.dataset.debug="false"),document.head.appendChild(i)}function x(){let t=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t.toLowerCase())}var p=null,q=null;function Ye(){return p=document.createElement("canvas"),q=p.getContext("2d"),document.body.appendChild(p),me(),{canvas:p,ctx:q}}function O(){return{canvas:p,ctx:q}}function me(){if(p){if(console.log("Resizing canvas to fit window..."),x()){let t=window.innerWidth,e=window.innerHeight;p.width=t,p.height=e,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0",document.body.style.padding="0";let o=document.querySelector("meta[name=viewport]");o||(o=document.createElement("meta"),o.name="viewport",document.head.appendChild(o)),o.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",p.style.position="fixed",p.style.top="0",p.style.left="0",p.style.width="100%",p.style.height="100%",console.log(`Mobile canvas size set to: ${p.width}x${p.height}`)}else{let t=Math.min(1920,window.innerWidth-40),e=Math.min(1080,window.innerHeight-40),o=t,i=o*(9/16);i>e&&(i=e,o=i*(16/9)),p.width=o,p.height=i,p.style.position="absolute",p.style.left="50%",p.style.top="50%",p.style.transform="translate(-50%, -50%)"}p.style.backgroundColor="black"}}function j(t="black"){!q||!p||(q.fillStyle=t,q.fillRect(0,0,p.width,p.height))}function E(){return{width:p.width,height:p.height}}async function Fe(){console.log("Fetching global games played count...");try{let t=new AbortController,e=setTimeout(()=>t.abort(),3e3),o=await fetch("/api/gamesPlayed",{signal:t.signal,cache:"no-store"});if(clearTimeout(e),!o.ok)throw console.warn(`API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return typeof i.count=="number"?(console.log(`Global games played count: ${i.count}`),i.count):(console.warn("Received invalid count from API."),50)}catch(t){return t.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",t),console.log("Using fallback games played count: 50"),50}}async function Ue(){try{let t=new AbortController,e=setTimeout(()=>t.abort(),3e3),o=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:t.signal,cache:"no-store"});return clearTimeout(e),o.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${o.status}`),!1)}catch(t){return t.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",t),!1}}async function pe(){console.log("Fetching leaderboard data...");try{let t=new AbortController,e=setTimeout(()=>t.abort(),5e3),o=await fetch("/api/leaderboard",{signal:t.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(e),!o.ok)throw console.warn(`Leaderboard API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return console.log("Leaderboard data received:",i.length?`${i.length} entries`:"Empty array"),i.length>0&&console.log("First entry:",JSON.stringify(i[0])),i}catch(t){return console.error("Failed to fetch leaderboard:",t),[]}finally{console.log("Leaderboard fetch completed")}}async function Be(t,e,o=0,i=1,s="medium"){console.log(`Submitting score: ${e} points, Level ${i}, ${o}ms, ${s} difficulty`);try{let r=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:t,score:e,time:o,level:i,difficulty:s,date:new Date().toISOString()})});if(!r.ok){let l=await r.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${r.status} ${l.message||""}`)}let n=await r.json();return console.log("Submission result:",n.message),!0}catch(r){return console.error("Error submitting score:",r),!1}}var Se={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},Y={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},ie={RADIUS:2,SPEED:500,LIFESPAN:1e3},b={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var Te={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var kt=Math.PI*2;var Ht=.07*3,_t=.18*3;var Gt=.6*3,Yt=1.6*3;var le={easy:{shootCooldown:120,asteroidSpeed:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},initialAsteroids:2,lives:5},medium:{shootCooldown:84,asteroidSpeed:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},initialAsteroids:3,lives:3},difficult:{shootCooldown:60,asteroidSpeed:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}},initialAsteroids:4,lives:2}},ye={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},Ft={[ye.BIG]:{baseSize:45,score:20},[ye.MEDIUM]:{baseSize:25,score:50},[ye.LITTLE]:{baseSize:15,score:100}};var ze={};function Xe(t){return console.log("Preloading dinosaur images..."),new Promise((e,o)=>{let i=0,s=Object.keys(Te).length;if(s===0){console.log("No dinosaur images to load."),t&&t(),e();return}let r=()=>{console.log("All dinosaur images loaded successfully!"),t&&t(),e()},n=a=>{console.log(`${a} dinosaur image loaded.`),i++,i===s&&r()},l=(a,c)=>{console.error(`Error loading ${a} dinosaur image:`,c),i++,i===s&&r()};Object.entries(Te).forEach(([a,c])=>{let h=new Image;h.onload=()=>n(a),h.onerror=d=>l(a,d),h.src=c,ze[a]=h})})}function We(t){return ze[t]||null}var Ie={},ve=null,Ae=null,be=null,oe=null,ae=null,Ee=null,we=null,k=null;function Ve(t,e=null){console.log("Initializing input with game controller:",e?"provided":"not provided"),e?(k=e,console.log("Game controller reference stored successfully")):console.warn("No game controller provided to initInput"),At(),window.addEventListener("keydown",Ke),window.addEventListener("keyup",qe),x()?(console.log("Mobile device detected, setting up touch handlers"),vt(t)):console.log("Desktop device detected, using keyboard controls only")}function Ke(t){Ie[t.code]=!0,(t.code==="Enter"||t.code==="NumpadEnter")&&ve&&ve(),(t.key==="?"||t.code==="Slash"&&t.shiftKey)&&Ae&&(Ae(),t.preventDefault()),t.code==="Escape"&&be&&be(),oe&&(t.code==="KeyE"?oe("easy"):t.code==="KeyM"?oe("medium"):t.code==="KeyD"&&oe("difficult"))}function qe(t){Ie[t.code]=!1}function vt(t){console.log("\u2B50 Setting up touch handlers for difficulty selection on mobile"),ae&&(t.removeEventListener("touchstart",ae),t.removeEventListener("touchmove",Ee),t.removeEventListener("touchend",we)),ae=function(e){if(e.preventDefault(),k&&!k.getGameState().isGameStarted){console.log("Touch detected on start screen");try{let o=e.touches[0],i=t.getBoundingClientRect(),s=(o.clientX-i.left)*(t.width/i.width),r=(o.clientY-i.top)*(t.height/i.height);console.log(`Touch position: (${s.toFixed(2)}, ${r.toFixed(2)})`);let n=t.height,l=t.width,a=n*.08,c=n*.02,h=Math.min(l*.8,400),d=n*.3,m=(l-h)*.5;console.log(`Button positions: 
                    Easy: ${m}-${m+h} x ${d}-${d+a}
                    Medium: ${m}-${m+h} x ${d+a+c}-${d+2*a+c}
                    Difficult: ${m}-${m+h} x ${d+2*(a+c)}-${d+3*a+2*c}`);let f=!1;s>=m&&s<=m+h&&(r>=d&&r<=d+a?(console.log("Easy button pressed"),typeof k.startGame=="function"&&(k.startGame("easy"),f=!0)):r>=d+a+c&&r<=d+2*a+c?(console.log("Medium button pressed"),typeof k.startGame=="function"&&(k.startGame("medium"),f=!0)):r>=d+2*(a+c)&&r<=d+3*a+2*c&&(console.log("Difficult button pressed"),typeof k.startGame=="function"&&(k.startGame("difficult"),f=!0))),f||console.log("No specific difficulty button was pressed - touch outside button area")}catch(o){console.error("Error in touch handler:",o)}}else console.log("Touch detected during gameplay - ignoring for game start")},Ee=function(e){e.preventDefault()},we=function(e){e.preventDefault()},console.log("Adding touch event listeners"),t.addEventListener("touchstart",ae,{passive:!1}),t.addEventListener("touchmove",Ee,{passive:!1}),t.addEventListener("touchend",we,{passive:!1}),console.log("Touch handlers successfully set up")}function Z(t){return Ie[t]===!0}function xe(t){ve=t}function ce(t){Ae=t}function he(t){be=t}function de(t){oe=t}function At(){window.removeEventListener("keydown",Ke),window.removeEventListener("keyup",qe)}var Le=class{constructor(){let{width:e,height:o}=E();this.x=e/2,this.y=o/2,this.radius=Y.RADIUS,this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=Y.ROTATION_SPEED,this.acceleration=Y.ACCELERATION,this.friction=Y.FRICTION,this.rotatingLeft=!1,this.rotatingRight=!1,this.thrusting=!1,this.shooting=!1,this.canShoot=!0,this.shootCooldown=Y.SHOOT_COOLDOWN,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0,this.explosionParticles=[],this.explosionDuration=2e3,this.explosionElapsed=0,this.exploding=!1,this.isInHyperspace=!1,this.hyperspaceTime=0,this.hyperspaceCooldown=3e3,this.lastHyperspace=0}update(e){if(this.exploding){this.explosionElapsed+=e*1e3;let{width:h,height:d}=E();for(let m=0;m<this.explosionParticles.length;m++){let f=this.explosionParticles[m];f.x+=f.vx*e,f.y+=f.vy*e,f.x<0&&(f.x=h),f.x>h&&(f.x=0),f.y<0&&(f.y=d),f.y>d&&(f.y=0),f.angle+=f.rotationSpeed*e,f.alpha=1-this.explosionElapsed/this.explosionDuration}return this.explosionElapsed>=this.explosionDuration&&(this.exploding=!1,this.explosionParticles=[],console.log("Explosion animation complete")),null}if(this.isDestroyed)return null;this.invincible&&(this.invincibilityTime-=e*1e3,this.invincibilityTime<=0&&(this.invincible=!1,this.invincibilityTime=0));let i=Date.now()-this.lastHyperspace>this.hyperspaceCooldown;if(Z("KeyH")&&i&&!this.isInHyperspace)return this.enterHyperspace(),null;if((Z("ArrowLeft")||this.rotatingLeft)&&(this.rotation-=this.rotationSpeed*e),(Z("ArrowRight")||this.rotatingRight)&&(this.rotation+=this.rotationSpeed*e),this.isThrusting=Z("ArrowUp")||this.thrusting,this.isThrusting){let h=Math.cos(this.rotation)*this.acceleration,d=Math.sin(this.rotation)*this.acceleration;this.velocityX+=h*e,this.velocityY+=d*e}let s=1-(1-this.friction)*Math.min(1,e*5);this.velocityX*=s,this.velocityY*=s;let r=300,n=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);if(n>r){let h=r/n;this.velocityX*=h,this.velocityY*=h}this.x+=this.velocityX*e,this.y+=this.velocityY*e;let{width:l,height:a}=E();this.x<0&&(this.x=l),this.x>l&&(this.x=0),this.y<0&&(this.y=a),this.y>a&&(this.y=0);let c=null;if((Z("Space")||this.shooting)&&this.canShoot&&!this.isDestroyed){let h=Date.now();h-this.lastShot>this.shootCooldown&&(c={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=h)}return c}draw(e){if(this.exploding&&this.explosionParticles.length>0){for(let o=0;o<this.explosionParticles.length;o++){let i=this.explosionParticles[o];e.save(),e.globalAlpha=i.alpha,e.strokeStyle=i.color,e.lineWidth=1,e.beginPath(),e.moveTo(i.x,i.y);let s=i.x+Math.cos(i.angle)*i.length,r=i.y+Math.sin(i.angle)*i.length;e.lineTo(s,r),e.stroke(),e.restore()}return}if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.strokeStyle="white",e.lineWidth=2,e.beginPath(),e.moveTo(this.radius,0),e.lineTo(-this.radius*.7,-this.radius*.7),e.lineTo(-this.radius*.5,0),e.lineTo(-this.radius*.7,this.radius*.7),e.closePath(),e.stroke(),this.isThrusting){e.beginPath(),e.moveTo(-this.radius*.5,0),e.lineTo(-this.radius*1.5,0);let o=Math.random()*.5+.5;e.lineTo(-this.radius*(1+o),.5*this.radius*o),e.lineTo(-this.radius*.5,0),e.fillStyle="orange",e.fill()}e.restore()}}destroy(){console.log("Player destroy method called!"),this.isDestroyed=!0,this.createExplosion(),console.log("After createExplosion, exploding flag:",this.exploding)}createExplosion(){console.log("Creating ship explosion animation!"),this.exploding=!0,this.explosionElapsed=0,this.explosionParticles=[];let e=15,o="#ffffff";for(let i=0;i<e;i++){let s=Math.random()*Math.PI*2,r=20+Math.random()*80,n=5+Math.random()*10;this.explosionParticles.push({x:this.x,y:this.y,vx:Math.cos(s)*r,vy:Math.sin(s)*r,angle:s,length:n,color:o,alpha:1,rotationSpeed:(Math.random()-.5)*5})}}reset(){let{width:e,height:o}=E();this.x=e/2,this.y=o/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.exploding=!1,this.explosionParticles=[],this.invincible=!0,this.invincibilityTime=Y.INVINCIBILITY_TIME}isCollidingWith(e){if(this.isDestroyed||this.invincible)return!1;let o=this.x-e.x,i=this.y-e.y;return Math.sqrt(o*o+i*i)<this.radius+e.radius}enterHyperspace(){console.log("Hyperspace jump initiated!"),this.lastHyperspace=Date.now(),this.isInHyperspace=!0;let{width:e,height:o}=E(),i=50,s=i+Math.random()*(e-i*2),r=i+Math.random()*(o-i*2);this.x=s,this.y=r,this.velocityX*=.5,this.velocityY*=.5,this.invincible=!0,this.invincibilityTime=Y.INVINCIBILITY_TIME,setTimeout(()=>{this.isInHyperspace=!1},100)}},je=Le;function Ze(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function W(t,e){return Math.random()*(e-t)+t}function $e(t){let e=t/1e3,o=Math.floor(e/60),i=Math.floor(e%60),s=Math.floor((e-Math.floor(e))*1e3),r=String(o).padStart(2,"0"),n=String(i).padStart(2,"0"),l=String(s).padStart(3,"0");return`${r}:${n}.${l}`}var Pe=class t{constructor(e,o,i,s,r="medium",n=1,l=null){let{width:a,height:c}=E();console.log(`Asteroid constructor called with type=${e}, size=${o}, difficulty=${r}, speedMultiplier=${n}, fixedBaseSpeed=${l}`),this.type=e||this.getRandomType(),this.size=o||1,this.difficulty=r,this.speedMultiplier=n,this.fixedBaseSpeed=l,this.radius=b.BASE_RADIUS/this.size,this.x=i!==void 0?i:W(0,a),this.y=s!==void 0?s:W(0,c),console.log(`Creating asteroid: type=${this.type}, size=${this.size}, at (${this.x.toFixed(1)}, ${this.y.toFixed(1)})`);let h;if(l!==null)h=l,console.log(`Using fixed base speed: ${h.toFixed(2)}`);else{let $=this.getSizeCategory();console.log(`No fixed speed, using size category: ${$}`);let y=le[r].asteroidSpeed.medium;h=(y.min+y.max)/2}let d=h*n;console.log(`Final speed with multiplier: ${d.toFixed(2)}`);let m=Math.random()*Math.PI*2;this.velocityX=Math.cos(m)*d,this.velocityY=Math.sin(m)*d,console.log(`Velocity: (${this.velocityX.toFixed(2)}, ${this.velocityY.toFixed(2)})`),this.rotation=0,this.rotationSpeed=W(-1,1)*b.ROTATION_SPEED;let f=this.getImageKey();console.log(`Loading asteroid image: ${f}`),this.image=We(f),this.image||console.error(`Failed to load image for asteroid type: ${f}`),this.points=b.POINTS_BASE*this.size}getSizeCategory(){switch(this.size){case 1:return"large";case 2:return"medium";case 3:return"small";default:return"large"}}getRandomType(){if(console.log("Getting random asteroid type from:",b.TYPES),!b.TYPES||b.TYPES.length===0)return console.warn('No asteroid types defined, defaulting to "bront"'),"bront";let e=Ze(0,b.TYPES.length-1),o=b.TYPES[e];return console.log(`Selected random asteroid type: ${o} at index ${e}`),o}getImageKey(){return console.log(`Getting image key for type: ${this.type}`),(!this.type||!b.TYPES.includes(this.type))&&(console.warn(`Invalid asteroid type: ${this.type}, defaulting to 'bront'`),this.type="bront"),this.type}update(e){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*e;let{width:o,height:i}=E();this.x<-this.radius&&(this.x=o+this.radius),this.x>o+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=i+this.radius),this.y>i+this.radius&&(this.y=-this.radius)}draw(e){if(e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),this.image){let o=this.radius*2/Math.max(this.image.width,this.image.height),i=this.image.width*o,s=this.image.height*o;e.drawImage(this.image,-i/2,-s/2,i,s)}else e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.strokeStyle="gray",e.stroke();e.restore()}break(){if(this.size>=3)return[];let e=[];if(this.size===1){let o=Math.random();o<.25?this.createChildAsteroids(2,2,e):o<.45?this.createChildAsteroids(2,3,e):o<.75?(this.createChildAsteroids(1,2,e),this.createChildAsteroids(1,3,e)):o<.9?this.createChildAsteroids(1,2,e):this.createChildAsteroids(1,3,e)}else this.size===2&&(Math.random()<.7?this.createChildAsteroids(2,3,e):this.createChildAsteroids(1,3,e));return e}createChildAsteroids(e,o,i){let s=Math.atan2(this.velocityY,this.velocityX);console.log(`Parent asteroid direction angle: ${(s*180/Math.PI).toFixed(2)} degrees`);for(let r=0;r<e;r++){let n=W(-10,10),l=W(-10,10),a=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);console.log(`Parent asteroid speed: ${a.toFixed(2)}`);let c=new t(this.type,o,this.x+n,this.y+l,this.difficulty,this.speedMultiplier,this.fixedBaseSpeed),h=W(-Math.PI/2,Math.PI/2),d=s+h;console.log(`Child asteroid angle offset: ${(h*180/Math.PI).toFixed(2)} degrees`),console.log(`Child asteroid final direction: ${(d*180/Math.PI).toFixed(2)} degrees`);let m=this.fixedBaseSpeed*this.speedMultiplier;console.log(`Child asteroid using fixed speed: ${m.toFixed(2)}`),c.velocityX=Math.cos(d)*m,c.velocityY=Math.sin(d)*m,i.push(c)}}isCollidingWith(e){let o=this.x-e.x,i=this.y-e.y;return Math.sqrt(o*o+i*i)<this.radius+e.radius}},Je=Pe;var Me=class{constructor(e,o,i){this.x=e,this.y=o,this.angle=i,this.velocityX=Math.cos(i)*ie.SPEED,this.velocityY=Math.sin(i)*ie.SPEED,this.radius=ie.RADIUS,this.lifespan=ie.LIFESPAN,this.active=!0}update(e){if(!this.active)return!1;if(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.lifespan-=e*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:o,height:i}=E();return this.x<-this.radius||this.x>o+this.radius||this.y<-this.radius||this.y>i+this.radius?(this.active=!1,!1):!0}draw(e){this.active&&(e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle="white",e.fill())}isCollidingWith(e){if(!this.active)return!1;let o=this.x-e.x,i=this.y-e.y;return Math.sqrt(o*o+i*i)<this.radius+e.radius}deactivate(){this.active=!1}},Qe=Me;function et(t,e,o,i,s){let{width:r,height:n}=E();t.fillStyle="white",t.font="20px Arial",t.textAlign="left",t.fillText(`Score: ${e}`,20,30),t.textAlign="center",t.fillText(`Level: ${i}`,r/2,30),bt(t,o,r-20,30)}function bt(t,e,o,i){for(let s=0;s<e;s++)It(t,o-s*25,i-5,10)}function It(t,e,o,i){t.save(),t.translate(e,o),t.rotate(-Math.PI/2),t.strokeStyle="white",t.lineWidth=1.5,t.beginPath(),t.moveTo(i,0),t.lineTo(-i*.7,-i*.7),t.lineTo(-i*.4,0),t.lineTo(-i*.7,i*.7),t.closePath(),t.stroke(),t.restore()}var P="",Ce=3,De=!1,se=null,Re=null,V=null,ne=null;function it(t,e,o=[],i=1,s=0){let{width:r,height:n}=E();if(j("black"),t.fillStyle="white",t.font="bold 48px Arial",t.textAlign="center",t.fillText("GAME OVER",r/2,n/4),t.font="32px Arial",t.fillText(`Score: ${e}`,r/2,n/4+60),xt(e,o)){t.font="24px Arial",t.fillText("New High Score!",r/2,n/4+100),t.fillText("Enter your initials (up to 3 letters):",r/2,n/4+140),t.font="48px Arial",t.fillStyle="white",t.textAlign="center";let a=P?P+(P.length<Ce?"_":""):"_";t.clearRect(r/2-100,n/4+170,200,60),t.fillText(a,r/2,n/4+200),t.font="16px Arial",t.fillText("Press ENTER when done or type up to 3 letters",r/2,n/4+240)}else t.font="24px Arial",t.fillText("Press SPACE to play again",r/2,n/4+120)}function xt(t,e){if(!e||e.length===0||e.length<20)return!0;let o=[...e].sort((s,r)=>r.score-s.score),i=o[o.length-1].score;return t>i}function ot(t){V=t}function K(t){if(De){if(t.key==="Enter"){P.length>0&&se&&(se(P),tt());return}t.key.length===1&&/[A-Za-z]/.test(t.key)?P.length<Ce&&(P+=t.key.toUpperCase(),V&&V(),P.length===Ce&&se&&setTimeout(()=>{se(P),tt()},1e3)):t.key==="Backspace"&&(P=P.slice(0,-1),V&&V())}else t.code==="Space"&&Re&&Re()}function tt(){P="",De=!1,ne&&(clearInterval(ne),ne=null)}function st(){De=!0,P="",V&&!ne&&(ne=setInterval(()=>{V()},100))}function nt(t){se=t}function rt(t){Re=t}function fe(t,e,o,i,s=!1){o&&o.length>0&&(console.log("Leaderboard data keys:",Object.keys(o[0])),console.log("Sample entry:",o[0]));let r=[...o].sort((y,T)=>T.score-y.score).slice(0,20),n=Math.min(r.length,20,Math.floor((i.canvas.height-e-50)/(s?18:25))),l=s?400:500;i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(t-l/2,e,l,n*(s?18:25)+(s?40:50)),i.fillStyle="white",i.font=`bold ${s?"18px":"24px"} Arial`,i.textAlign="center",i.fillText("High Scores",t,e+(s?22:30));let a=s?.8:1,c=t-l/2+40*a,h=t-l/2+100*a,d=t-l/2+170*a,m=t-l/2+220*a,f=t-l/2+300*a,$=t-l/2+380*a;i.font=s?"12px Arial":"16px Arial",i.textAlign="right",i.fillText("Rank",c,e+(s?45:60)),i.fillText("Score",h,e+(s?45:60)),i.fillText("Initials",d,e+(s?45:60)),i.fillText("Level",m,e+(s?45:60)),i.fillText("Date",f,e+(s?45:60)),i.fillText("Time",$,e+(s?45:60)),i.font=s?"12px Arial":"16px Arial";for(let y=0;y<n;y++){let T=r[y],v=e+(s?65:85)+y*(s?18:25);T.isCurrent&&(i.fillStyle="rgba(255, 255, 0, 0.3)",i.fillRect(t-l/2+10,v-(s?12:15),l-20,s?16:20),i.fillStyle="white"),i.textAlign="right",i.fillText(`${y+1}`,c,v),i.fillText(`${T.score}`,h,v),i.fillText(T.initials||"---",d,v),i.fillText(`${T.level||"1"}`,m,v);let Ne=T.date||T.createdAt||T.created_at;if(Ne)try{let G=new Date(Ne);if(isNaN(G.getTime()))i.fillText("--/--/--",f,v),i.fillText("--:--",$,v);else{let ft=`${G.getMonth()+1}/${G.getDate()}/${G.getFullYear().toString().substr(2)}`;i.fillText(ft,f,v);let ke=G.getHours(),ut=G.getMinutes(),gt=ke>=12?"PM":"AM",mt=`${ke%12||12}:${ut.toString().padStart(2,"0")} ${gt}`;i.fillText(mt,$,v)}}catch(G){console.error("Error parsing date:",G,"for score:",T),i.fillText("--/--/--",f,v),i.fillText("--:--",$,v)}else i.fillText("--/--/--",f,v),i.fillText("--:--",$,v)}o.length>n&&(i.textAlign="center",i.font=s?"10px Arial":"14px Arial",i.fillText(`Showing ${n} of ${o.length} scores`,t,e+n*(s?18:25)+(s?30:40)))}function lt(t,e,o,i){let{width:s,height:r}=t.canvas;t.fillStyle="black",t.fillRect(0,0,s,r),console.log(`Start Screen - Current difficulty: ${e}`),x()?Lt(t,e,o,i):$t(t,e,o,i)}function Lt(t,e,o,i){let{width:s,height:r}=t.canvas;console.log(`Drawing mobile start screen at ${s}x${r}`),t.fillStyle="white",t.font=`bold ${Math.floor(r*.05)}px Arial`,t.textAlign="center",t.fillText("DINOSTROIDS",s*.5,r*.15),t.font=`${Math.floor(r*.03)}px Arial`,t.fillText("TAP DIFFICULTY TO START:",s*.5,r*.25);let n=["EASY","MEDIUM","DIFFICULT"],l=r*.08,a=r*.02,c=Math.min(s*.8,400),h=r*.3;n.forEach((m,f)=>{let $=h+(l+a)*f,y=m.toLowerCase()===e,T=(s-c)*.5;t.fillStyle=y?"rgba(255, 255, 255, 0.3)":"rgba(255, 255, 255, 0.1)",t.fillRect(T,$,c,l),t.strokeStyle="white",t.lineWidth=y?2:1,t.strokeRect(T,$,c,l),t.fillStyle="white",t.font=`${y?"bold ":""}${Math.floor(r*.03)}px Arial`,t.textAlign="center",t.fillText(m,s*.5,$+l*.6)}),t.fillStyle="white",t.font=`${Math.floor(r*.025)}px Arial`,t.textAlign="center";let d=h+(l+a)*n.length+a;t.fillText("TAP ANY DIFFICULTY TO START GAME",s*.5,d),i>0&&(t.font=`${Math.floor(r*.02)}px Arial`,t.textAlign="center",t.fillText(`Games Played: ${i}`,s*.5,r*.9)),t.font=`${Math.floor(r*.015)}px Arial`,t.textAlign="center",t.fillText("\xA9 2025, Intensity Ventures",s*.5,r*.95)}function $t(t,e,o,i){let{width:s,height:r}=t.canvas;t.fillStyle="white",t.font="bold 48px Arial",t.textAlign="center",t.fillText("DINOSTROIDS",s/2,r/3),t.font="24px Arial",t.fillText("Select Difficulty:",s/2,r/2-30);let n=[{key:"E",label:"Easy",value:"easy"},{key:"M",label:"Medium",value:"medium"},{key:"D",label:"Difficult",value:"difficult"}],l=r/2+30;if(n.forEach((a,c)=>{let h=s/2-150+c*150,d=e===a.value;d?(t.fillStyle="rgba(255, 255, 255, 0.2)",t.fillRect(h-65,l-30,130,40),t.font="bold 24px Arial"):t.font="24px Arial",t.fillStyle=d?"#ffffff":"rgba(255, 255, 255, 0.8)",t.fillText(`${a.key}: ${a.label}`,h,l)}),t.font="24px Arial",t.fillStyle="white",t.font="24px Arial",t.fillText("Press RETURN to start",s/2,r*2/3+20),t.fillText("Press ? for help",s/2,r*2/3+60),o&&o.length>0){let a=s*.9,c=r*.1;fe(a,c,o,t,!0)}i>0&&(t.font="16px Arial",t.textAlign="center",t.fillText(`Games Played: ${i}`,s/2,r-80)),t.font="14px Arial",t.textAlign="center",t.fillText("\xA9 2025, Intensity Ventures",s/2,r-40)}var J=class{constructor(e,o){this.canvas=e,this.ctx=e.getContext("2d"),this.gameController=o,this.buttonSize=60,this.buttonPadding=15;let i=e.height-(this.buttonPadding+this.buttonSize),s=e.width-(this.buttonPadding+this.buttonSize);this.buttons={left:{x:this.buttonPadding,y:i,label:"\u2190"},right:{x:2*this.buttonPadding+this.buttonSize,y:i,label:"\u2192"},shoot:{x:s-(this.buttonSize+this.buttonPadding),y:i,label:"SHOOT"},thrust:{x:s,y:i,label:"THRUST"},hyperspace:{x:s-this.buttonSize/2,y:i-(this.buttonSize+this.buttonPadding),label:"HYPER"}},this.activeTouches=new Map,this.debug=!0,x()&&this.setupTouchEvents()}setupTouchEvents(){this.removeEventListeners(),this.touchStartHandler=this.handleTouchStart.bind(this),this.touchMoveHandler=this.handleTouchMove.bind(this),this.touchEndHandler=this.handleTouchEnd.bind(this),this.touchCancelHandler=this.handleTouchCancel.bind(this),this.canvas.addEventListener("touchstart",this.touchStartHandler,{passive:!1}),this.canvas.addEventListener("touchmove",this.touchMoveHandler,{passive:!1}),this.canvas.addEventListener("touchend",this.touchEndHandler,{passive:!1}),this.canvas.addEventListener("touchcancel",this.touchCancelHandler,{passive:!1}),this.debug&&console.log("Mobile controls touch events initialized")}removeEventListeners(){this.touchStartHandler&&(this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.canvas.removeEventListener("touchmove",this.touchMoveHandler),this.canvas.removeEventListener("touchend",this.touchEndHandler),this.canvas.removeEventListener("touchcancel",this.touchCancelHandler))}handleTouchStart(e){e.preventDefault(),this.debug&&console.log(`Touch start with ${e.touches.length} touches`),Array.from(e.touches).forEach(o=>{let i=this.getButtonAtPosition(o.clientX,o.clientY);i&&(this.activeTouches.set(o.identifier,i),this.handleButtonPress(i),this.debug&&console.log(`Button press: ${i}`))})}handleTouchMove(e){e.preventDefault(),Array.from(e.touches).forEach(o=>{let i=this.getButtonAtPosition(o.clientX,o.clientY),s=this.activeTouches.get(o.identifier);i!==s&&(s&&(this.handleButtonRelease(s),this.debug&&console.log(`Button release on move: ${s}`)),i?(this.handleButtonPress(i),this.activeTouches.set(o.identifier,i),this.debug&&console.log(`Button press on move: ${i}`)):this.activeTouches.delete(o.identifier))})}handleTouchEnd(e){e.preventDefault(),this.debug&&console.log(`Touch end with ${e.changedTouches.length} changed touches`),Array.from(e.changedTouches).forEach(o=>{let i=this.activeTouches.get(o.identifier);i&&(this.handleButtonRelease(i),this.activeTouches.delete(o.identifier),this.debug&&console.log(`Button release on end: ${i}`))})}handleTouchCancel(e){e.preventDefault(),this.debug&&console.log("Touch cancel event"),Array.from(e.changedTouches).forEach(o=>{let i=this.activeTouches.get(o.identifier);i&&(this.handleButtonRelease(i),this.activeTouches.delete(o.identifier))})}getButtonAtPosition(e,o){let i=this.canvas.getBoundingClientRect(),s=this.canvas.width/i.width,r=this.canvas.height/i.height,n=(e-i.left)*s,l=(o-i.top)*r;for(let[a,c]of Object.entries(this.buttons))if(n>=c.x&&n<=c.x+this.buttonSize&&l>=c.y&&l<=c.y+this.buttonSize)return a;return null}handleButtonPress(e){switch(e){case"left":this.gameController.setRotateLeft(!0);break;case"right":this.gameController.setRotateRight(!0);break;case"thrust":this.gameController.setThrusting(!0);break;case"shoot":this.gameController.setFiring(!0);break;case"hyperspace":this.gameController.activateHyperspace();break}}handleButtonRelease(e){switch(e){case"left":this.gameController.setRotateLeft(!1);break;case"right":this.gameController.setRotateRight(!1);break;case"thrust":this.gameController.setThrusting(!1);break;case"shoot":this.gameController.setFiring(!1);break}}draw(){if(x()){this.ctx.save(),this.ctx.globalAlpha=.5,this.ctx.strokeStyle="white",this.ctx.lineWidth=1,this.ctx.font="14px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(let[e,o]of Object.entries(this.buttons)){let i=Array.from(this.activeTouches.values()).includes(e);this.ctx.fillStyle=i?"white":"black",this.ctx.fillRect(o.x,o.y,this.buttonSize,this.buttonSize),this.ctx.strokeRect(o.x,o.y,this.buttonSize,this.buttonSize),this.ctx.fillStyle=i?"black":"white",this.ctx.globalAlpha=.9,this.ctx.fillText(o.label,o.x+this.buttonSize/2,o.y+this.buttonSize/2)}this.ctx.restore()}}cleanup(){this.removeEventListeners(),this.activeTouches.clear()}};var F=!1,L=!1,M=!1,H=!1,ue=!1,Q=0,I=0,U=Se.INITIAL_LIVES,B=1,re=0,C=[],ee=0,at=0,ct=null,S="medium",ht=0,A={active:!1,text:"+1 SHIP",x:0,y:0,alpha:0,duration:2e3,startTime:0},u=null,w=[],_=[],g=null,N,z,X,R,D,te=1,Oe=class{constructor(){this.mobileControls=null,this.gameLoop=this.gameLoop.bind(this),this.toggleHelpScreen=this.toggleHelpScreen.bind(this)}showStartScreen(){let{ctx:e}=O();console.log("Showing start screen"),L=!1,H=!1,F=!1,M=!1,g&&(cancelAnimationFrame(g),g=null),document.removeEventListener("keydown",K),this.cleanupInputHandlers(),this.setupInputHandlers(),j("black"),lt(e,S,C,re)}endGame(e=!0){console.log("Game ended"),g&&(cancelAnimationFrame(g),g=null),this.mobileControls&&(this.mobileControls.cleanup(),this.mobileControls=null),re++,Ue(re),I>0&&(!C||C.length<20||I>[...C].sort((i,s)=>s.score-i.score)[Math.min(19,C.length-1)]?.score)&&console.log(`Game ended with high score: ${I}`),L=!1,ue=!1,M=!1,u=null,w=[],_=[],e&&this.showStartScreen()}drawHelpScreen(){let{canvas:e,ctx:o}=O();if(j("black"),x()){o.fillStyle="white",o.font="bold 28px Arial",o.textAlign="center",o.fillText("HOW TO PLAY",e.width/2,e.height*.1),o.font="18px Arial";let i=["CONTROLS:","\u2022 Left/Right buttons to rotate","\u2022 THRUST button to move forward","\u2022 SHOOT button to fire","\u2022 HYPER button for random teleport","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score points to earn extra ships","","TAP ? TO RETURN"],s=e.height*.2,r=e.height*.05;i.forEach((n,l)=>{n.startsWith("\u2022")?(o.textAlign="left",o.fillText(n,e.width*.15,s+l*r)):(o.textAlign="center",o.fillText(n,e.width/2,s+l*r))})}else{o.fillStyle="white",o.font="bold 36px Arial",o.textAlign="center",o.fillText("HOW TO PLAY",e.width/2,100),o.font="20px Arial",o.textAlign="left";let i=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 H: Hyperspace jump (random teleport)","\u2022 ?: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible","","TIPS:","\u2022 Use hyperspace to escape danger","\u2022 You're invincible for 3 seconds after hyperspace"],s=150,r=30;i.forEach((n,l)=>{o.fillText(n,e.width/4,s+l*r)}),o.font="24px Arial",o.textAlign="center",o.fillText("Press ? to return",e.width/2,e.height-50)}}cleanupInputHandlers(){xe(null),ce(null),he(null),de(null)}setupInputHandlers(){this.cleanupInputHandlers(),xe(()=>{console.log("Start key pressed"),!H&&!L&&(console.log("Starting game with current difficulty:",S),this.startGame(S))}),ce(this.toggleHelpScreen),he(()=>{console.log("Escape key pressed, game state:",L,M),console.log("Ending game due to ESC key"),this.endGame(!0)}),de(e=>{(!L||M)&&(S=e,this.updateDifficultySettings(),this.showStartScreen())})}startGame(e){try{console.log(`Beginning game start with difficulty: ${e||"medium"}`),e||(e="medium"),g&&(console.log(`Canceling animation frame: ${g}`),cancelAnimationFrame(g),g=null),this.mobileControls&&(console.log("Cleaning up existing mobile controls"),this.mobileControls.cleanup(),this.mobileControls=null),L=!0,ue=!1,M=!1,H=!1,B=1,I=0,S=e,console.log(`Setting game parameters for ${e} difficulty`);try{switch(e){case"easy":console.log("Setting EASY difficulty parameters"),N=100,z=.3,X=30,R=2,D=5;break;case"difficult":console.log("Setting DIFFICULT difficulty parameters"),N=140,z=.15,X=50,R=4,D=3;break;case"medium":default:console.log("Setting MEDIUM difficulty parameters"),N=120,z=.2,X=40,R=3,D=3,S="medium"}console.log(`Difficulty set to: ${S}, Lives: ${D}, Asteroids: ${R}`)}catch(l){console.error("Error setting difficulty values, using medium defaults:",l),N=120,z=.2,X=40,R=3,D=3,S="medium"}U=D,te=1,A.active=!1,console.log("Basic game state reset complete");let{canvas:o,ctx:i}=O(),{width:s,height:r}=E();console.log(`Canvas dimensions: ${s}x${r}`);try{console.log(`Creating player at ${s/2}, ${r/2} with acceleration ${N}`),u=new je(s/2,r/2,N),console.log("Player created successfully")}catch(l){console.error("Error creating player:",l)}_=[],w=[],console.log("Game entities reset");try{console.log(`Creating ${R} asteroids`),this.createAsteroids(R),console.log(`Created ${w.length} asteroids`)}catch(l){console.error("Error creating asteroids:",l)}if(x()){console.log("Creating mobile controls for gameplay");try{this.mobileControls=new J(o,this),console.log("Mobile controls created successfully")}catch(l){console.error("Error creating mobile controls:",l)}}ce(this.toggleHelpScreen),he(()=>{console.log("ESC key pressed during gameplay, ending game"),this.endGame(!0)}),de(null),console.log("Starting game loop"),Q=performance.now(),at=Date.now(),F=!0;let n=this.gameLoop.bind(this);try{g=requestAnimationFrame(n),console.log("Animation frame requested:",g)}catch(l){console.error("Error starting animation frame:",l)}console.log("Game started successfully")}catch(o){console.error("CRITICAL ERROR STARTING GAME:",o);try{console.log("Attempting emergency reset to start screen"),L=!1,ue=!1,M=!1,g&&(cancelAnimationFrame(g),g=null),this.showStartScreen()}catch(i){console.error("Even the fallback failed:",i)}}}createAsteroids(e){let{width:o,height:i}=E();console.log(`Beginning asteroid creation: ${e} asteroids with canvas dimensions ${o}x${i}`),w=[],console.log(`Creating ${e} asteroids with speed multiplier: ${te}`);let s;S==="easy"?s=1:S==="medium"?s=2.5:s=5;let r=s*te;console.log(`Base speed for ALL asteroids: ${s.toFixed(2)}, With level multiplier: ${r.toFixed(2)}`);let n=u?u.x:o/2,l=u?u.y:i/2;console.log(`Player position for spawning calculations: (${n}, ${l})`);for(let a=0;a<e;a++){let c,h,d,m=0;do{m++,Math.random()<.5?(c=Math.random()<.5?0:o,h=Math.random()*i):(c=Math.random()*o,h=Math.random()<.5?0:i);let y=n-c,T=l-h;if(d=Math.sqrt(y*y+T*T),m>50){console.warn(`Could not find safe spawn location after ${m} attempts`);break}}while(d<b.SPAWN_DISTANCE_MIN);let f=b.TYPES[Math.floor(Math.random()*b.TYPES.length)],$=1;console.log(`Creating large asteroid type: ${f}, at (${c.toFixed(2)}, ${h.toFixed(2)})`);try{let y=new Je(f,$,c,h,S,te,s),T=Math.random()*Math.PI*2,v=r;y.velocityX=Math.cos(T)*v,y.velocityY=Math.sin(T)*v,console.log(`Setting asteroid velocity to (${y.velocityX.toFixed(2)}, ${y.velocityY.toFixed(2)}) with speed: ${v.toFixed(2)}`),w.push(y)}catch(y){console.error(`Error creating asteroid: ${y.message}`)}}console.log(`Created ${w.length} asteroids successfully`)}gameLoop(e){try{if(!F){console.log("Game loop called but game is not running - exiting");return}Q||(console.log("Entered game loop for the first time"),Q=e);let o=.016;try{o=(e-Q)/1e3,Q=e}catch(n){console.error("Error calculating delta time:",n),Q=e}let i=Math.min(o,.1);if(ue){g=requestAnimationFrame(this.gameLoop.bind(this));return}try{ee=Date.now()-at}catch(n){console.error("Error updating game time:",n)}ee%5e3<20&&(console.log(`Game running - Time: ${ee}ms, FPS: ${(1/o).toFixed(1)}`),console.log(`Entities: Player exists: ${!!u}, Asteroids: ${w.length}, Bullets: ${_.length}`));try{j("black")}catch(n){console.error("Error clearing canvas:",n)}let{ctx:s,canvas:r}=O();if(u)try{let n=u.update(i);n&&_.push(new Qe(n.x,n.y,n.rotation)),u.draw(s)}catch(n){console.error("Error updating player:",n)}try{for(let n=_.length-1;n>=0;n--){let l=_[n];if(!l.update(i)){_.splice(n,1);continue}l.draw(s);for(let a=w.length-1;a>=0;a--){let c=w[a];if(l.isCollidingWith(c)){l.deactivate(),_.splice(n,1);let h=c.break();I+=b.SCORE_VALUES[c.size]||100,this.checkExtraLife(I),w.push(...h),w.splice(a,1);break}}}}catch(n){console.error("Error updating bullets:",n)}try{w.forEach(n=>{n.update(i),n.draw(s)})}catch(n){console.error("Error updating asteroids:",n)}try{if(u&&!u.isDestroyed&&!u.exploding&&!u.isInHyperspace&&!u.invincible)for(let n=w.length-1;n>=0;n--){let l=w[n];if(u.isCollidingWith(l)){console.log("Player hit by asteroid!"),u.destroy(),U--;let a=l.break();I+=b.SCORE_VALUES[l.size]||100,this.checkExtraLife(I),w.push(...a),w.splice(n,1),U<=0?setTimeout(()=>{this.handleGameOver()},2e3):setTimeout(()=>{u.reset()},2e3);break}}}catch(n){console.error("Error checking player collisions:",n)}try{w.length===0&&L&&!M&&(console.log("Level complete! Advancing to next level"),this.startNextLevel())}catch(n){console.error("Error checking level completion:",n)}try{this.drawHUD()}catch(n){console.error("Error drawing HUD:",n)}try{A.active&&this.drawExtraLifeAnimation()}catch(n){console.error("Error drawing extra life animation:",n)}try{this.mobileControls&&this.mobileControls.draw()}catch(n){console.error("Error drawing mobile controls:",n)}if(F)try{g=requestAnimationFrame(this.gameLoop.bind(this))}catch(n){console.error("Error requesting next animation frame:",n),setTimeout(()=>{F&&(console.log("Attempting to recover game loop..."),g=requestAnimationFrame(this.gameLoop.bind(this)))},1e3)}}catch(o){console.error("CRITICAL ERROR IN GAME LOOP:",o);try{console.log("Attempting emergency recovery of game loop"),g=requestAnimationFrame(this.gameLoop.bind(this))}catch(i){console.error("Failed to recover game loop:",i);try{console.error("Game loop unrecoverable - ending game"),this.handleGameOver()}catch(s){console.error("Everything failed. Game state is undefined.",s)}}}}handleGameOver(){console.log("Game over!"),M=!0,F=!1,g&&(cancelAnimationFrame(g),g=null);let e=ee;u&&(u=null),w=[],_=[],document.removeEventListener("keydown",K);let o=this.isNewHighScore();console.log(`Game over check - Is high score: ${o}, Score: ${I}`);let{ctx:i}=O(),s=()=>{it(i,I,C,B,e)};ot(s),s(),document.addEventListener("keydown",K),console.log("Added keydown event listener for game over screen"),o?(console.log("New high score detected!"),st(),setTimeout(s,100),nt(async r=>{try{console.log(`Submitting high score with initials: ${r}`),await Be(r,I,e,B,S),C=await pe(),document.removeEventListener("keydown",K),M=!1,L=!1,F=!1,g&&(cancelAnimationFrame(g),g=null),this.showStartScreen()}catch(n){console.error("Failed to submit score:",n),document.removeEventListener("keydown",K),M=!1,g&&(cancelAnimationFrame(g),g=null),this.showStartScreen()}})):rt(()=>{console.log("Restarting game..."),document.removeEventListener("keydown",K),M=!1,L=!1,this.cleanupInputHandlers(),g&&(cancelAnimationFrame(g),g=null),this.showStartScreen()})}isNewHighScore(){if(!C||C.length===0||C.length<20)return!0;let e=[...C].sort((o,i)=>i.score-o.score);return I>e[Math.min(19,e.length-1)].score}toggleHelpScreen(){L||(H=!H,H?this.drawHelpScreen():this.showStartScreen())}initGame(){console.log("\u2B50 Initializing game...");let{canvas:e}=Ye();console.log("Canvas initialized with dimensions:",e.width,"x",e.height),x()&&(console.log("Setting up mobile controls"),this.mobileControls=new J(e,this)),window.addEventListener("resize",()=>{console.log("Window resize detected"),me(),L||(H?this.drawHelpScreen():this.showStartScreen()),x()&&(this.mobileControls&&this.mobileControls.cleanup(),this.mobileControls=new J(e,this))}),console.log("Initializing input system with canvas and game controller"),Ve(e,this),console.log("Loading game data..."),Promise.all([pe(),Fe(),Xe()]).then(([o,i])=>{console.log("\u2705 Game data loaded successfully"),C=o,re=i,this.showStartScreen()}).catch(o=>{console.error("\u274C Error loading game data:",o),this.showStartScreen()})}getGameState(){return{gameRunning:F,isGameStarted:L,isGameOver:M,isHelpScreenVisible:H,score:I,lives:U,level:B,gamesPlayedCount:re,leaderboardData:C}}updateDifficultySettings(){console.log(`Updating game settings for difficulty: ${S}`);try{switch(S){case"easy":console.log("Setting EASY difficulty parameters"),N=100,z=.3,X=30,R=2,D=5;break;case"difficult":console.log("Setting DIFFICULT difficulty parameters"),N=140,z=.15,X=50,R=4,D=3;break;case"medium":default:console.log("Setting MEDIUM difficulty parameters"),N=120,z=.2,X=40,R=3,D=3;break}console.log(`Difficulty updated to: ${S}, Lives: ${D}, Asteroids: ${R}`)}catch(e){console.error("Error updating difficulty settings:",e),N=120,z=.2,X=40,R=3,D=3}}changeDifficulty(e){(!L||M)&&(S=e,this.updateDifficultySettings(),H||this.showStartScreen())}drawHUD(){let{ctx:e}=O();e.fillStyle="white",e.font="24px Arial",e.textAlign="left",e.fillText(`Score: ${I}`,20,30);let o=$e(ee);e.fillText(`Time: ${o}`,20,60),e.font="24px Arial",e.fillText(`Lives: ${U}`,20,90),e.font="24px Arial",e.fillText(`Difficulty: ${S.charAt(0).toUpperCase()+S.slice(1)}`,20,120)}drawGameOverScreen(){let{ctx:e}=O();e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",e.canvas.width/2,80),e.font="24px Arial",e.textAlign="center",e.fillText(`Score: ${I}`,e.canvas.width/2,150),e.fillText(`Time: ${$e(ee)}`,e.canvas.width/2,190),e.fillText(`Difficulty: ${S.charAt(0).toUpperCase()+S.slice(1)}`,e.canvas.width/2,230),e.font="24px Arial",e.textAlign="center",e.fillText("Press SPACE to play again",e.canvas.width/2,e.canvas.height-100),fe(e.canvas.width/2,e.canvas.height-80)}cleanupGame(){ct&&cancelAnimationFrame(ct)}getAsteroidSpeed(e){let o=le[S].asteroidSpeed[e];return o.min+Math.random()*(o.max-o.min)}updateHUD(){let{ctx:e}=O();et(e,I,U,B,S)}checkExtraLife(e){let o=Se.EXTRA_LIFE_SCORE_THRESHOLD,i=Math.floor(ht/o)*o;Math.floor(e/o)*o>i&&(U++,ht=e,console.log(`BONUS SHIP! Extra life awarded at ${e} points. Lives: ${U}`),this.startExtraLifeAnimation())}startExtraLifeAnimation(){let{width:e}=E();A.active=!0,A.x=e-100,A.y=90,A.alpha=0,A.startTime=Date.now()}drawExtraLifeAnimation(){let{ctx:e}=O(),o=Date.now()-A.startTime;if(o<A.duration){let i=o/A.duration;A.alpha=i<.5?i*2:2-i*2,A.y-=20*.016,e.save(),e.fillStyle=`rgba(255, 255, 255, ${A.alpha})`,e.font="bold 24px Arial",e.textAlign="center",e.fillText(A.text,A.x,A.y),e.restore()}else A.active=!1}setRotateLeft(e){u&&(u.rotatingLeft=e)}setRotateRight(e){u&&(u.rotatingRight=e)}setThrusting(e){u&&(u.thrusting=e)}setFiring(e){u&&(u.shooting=e)}activateHyperspace(){!u||u.isDestroyed||u.exploding||u.isInHyperspace||u.enterHyperspace()}startNextLevel(){B++,te*=1.05,console.log(`Level ${B}: Speed multiplier increased to ${te.toFixed(2)}`);let e=Math.min(R+(B-1),15);this.createAsteroids(e)}},Pt=new Oe,dt=()=>Pt.initGame();Ge();document.addEventListener("DOMContentLoaded",()=>{dt()});
