var We="@vercel/analytics",Xe="1.5.0",ze=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function ge(){return typeof window<"u"}function ye(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function Ke(e="auto"){if(e==="auto"){window.vam=ye();return}window.vam=e}function Ve(){return(ge()?window.vam:ye())||"production"}function X(){return Ve()==="development"}function qe(e){return e.scriptSrc?e.scriptSrc:X()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Se(e={debug:!0}){var t;if(!ge())return;Ke(e.mode),ze(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));let o=qe(e);if(document.head.querySelector(`script[src*="${o}"]`))return;let i=document.createElement("script");i.src=o,i.defer=!0,i.dataset.sdkn=We+(e.framework?`/${e.framework}`:""),i.dataset.sdkv=Xe,e.disableAutoTrack&&(i.dataset.disableAutoTrack="1"),e.endpoint?i.dataset.endpoint=e.endpoint:e.basePath&&(i.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(i.dataset.dsn=e.dsn),i.onerror=()=>{let s=X()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${o}. ${s}`)},X()&&e.debug===!1&&(i.dataset.debug="false"),document.head.appendChild(i)}var g,M;function Te(){return g=document.getElementById("gameCanvas"),M=g.getContext("2d"),z(),{canvas:g,ctx:M}}function N(){return{canvas:g,ctx:M}}function z(){g&&(console.log("Resizing canvas to fit window..."),g.width=window.innerWidth,g.height=window.innerHeight)}function C(e="black"){!M||!g||(M.clearRect(0,0,g.width,g.height),M.fillStyle=e,M.fillRect(0,0,g.width,g.height))}function p(){return g?{width:g.width,height:g.height}:{width:0,height:0}}async function Ee(){console.log("Fetching global games played count...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/gamesPlayed",{signal:e.signal,cache:"no-store"});if(clearTimeout(t),!o.ok)throw console.warn(`API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return typeof i.count=="number"?(console.log(`Global games played count: ${i.count}`),i.count):(console.warn("Received invalid count from API."),50)}catch(e){return e.name==="AbortError"?console.error("API request timed out after 3 seconds"):console.error("Failed to fetch games played count:",e),console.log("Using fallback games played count: 50"),50}}async function we(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch("/api/incrementGamesPlayed",{method:"POST",signal:e.signal,cache:"no-store"});return clearTimeout(t),o.ok?(console.log("Successfully triggered server-side games played increment."),!0):(console.error(`Failed to increment games played count on server. Status: ${o.status}`),!1)}catch(e){return e.name==="AbortError"?console.error("API request to increment games count timed out after 3 seconds"):console.error("Network error trying to increment games played count:",e),!1}}async function K(){console.log("Fetching leaderboard data...");try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),o=await fetch("/api/leaderboard",{signal:e.signal,cache:"no-store",headers:{Accept:"application/json"}});if(clearTimeout(t),!o.ok)throw console.warn(`Leaderboard API returned error status: ${o.status}`),new Error(`HTTP error! status: ${o.status}`);let i=await o.json();return console.log("Leaderboard data received:",i.length?`${i.length} entries`:"Empty array"),i.length>0&&console.log("First entry:",JSON.stringify(i[0])),i}catch(e){return console.error("Failed to fetch leaderboard:",e),[]}finally{console.log("Leaderboard fetch completed")}}async function Ie(e,t,o=0,i=1,s="medium"){console.log(`Submitting score: ${t} points, Level ${i}, ${o}ms, ${s} difficulty`);try{let n=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:e,score:t,time:o,level:i,difficulty:s,date:new Date().toISOString()})});if(!n.ok){let c=await n.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${n.status} ${c.message||""}`)}let r=await n.json();return console.log("Submission result:",r.message),!0}catch(n){return console.error("Error submitting score:",n),!1}}var B={FPS:60,INITIAL_LIVES:3,LEVEL_MULTIPLIER:.5,INITIAL_ASTEROIDS:4,ASTEROID_INCREMENT_PER_LEVEL:2,EXTRA_LIFE_SCORE_THRESHOLD:1e4,FRAME_DURATION:16.666666666666668,SPAWN_BUFFER:100},v={RADIUS:15,ROTATION_SPEED:4,ACCELERATION:200,FRICTION:.98,INVINCIBILITY_TIME:3e3,SHOOT_COOLDOWN:250},U={RADIUS:2,SPEED:500,LIFESPAN:1e3},x={BASE_RADIUS:50,SPEED_MULTIPLIER:50,ROTATION_SPEED:1,POINTS_BASE:100,COLLISION_DAMAGE:1,SPAWN_DISTANCE_MIN:100,SCORE_VALUES:{1:100,2:200,3:300},TYPES:["bront","steg","trex"]};var q={bront:"./images/bront.png",steg:"./images/steg.png",trex:"./images/trex.png"};var St=Math.PI*2;var Tt=.07*3,Et=.18*3;var wt=.6*3,It=1.6*3;var k={easy:{playerAcceleration:.54,shootCooldown:120,asteroidSpeed:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},initialAsteroids:2,lives:5},medium:{playerAcceleration:.81,shootCooldown:84,asteroidSpeed:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},initialAsteroids:3,lives:3},difficult:{playerAcceleration:1.08,shootCooldown:60,asteroidSpeed:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}},initialAsteroids:4,lives:2}},V={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},At={[V.BIG]:{baseSize:45,score:20},[V.MEDIUM]:{baseSize:25,score:50},[V.LITTLE]:{baseSize:15,score:100}};var Ae={};function ve(e){return console.log("Preloading dinosaur images..."),new Promise((t,o)=>{let i=0,s=Object.keys(q).length;if(s===0){console.log("No dinosaur images to load."),e&&e(),t();return}let n=()=>{console.log("All dinosaur images loaded successfully!"),e&&e(),t()},r=a=>{console.log(`${a} dinosaur image loaded.`),i++,i===s&&n()},c=(a,l)=>{console.error(`Error loading ${a} dinosaur image:`,l),i++,i===s&&n()};Object.entries(q).forEach(([a,l])=>{let h=new Image;h.onload=()=>r(a),h.onerror=f=>c(a,f),h.src=l,Ae[a]=h})})}function xe(e){return Ae[e]||null}var Q={},Z=null,j=null,J=null,Y=null;function Pe(){window.addEventListener("keydown",Ze),window.addEventListener("keyup",je)}function Ze(e){Q[e.code]=!0,(e.code==="Enter"||e.code==="NumpadEnter")&&Z&&Z(),(e.key==="?"||e.code==="Slash"&&e.shiftKey)&&j&&(j(),e.preventDefault()),e.code==="Escape"&&J&&J(),Y&&(e.code==="KeyE"?Y("easy"):e.code==="KeyM"?Y("medium"):e.code==="KeyD"&&Y("difficult"))}function je(e){Q[e.code]=!1}function $(e){return Q[e]===!0}function ee(e){Z=e}function te(e){j=e}function ie(e){J=e}function oe(e){Y=e}var ne=class{constructor(){let{width:t,height:o}=p();this.x=t/2,this.y=o/2,this.radius=v.RADIUS,this.rotation=0,this.thrustPower=0,this.velocityX=0,this.velocityY=0,this.rotationSpeed=v.ROTATION_SPEED,this.acceleration=v.ACCELERATION,this.friction=v.FRICTION,this.canShoot=!0,this.shootCooldown=v.SHOOT_COOLDOWN,this.lastShot=0,this.isThrusting=!1,this.isDestroyed=!1,this.invincible=!1,this.invincibilityTime=0,this.explosionParticles=[],this.explosionDuration=2e3,this.explosionElapsed=0,this.exploding=!1,this.isInHyperspace=!1,this.hyperspaceTime=0,this.hyperspaceCooldown=3e3,this.lastHyperspace=0}update(t){if(this.exploding){this.explosionElapsed+=t*1e3;let{width:h,height:f}=p();for(let I=0;I<this.explosionParticles.length;I++){let u=this.explosionParticles[I];u.x+=u.vx*t,u.y+=u.vy*t,u.x<0&&(u.x=h),u.x>h&&(u.x=0),u.y<0&&(u.y=f),u.y>f&&(u.y=0),u.angle+=u.rotationSpeed*t,u.alpha=1-this.explosionElapsed/this.explosionDuration}return this.explosionElapsed>=this.explosionDuration&&(this.exploding=!1,this.explosionParticles=[],console.log("Explosion animation complete")),null}if(this.isDestroyed)return null;this.invincible&&(this.invincibilityTime-=t*1e3,this.invincibilityTime<=0&&(this.invincible=!1,this.invincibilityTime=0));let i=Date.now()-this.lastHyperspace>this.hyperspaceCooldown;if($("KeyH")&&i&&!this.isInHyperspace)return this.hyperspace(),null;if($("ArrowLeft")&&(this.rotation-=this.rotationSpeed*t),$("ArrowRight")&&(this.rotation+=this.rotationSpeed*t),this.isThrusting=$("ArrowUp"),this.isThrusting){let h=Math.cos(this.rotation)*this.acceleration,f=Math.sin(this.rotation)*this.acceleration;this.velocityX+=h*t,this.velocityY+=f*t}let s=1-(1-this.friction)*Math.min(1,t*5);this.velocityX*=s,this.velocityY*=s;let n=300,r=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);if(r>n){let h=n/r;this.velocityX*=h,this.velocityY*=h}this.x+=this.velocityX*t,this.y+=this.velocityY*t;let{width:c,height:a}=p();this.x<0&&(this.x=c),this.x>c&&(this.x=0),this.y<0&&(this.y=a),this.y>a&&(this.y=0);let l=null;if($("Space")&&this.canShoot&&!this.isDestroyed){let h=Date.now();h-this.lastShot>this.shootCooldown&&(l={x:this.x+Math.cos(this.rotation)*this.radius,y:this.y+Math.sin(this.rotation)*this.radius,rotation:this.rotation},this.lastShot=h)}return l}draw(t){if(this.exploding&&this.explosionParticles.length>0){for(let o=0;o<this.explosionParticles.length;o++){let i=this.explosionParticles[o];t.save(),t.globalAlpha=i.alpha,t.strokeStyle=i.color,t.lineWidth=1,t.beginPath(),t.moveTo(i.x,i.y);let s=i.x+Math.cos(i.angle)*i.length,n=i.y+Math.sin(i.angle)*i.length;t.lineTo(s,n),t.stroke(),t.restore()}return}if(!this.isDestroyed&&!(this.invincible&&Math.floor(Date.now()/100)%2===0)){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(this.radius,0),t.lineTo(-this.radius*.7,-this.radius*.7),t.lineTo(-this.radius*.5,0),t.lineTo(-this.radius*.7,this.radius*.7),t.closePath(),t.stroke(),this.isThrusting){t.beginPath(),t.moveTo(-this.radius*.5,0),t.lineTo(-this.radius*1.5,0);let o=Math.random()*.5+.5;t.lineTo(-this.radius*(1+o),.5*this.radius*o),t.lineTo(-this.radius*.5,0),t.fillStyle="orange",t.fill()}t.restore()}}destroy(){console.log("Player destroy method called!"),this.isDestroyed=!0,this.createExplosion(),console.log("After createExplosion, exploding flag:",this.exploding)}createExplosion(){console.log("Creating ship explosion animation!"),this.exploding=!0,this.explosionElapsed=0,this.explosionParticles=[];let t=15,o="#ffffff";for(let i=0;i<t;i++){let s=Math.random()*Math.PI*2,n=20+Math.random()*80,r=5+Math.random()*10;this.explosionParticles.push({x:this.x,y:this.y,vx:Math.cos(s)*n,vy:Math.sin(s)*n,angle:s,length:r,color:o,alpha:1,rotationSpeed:(Math.random()-.5)*5})}}reset(){let{width:t,height:o}=p();this.x=t/2,this.y=o/2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.isDestroyed=!1,this.exploding=!1,this.explosionParticles=[],this.invincible=!0,this.invincibilityTime=v.INVINCIBILITY_TIME}isCollidingWith(t){if(this.isDestroyed||this.invincible)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}hyperspace(){console.log("Hyperspace jump initiated!"),this.lastHyperspace=Date.now(),this.isInHyperspace=!0;let{width:t,height:o}=p(),i=50,s=i+Math.random()*(t-i*2),n=i+Math.random()*(o-i*2);this.x=s,this.y=n,this.velocityX*=.5,this.velocityY*=.5,this.invincible=!0,this.invincibilityTime=v.INVINCIBILITY_TIME,setTimeout(()=>{this.isInHyperspace=!1},100)}},Le=ne;function De(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function P(e,t){return Math.random()*(t-e)+e}var se=class e{constructor(t,o,i,s,n="medium"){let{width:r,height:c}=p();this.type=t||this.getRandomType(),this.size=o||1,this.difficulty=n,this.radius=x.BASE_RADIUS/this.size,this.x=i!==void 0?i:P(0,r),this.y=s!==void 0?s:P(0,c);let a=this.getSizeCategory(),l=k[n].asteroidSpeed[a],h=P(l.min,l.max),f=Math.random()*Math.PI*2;this.velocityX=Math.cos(f)*h,this.velocityY=Math.sin(f)*h,this.rotation=0,this.rotationSpeed=P(-1,1)*x.ROTATION_SPEED;let I=this.getImageKey();this.image=xe(I),this.points=x.POINTS_BASE*this.size}getSizeCategory(){switch(this.size){case 1:return"large";case 2:return"medium";case 3:return"small";default:return"large"}}getRandomType(){let t=["bront","steg","trex"];return t[De(0,t.length-1)]}getImageKey(){return this.type}update(t){this.x+=this.velocityX,this.y+=this.velocityY,this.rotation+=this.rotationSpeed*t;let{width:o,height:i}=p();this.x<-this.radius&&(this.x=o+this.radius),this.x>o+this.radius&&(this.x=-this.radius),this.y<-this.radius&&(this.y=i+this.radius),this.y>i+this.radius&&(this.y=-this.radius)}draw(t){if(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),this.image){let o=this.radius*2/Math.max(this.image.width,this.image.height),i=this.image.width*o,s=this.image.height*o;t.drawImage(this.image,-i/2,-s/2,i,s)}else t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.strokeStyle="gray",t.stroke();t.restore()}break(){if(this.size>=3)return[];let t=[];if(this.size===1){let o=Math.random();o<.25?this.createChildAsteroids(2,2,t):o<.45?this.createChildAsteroids(2,3,t):o<.75?(this.createChildAsteroids(1,2,t),this.createChildAsteroids(1,3,t)):o<.9?this.createChildAsteroids(1,2,t):this.createChildAsteroids(1,3,t)}else this.size===2&&(Math.random()<.7?this.createChildAsteroids(2,3,t):this.createChildAsteroids(1,3,t));return t}createChildAsteroids(t,o,i){for(let s=0;s<t;s++){let n=P(-10,10),r=P(-10,10),c=new e(this.type,o,this.x+n,this.y+r,this.difficulty),a=Math.random()*Math.PI*2,l=c.getSizeCategory(),h=k[this.difficulty].asteroidSpeed[l],f=P(h.min,h.max);c.velocityX=Math.cos(a)*f,c.velocityY=Math.sin(a)*f,i.push(c)}}isCollidingWith(t){let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}},be=se;var re=class{constructor(t,o,i){this.x=t,this.y=o,this.angle=i,this.velocityX=Math.cos(i)*U.SPEED,this.velocityY=Math.sin(i)*U.SPEED,this.radius=U.RADIUS,this.lifespan=U.LIFESPAN,this.active=!0}update(t){if(!this.active)return!1;if(this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.lifespan-=t*1e3,this.lifespan<=0)return this.active=!1,!1;let{width:o,height:i}=p();return this.x<-this.radius||this.x>o+this.radius||this.y<-this.radius||this.y>i+this.radius?(this.active=!1,!1):!0}draw(t){this.active&&(t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="white",t.fill())}isCollidingWith(t){if(!this.active)return!1;let o=this.x-t.x,i=this.y-t.y;return Math.sqrt(o*o+i*i)<this.radius+t.radius}deactivate(){this.active=!1}},Me=re;function Oe(e,t,o,i,s){let{width:n,height:r}=p();e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${t}`,20,30),e.textAlign="center",e.fillText(`Level: ${i}`,n/2,30),Je(e,o,n-20,30)}function Je(e,t,o,i){for(let s=0;s<t;s++)Qe(e,o-s*25,i-5,10)}function Qe(e,t,o,i){e.save(),e.translate(t,o),e.rotate(-Math.PI/2),e.strokeStyle="white",e.lineWidth=1.5,e.beginPath(),e.moveTo(i,0),e.lineTo(-i*.7,-i*.7),e.lineTo(-i*.4,0),e.lineTo(-i*.7,i*.7),e.closePath(),e.stroke(),e.restore()}var y="",_e=3,ce=!1,ae=null,le=null;function he(e,t,o=[],i=1,s=0){let{width:n,height:r}=p();if(C("black"),e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("GAME OVER",n/2,r/4),e.font="32px Arial",e.fillText(`Score: ${t}`,n/2,r/4+60),et(t,o)){e.font="24px Arial",e.fillText("New High Score!",n/2,r/4+100),e.fillText("Enter your initials:",n/2,r/4+140);let a=40,l=40,h=10,f=a*3+h*2,I=n/2-f/2,u=r/4+160;for(let b=0;b<3;b++){let H=I+b*(a+h);e.strokeStyle="white",e.lineWidth=2,e.strokeRect(H,u,a,l),e.font="32px Arial",e.fillStyle="white",e.textAlign="center",b<y.length?e.fillText(y[b],H+a/2,u+30):e.fillText("_",H+a/2,u+30)}}else e.font="24px Arial",e.fillText("Press SPACE to play again",n/2,r/4+120)}function et(e,t){if(!t||t.length===0||t.length<20)return!0;let o=[...t].sort((s,n)=>n.score-s.score),i=o[o.length-1].score;return e>i}function O(e){ce?(console.log(`Key pressed for initials: ${e.key}`),e.key.length===1&&/[A-Za-z]/.test(e.key)?y.length<_e&&(y+=e.key.toUpperCase(),console.log(`Current initials: ${y}`),y.length===_e&&ae&&(console.log("All initials entered, submitting..."),setTimeout(()=>{ae(y),tt()},500))):e.key==="Backspace"&&(y=y.slice(0,-1),console.log(`Backspace pressed, initials now: ${y}`))):e.code==="Space"&&le&&(console.log("Space pressed for restart"),le())}function tt(){y="",ce=!1}function Re(){ce=!0,y=""}function Ne(e){ae=e}function Ce(e){le=e}function de(e,t,o,i){o&&o.length>0&&(console.log("Leaderboard data keys:",Object.keys(o[0])),console.log("Sample entry:",o[0]));let s=[...o].sort((c,a)=>a.score-c.score).slice(0,20),n=Math.min(s.length,20,Math.floor((i.canvas.height-t-50)/25)),r=500;i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(e-r/2,t,r,n*25+50),i.fillStyle="white",i.font="bold 24px Arial",i.textAlign="center",i.fillText("High Scores",e,t+30),i.font="16px Arial",i.textAlign="left",i.fillText("Rank",e-r/2+20,t+60),i.fillText("Score",e-r/2+80,t+60),i.fillText("Initials",e-r/2+160,t+60),i.fillText("Level",e-r/2+230,t+60),i.fillText("Date",e-r/2+300,t+60),i.fillText("Time",e-r/2+380,t+60),i.font="16px Arial";for(let c=0;c<n;c++){let a=s[c],l=t+85+c*25;a.isCurrent&&(i.fillStyle="rgba(255, 255, 0, 0.3)",i.fillRect(e-r/2+10,l-15,r-20,20),i.fillStyle="white"),i.textAlign="left",i.fillText(`${c+1}.`,e-r/2+20,l),i.fillText(`${a.score}`,e-r/2+80,l),i.fillText(a.initials||"---",e-r/2+160,l),i.fillText(a.level||"1",e-r/2+230,l);let h=a.date||a.createdAt||a.created_at;if(h)try{let f=new Date(h);if(isNaN(f.getTime()))i.fillText("--/--/--",e-r/2+300,l),i.fillText("--:--",e-r/2+380,l);else{let I=`${f.getMonth()+1}/${f.getDate()}/${f.getFullYear().toString().substr(2)}`;i.fillText(I,e-r/2+300,l);let u=f.getHours(),b=f.getMinutes(),H=u>=12?"PM":"AM",Be=`${u%12||12}:${b.toString().padStart(2,"0")} ${H}`;i.fillText(Be,e-r/2+380,l)}}catch(f){console.error("Error parsing date:",f,"for score:",a),i.fillText("--/--/--",e-r/2+300,l),i.fillText("--:--",e-r/2+380,l)}else i.fillText("--/--/--",e-r/2+300,l),i.fillText("--:--",e-r/2+380,l)}o.length>n&&(i.textAlign="center",i.font="14px Arial",i.fillText(`Showing ${n} of ${o.length} scores`,e,t+n*25+40))}function ke(e,t,o=[],i=0){let{width:s,height:n}=p();e.fillStyle="white",e.font="bold 48px Arial",e.textAlign="center",e.fillText("DINOSTROIDS",s/2,n/3),e.font="24px Arial",e.fillText("Select Difficulty:",s/2,n/2-30);let r=[{key:"E",label:"Easy",value:"easy"},{key:"M",label:"Medium",value:"medium"},{key:"D",label:"Difficult",value:"difficult"}],c=n/2+30;r.forEach((a,l)=>{let h=s/2-150+l*150,f=t===a.value;f&&(e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(h-65,c-30,130,40)),e.fillStyle=f?"#ffff00":"white",e.fillText(`${a.key}: ${a.label}`,h,c)}),e.fillStyle="white",e.font="24px Arial",e.fillText("Press RETURN to start",s/2,n*2/3+20),e.fillText("Press ? for help",s/2,n*2/3+60),i>0&&(e.font="16px Arial",e.fillText(`Games Played: ${i}`,s/2,n-80)),e.font="14px Arial",e.fillText("\xA9 Intensity Ventures, 2025",s/2,n-20),o&&o.length>0&&de(s-300,50,o,e)}var F=!1,E=!1,T=!1,_=!1,it=!1,fe=0,R=0,W=B.INITIAL_LIVES,G=1,$e=0,A=[],me=0,Ge=0;var w="medium",d=null,S=[],L=[],m=null,ot,nt,st,rt,at;function D(){let{ctx:e}=N();console.log("Showing start screen"),E=!1,_=!1,F=!1,T=!1,m&&(cancelAnimationFrame(m),m=null),document.removeEventListener("keydown",O),pe(),He(),C("black"),ke(e,w,A,$e)}function lt(){console.log("Game ended by user (ESC key)"),E=!1,T=!0,F=!1,m&&(cancelAnimationFrame(m),m=null),d=null,S=[],L=[],D()}function Fe(){let{canvas:e,ctx:t}=N();C("black"),t.fillStyle="white",t.font="bold 36px Arial",t.textAlign="center",t.fillText("HOW TO PLAY",e.width/2,100),t.font="20px Arial",t.textAlign="left";let o=["CONTROLS:","\u2022 Arrow Keys: Move ship","\u2022 Space: Fire","\u2022 H: Hyperspace jump (random teleport)","\u2022 ?: Toggle help screen","\u2022 ESC: End game and return to menu","","OBJECTIVE:","\u2022 Destroy all dinosaur asteroids","\u2022 Avoid collisions","\u2022 Score as many points as possible","","TIPS:","\u2022 Use hyperspace to escape danger","\u2022 You're invincible for 3 seconds after hyperspace"],i=150,s=30;o.forEach((n,r)=>{t.fillText(n,e.width/4,i+r*s)}),t.font="24px Arial",t.textAlign="center",t.fillText("Press ? to return",e.width/2,e.height-50)}function He(){pe(),ee(()=>{console.log("Start key pressed"),!_&&!E&&ct()}),te(ft),ie(()=>{E&&!T&&lt()}),oe(e=>{(!E||T)&&(w=e,ut(),D())})}function pe(){ee(null),te(null),ie(null),oe(null)}function ct(){if(_||E||T)return;console.log(`Starting game with ${w} difficulty...`),E=!0,T=!1,F=!0,R=0;let e=k[w];W=e.lives,G=1,d=new Le,d.acceleration=50,w==="medium"?d.acceleration=75:w==="difficult"&&(d.acceleration=100),d.shootCooldown=e.shootCooldown,console.log(`Player acceleration set to: ${d.acceleration}`),Ue(e.initialAsteroids),L=[],Ge=Date.now(),me=0,we().catch(t=>console.error("Failed to increment games played:",t)),fe=performance.now(),m=requestAnimationFrame(ue)}function Ue(e){let{width:t,height:o}=p();S=[];for(let i=0;i<e;i++){let s,n,r;do{s=Math.random()*t,n=Math.random()*o;let a=d?d.x-s:t/2-s,l=d?d.y-n:o/2-n;r=Math.sqrt(a*a+l*l)}while(r<x.SPAWN_DISTANCE_MIN);let c=new be(null,1,s,n,w);S.push(c)}}function ue(e){let t=(e-fe)/1e3;fe=e;let o=Math.min(t,.1);if(it||!F){m=requestAnimationFrame(ue);return}me=Date.now()-Ge,C("black");let{ctx:i,canvas:s}=N();if(d){(d.isDestroyed||d.exploding||d.isInHyperspace)&&console.log(`Player state: destroyed=${d.isDestroyed}, exploding=${d.exploding}, hyperspace=${d.isInHyperspace}`);let n=d.update(o);n&&L.push(new Me(n.x,n.y,n.rotation)),d.draw(i)}for(let n=L.length-1;n>=0;n--){let r=L[n];if(!r.update(o)){L.splice(n,1);continue}r.draw(i);for(let c=S.length-1;c>=0;c--){let a=S[c];if(r.isCollidingWith(a)){r.deactivate(),L.splice(n,1);let l=a.break();R+=x.SCORE_VALUES[a.size]||100,S.push(...l),S.splice(c,1);break}}}if(S.forEach(n=>{n.update(o),n.draw(i)}),d&&!d.isDestroyed&&!d.exploding&&!d.isInHyperspace&&!d.invincible)for(let n=S.length-1;n>=0;n--){let r=S[n];if(d.isCollidingWith(r)){console.log("Player hit by asteroid!"),d.destroy(),W-=x.COLLISION_DAMAGE,W<=0?setTimeout(()=>{ht()},2e3):setTimeout(()=>{d.reset()},2e3);break}}if(S.length===0&&E&&!T){G++;let n=Math.min(B.INITIAL_ASTEROIDS+(G-1)*B.ASTEROID_INCREMENT_PER_LEVEL,20);Ue(n)}Oe(i,R,W,G,w),m=requestAnimationFrame(ue)}function ht(){console.log("Game over!"),T=!0,F=!1,m&&(cancelAnimationFrame(m),m=null);let e=me;d&&(d=null),S=[],L=[],document.removeEventListener("keydown",O);let t=dt(),{ctx:o}=N();he(o,R,A,G,e),document.addEventListener("keydown",O),t?(console.log("New high score detected!"),Re(),Ne(async i=>{try{console.log(`Submitting high score with initials: ${i}`),await Ie(i,R,e,G,w),A=await K(),document.removeEventListener("keydown",O),T=!1,E=!1,F=!1,m&&(cancelAnimationFrame(m),m=null),D()}catch(s){console.error("Failed to submit score:",s),document.removeEventListener("keydown",O),T=!1,m&&(cancelAnimationFrame(m),m=null),D()}})):Ce(()=>{console.log("Restarting game..."),document.removeEventListener("keydown",O),T=!1,E=!1,pe(),m&&(cancelAnimationFrame(m),m=null),D()})}function dt(){if(!A||A.length===0||A.length<20)return!0;let e=[...A].sort((t,o)=>o.score-t.score);return R>e[Math.min(19,e.length-1)].score}function ft(){E||(_=!_,_?Fe():D())}function Ye(){console.log("Initializing game...");let{canvas:e}=Te();window.addEventListener("resize",()=>{if(z(),!E)_?Fe():D();else if(T){let{ctx:t}=N();he(t,R,A)}}),Pe(),He(),ve(()=>{console.log("Images loaded, proceeding with game initialization..."),Promise.allSettled([(async()=>{try{$e=await Ee()}catch(t){console.error("Failed to fetch games played:",t)}})(),(async()=>{try{A=await K()}catch(t){console.error("Failed to fetch leaderboard:",t)}})()]).then(()=>{console.log("Game data loaded, showing start screen"),D()})})}function ut(){let e=k[w];ot=e.playerAcceleration,nt=e.shootCooldown,st=e.asteroidSpeed,rt=e.initialAsteroids,at=e.lives}Se();document.addEventListener("DOMContentLoaded",()=>{Ye()});
