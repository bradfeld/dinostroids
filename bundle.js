var ce="@vercel/analytics",de="1.5.0",he=()=>{window.va||(window.va=function(...i){(window.vaq=window.vaq||[]).push(i)})};function X(){return typeof window<"u"}function Z(){try{let e="production";if(e==="development"||e==="test")return"development"}catch{}return"production"}function fe(e="auto"){if(e==="auto"){window.vam=Z();return}window.vam=e}function ue(){return(X()?window.vam:Z())||"production"}function O(){return ue()==="development"}function ge(e){return e.scriptSrc?e.scriptSrc:O()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function j(e={debug:!0}){var i;if(!X())return;fe(e.mode),he(),e.beforeSend&&((i=window.va)==null||i.call(window,"beforeSend",e.beforeSend));let n=ge(e);if(document.head.querySelector(`script[src*="${n}"]`))return;let o=document.createElement("script");o.src=n,o.defer=!0,o.dataset.sdkn=ce+(e.framework?`/${e.framework}`:""),o.dataset.sdkv=de,e.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),e.endpoint?o.dataset.endpoint=e.endpoint:e.basePath&&(o.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(o.dataset.dsn=e.dsn),o.onerror=()=>{let a=O()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${n}. ${a}`)},O()&&e.debug===!1&&(o.dataset.debug="false"),document.head.appendChild(o)}j();var s=document.getElementById("gameCanvas"),t=s.getContext("2d");s.width=window.innerWidth;s.height=window.innerHeight;var b=Math.PI*2;var me=15,we=.07*3,M=.18*3,ye=.98,ee=3e3,pe=2,xe=8,Se=50,_=120,B=.6*3,F=1.6*3,te={large:45,medium:25,small:15},Y={easy:{large:{min:1.5,max:3},medium:{min:2.4,max:4.5},small:{min:3.6,max:6}},medium:{large:{min:2.4,max:4.5},medium:{min:3.6,max:6},small:{min:5.4,max:7.5}},difficult:{large:{min:3.6,max:6},medium:{min:5.4,max:7.5},small:{min:7.5,max:10.5}}},ie=10,p={easy:{playerAcceleration:M,shootCooldown:_,asteroidMinSpeed:B,asteroidSpeedVariation:F,initialAsteroidCountBase:2,lives:5},medium:{playerAcceleration:M*1.5,shootCooldown:Math.floor(_*.7),asteroidMinSpeed:B*1.5,asteroidSpeedVariation:F*1.2,initialAsteroidCountBase:3,lives:3},difficult:{playerAcceleration:M*2,shootCooldown:Math.floor(_*.5),asteroidMinSpeed:B*2,asteroidSpeedVariation:F*1.5,initialAsteroidCountBase:4,lives:2}},L="medium",ve=p.medium.playerAcceleration,ne=p.medium.shootCooldown,Te=p.medium.asteroidMinSpeed,Ae=p.medium.asteroidSpeedVariation,be=p.medium.initialAsteroidCountBase,J=p.medium.lives,H={BIG:"BIG",MEDIUM:"MEDIUM",LITTLE:"LITTLE"},Be={[H.BIG]:{baseSize:45,score:20},[H.MEDIUM]:{baseSize:25,score:50},[H.LITTLE]:{baseSize:15,score:100}};function K(e){if(!e||e.length===0)return"";let i=`M ${e[0].x} ${e[0].y}`;for(let n=1;n<e.length;n++)i+=` L ${e[n].x} ${e[n].y}`;return i+=" Z",i}var Ee={small:`<svg viewBox="-1.1 -0.9 2.2 1.8" width="2.2" height="1.8">
              <path fill="none" stroke="currentColor" stroke-width="0.1" stroke-linecap="round" stroke-linejoin="round"
                    d="${K([{x:.8,y:-.6},{x:1,y:-.4},{x:.9,y:0},{x:.5,y:.3},{x:.2,y:.8},{x:-.5,y:.7},{x:-1,y:.5},{x:-.8,y:0},{x:-.9,y:-.3},{x:-.4,y:-.6},{x:0,y:-.7},{x:.3,y:-.6},{x:.6,y:-.8}])}" />
            </svg>`,large:`<svg viewBox="-1.1 -0.9 2.1 1.9" width="2.1" height="1.9">
               <path fill="none" stroke="currentColor" stroke-width="0.1" stroke-linecap="round" stroke-linejoin="round"
                     d="${K([{x:.5,y:-.9},{x:.9,y:-.7},{x:.6,y:-.2},{x:.9,y:.1},{x:.5,y:.3},{x:.4,y:.8},{x:-.3,y:.9},{x:-.8,y:.6},{x:-1,y:0},{x:-.8,y:-.3},{x:-.9,y:-.6},{x:-.7,y:-.7},{x:-.3,y:-.8},{x:.2,y:-.3},{x:.3,y:-.5},{x:.1,y:-.8}])}" />
            </svg>`,medium:`<svg width="3.999" height="1.267" viewBox="0 0 3.999 1.267" xmlns="http://www.w3.org/2000/svg">
                <path fill="none" stroke="currentColor" stroke-width="0.015" stroke-linecap="round" stroke-linejoin="round"
                      d="m2.197 0-.064.04-.02.026-.06.093-.07.023-.2-.039-.033.004-.07.034-.186.08-.338.125-.098.085-.026.043L.82.61.598.705.453.75.341.761.2.776.01.79 0 .793l.04.023.249.068.284.049.214-.015.142-.01.24-.018.054-.008.05.01.025.044.015.077-.045.109-.037.1.045.042.37.001h.023l.03-.037-.02-.032-.01-.018-.01-.05.123-.106.019.037.022.056.042.104.052.048.345-.002.05-.007-.056-.098-.058-.118.038-.037h.25l.04-.008.03.052.078.128.126.064.223-.011h.104l.04-.008-.19-.2-.037-.044.032-.084.049-.029.178-.01.023-.004.152-.016.217.037.15.047.1-.018.01-.008.11-.139.002-.015L3.86.662 3.758.6l.24-.214-.105.01-.28.073-.062.003.17-.317-.045.004-.132.065-.193.09-.074.032-.031-.061-.17-.117-.167-.09L2.8.03 2.534.017l-.282-.01L2.24.004zm-.022.024.184.02.059.005.16.009h.056l.164.01.092.044.083.044.21.124.047.077.065.023.183-.086.135-.058-.025.073-.08.149.012.067.362-.094-.02.024-.132.112.035.087.118.112-.002.01-.12.14-.012.005-.138-.043L3.378.82l-.12.014-.026.005-.258.023-.068.03-.043.099.02.054.06.066.084.09.007.021-.123.003h-.18l-.042-.017-.063-.12-.07-.105-.064-.012-.047.004h-.252l-.043.029.062.157.02.054-.032.02h-.249l-.043-.035-.08-.183L1.8.964 1.76.986l-.105.087-.054.048.013.046.012.021-.046.038h-.3l.017-.055.058-.13-.021-.132-.008-.012L1.3.854h-.106l-.07.008-.226.02H.894l-.258.02L.34.864.188.819.176.81l.078-.01.235-.025.135-.039L.9.616l.155-.067.04-.054.1-.084.348-.13.21-.093.06-.006.198.037.06-.016.102-.154z" />
             </svg>`},r={x:s.width/2,y:s.height/2,angle:-Math.PI/2,speed:0,rotationSpeed:we,acceleration:M,friction:ye,size:me,canShoot:!0,lastShotTime:0,isInvulnerable:!1},d=[],h=[],m=0,E=3,T=1,C=!0;var g=!1,y=!1,u=null,w=null,N=!1,P=0,V=class{constructor(i,n,o){this.sizeType=i,this.x=n,this.y=o,this.radius=te[this.sizeType],this.size=this.radius,this.speed=Math.random()*(Y[L][this.sizeType].max-Y[L][this.sizeType].min)+Y[L][this.sizeType].min,this.angle=Math.random()*b,this.rotation=Math.random()*b,this.rotationSpeed=(Math.random()-.5)*.05,this.svgString=Ee[this.sizeType],this.canvgInstance=null,this.isRendering=!1;try{let a=this.svgString.match(/width="([^"]+)"/),l=this.svgString.match(/height="([^"]+)"/);this.baseWidth=a?parseFloat(a[1]):2,this.baseHeight=l?parseFloat(l[1]):2}catch(a){console.error("Error parsing SVG dimensions, using defaults.",a),this.baseWidth=2,this.baseHeight=2}}async draw(){if(this.x+this.radius<0||this.x-this.radius>s.width||this.y+this.radius<0||this.y-this.radius>s.height||this.isRendering)return;this.isRendering=!0,t.save(),t.translate(this.x,this.y),t.rotate(this.rotation);let i=this.radius*2,n=i/this.baseWidth,o=i/this.baseHeight,a=Math.min(n,o),l=this.baseWidth*a,c=this.baseHeight*a,x=-l/2,k=-c/2;try{let S=t.strokeStyle,A=this.svgString.replace(/currentColor/g,S);if(typeof Canvg<"u"){let f=await Canvg.fromString(t,A,{offsetX:x,offsetY:k,scaleWidth:l,scaleHeight:c,ignoreClear:!0,useCORS:!0});await f.render(),this.canvgInstance=f}else console.error("Canvg library not loaded."),t.beginPath(),t.arc(0,0,this.radius,0,b),t.strokeStyle="red",t.lineWidth=1,t.stroke()}catch(S){console.error("Error rendering SVG for asteroid:",S,this.svgString),t.beginPath(),t.arc(0,0,this.radius,0,b),t.strokeStyle="red",t.lineWidth=1,t.stroke()}finally{this.isRendering=!1,t.restore()}}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.rotation+=this.rotationSpeed,U(this)}},W=class{constructor(i,n,o){this.x=i,this.y=n,this.angle=o,this.speed=xe,this.radius=pe,this.size=this.radius,this.lifespan=Se}draw(){this.x<-this.radius||this.x>s.width+this.radius||this.y<-this.radius||this.y>s.height+this.radius||(t.beginPath(),t.arc(this.x,this.y,this.radius,0,b),t.fillStyle="white",t.fill())}update(){return this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.lifespan--,this.lifespan>0&&this.x>=-this.radius&&this.x<=s.width+this.radius&&this.y>=-this.radius&&this.y<=s.height+this.radius}},I={};document.addEventListener("keydown",e=>{if(I[e.key]=!0,e.key==="?"&&(g=!g,e.preventDefault()),!y&&!g){let i=e.key.toLowerCase(),n=null;i==="e"?n="easy":i==="m"?n="medium":i==="d"&&(n="difficult"),n&&(Me(n),Le(),e.preventDefault())}e.key==="Escape"&&y&&!g&&(C&&re(),e.preventDefault())});document.addEventListener("keyup",e=>{I[e.key]=!1});function U(e){let i=typeof e.radius<"u"?e.radius:e.size;e.x<-i&&(e.x=s.width+i),e.x>s.width+i&&(e.x=-i),e.y<-i&&(e.y=s.height+i),e.y>s.height+i&&(e.y=-i)}function G(e="large",i=null,n=null){let o=te[e],a=r.size+o+100;if(i===null||n===null){let c=0;do i=o+Math.random()*(s.width-2*o),n=o+Math.random()*(s.height-2*o),c++;while(c<50&&Math.sqrt(Math.pow(i-r.x,2)+Math.pow(n-r.y,2))<a);c>=50&&console.warn("Could not find a safe spawn location far from the player after 50 attempts. Spawning anyway."),console.log(`Spawning ${e} asteroid randomly inside canvas at (${i.toFixed(1)}, ${n.toFixed(1)})`)}else console.log(`Spawning split ${e} asteroid at provided location (${i.toFixed(1)}, ${n.toFixed(1)})`);let l=new V(e,i,n);h.push(l),console.log(`Asteroids array length: ${h.length}`)}function Q(e,i){let n=e.x-i.x,o=e.y-i.y,a=Math.sqrt(n*n+o*o),l=typeof e.radius<"u"?e.radius:e.size,c=typeof i.radius<"u"?i.radius:i.size;return a<l+c}async function re(){C=!1;let e=m;await q();let i=!1;u&&!w?u.length<ie?i=e>0:i=e>u[u.length-1].score:w&&console.error("Cannot check leaderboard qualification due to fetch error.");let n=null,o=!1,a=null;if(i){for(;;){if(n=prompt(`You made the leaderboard! Score: ${e}
Enter your initials (1-3 characters):`),n===null){n=null;break}if(n=n.trim().toUpperCase(),n.length>0&&n.length<=3)break;alert("Please enter 1 to 3 characters for your initials.")}if(n)try{o=await Ie(n,e),o&&await q()}catch(x){a=x.message}}t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,s.width,s.height),t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";let l=s.width/2,c=s.height/2;t.font="48px Arial",t.fillText("GAME OVER",l,c-150),t.font="30px Arial",t.fillText(`Final Score: ${e}`,l,c-100),t.font="20px Arial",i?n?o?t.fillText("Score submitted to leaderboard!",l,c-60):a?(t.fillText(`Submission Error: ${a}`,l,c-60),t.fillText("Your score was not saved.",l,c-30)):t.fillText("Score qualified, but was not submitted.",l,c-60):t.fillText("You qualified, but did not enter initials.",l,c-60):w?t.fillText("Could not check leaderboard ranking.",l,c-60):t.fillText("Better luck next time!",l,c-60),t.font="20px Arial",t.fillText("Returning to Title Screen...",l,c+150),setTimeout(()=>{oe()},3e3)}async function Ie(e,i){console.log(`Submitting score: ${e} - ${i}`);try{let n=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initials:e,score:i})});if(!n.ok){let a=await n.json().catch(()=>({message:"Unknown error"}));throw new Error(`Failed to submit score: ${n.status} ${a.message||""}`)}let o=await n.json();return console.log("Submission result:",o.message),!0}catch(n){throw console.error("Error submitting score:",n),n}}async function R(e){if(g){se(),requestAnimationFrame(R);return}if(!y){Pe(),requestAnimationFrame(R);return}if(t.clearRect(0,0,s.width,s.height),t.fillStyle="black",t.fillRect(0,0,s.width,s.height),I.ArrowUp?r.speed+=r.acceleration:r.speed*=r.friction,I[" "]&&r.canShoot){let n=r.x+Math.cos(r.angle)*r.size,o=r.y+Math.sin(r.angle)*r.size;d.push(new W(n,o,r.angle)),r.canShoot=!1,r.lastShotTime=e}!r.canShoot&&e-r.lastShotTime>ne&&(r.canShoot=!0),r.x+=Math.cos(r.angle)*r.speed,r.y+=Math.sin(r.angle)*r.speed,U(r);for(let n=d.length-1;n>=0;n--)d[n].update()||d.splice(n,1);Ce(),t.fillStyle="white",t.font="20px Arial",t.textBaseline="top",t.textAlign="left",t.fillText("Level: "+T,10,10),t.textAlign="center",t.fillText("Score: "+m,s.width/2,10),t.textAlign="right",t.fillText("Lives: "+E,s.width-10,10),ke();for(let n of d)n.draw();let i=[];for(let n of h)i.push(n.draw());try{await Promise.all(i)}catch(n){console.error("Error during asteroid drawing batch:",n)}requestAnimationFrame(R)}function ke(){t.save(),t.translate(r.x,r.y),t.rotate(r.angle),t.beginPath(),t.moveTo(r.size,0),t.lineTo(-r.size*.7,r.size*.7),t.lineTo(-r.size*.4,0),t.lineTo(-r.size*.7,-r.size*.7),t.closePath(),t.strokeStyle="cyan",t.lineWidth=2,t.stroke(),I.ArrowUp&&(t.beginPath(),t.moveTo(-r.size*.5,0),t.lineTo(-r.size*.9,r.size*.4),t.lineTo(-r.size*1.2,0),t.lineTo(-r.size*.9,-r.size*.4),t.closePath(),t.fillStyle="orange",t.fill()),t.restore()}function se(){t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,s.width,s.height),t.fillStyle="white",t.font="32px Arial",t.textAlign="center",t.textBaseline="middle";let e=s.width/2,i=s.height/2-100,n=40;t.fillText("Controls",e,i),t.font="20px Arial",t.fillText("Arrow Left: Rotate Left",e,i+n*1.5),t.fillText("Arrow Right: Rotate Right",e,i+n*2.5),t.fillText("Arrow Up: Thrust",e,i+n*3.5),t.fillText("Spacebar: Shoot",e,i+n*4.5),t.fillText("?: Toggle Help / Pause",e,i+n*5.5),t.fillText("Esc: End Game",e,i+n*6.5),t.font="24px Arial",t.fillText("Press ? to close",e,i+n*8.5)}async function q(){N=!0,w=null;try{let e=await fetch("/api/leaderboard");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);u=await e.json()}catch(e){console.error("Failed to fetch leaderboard:",e),w=e.message}finally{N=!1}}function Pe(){t.clearRect(0,0,s.width,s.height),t.fillStyle="black",t.fillRect(0,0,s.width,s.height),t.fillStyle="white",t.textAlign="center";let e=s.width/2,i=s.height*.15;t.font="84px Arial",t.textBaseline="middle",t.fillText("DINOSTROIDS",e,i);let n=i+100,o=n+40,a=25;t.font="32px Arial",t.fillText("TOP SCORES",e,n),t.font="16px Arial",t.textBaseline="top";let l=o;if(N)t.fillText("Loading...",e,o),l+=a;else if(w)t.fillText(`Error loading scores: ${w}`,e,o),l+=a;else if(u&&u.length>0){let x=e-180,k=e-100,S=e+50,A=e+110,f=o;t.textAlign="left",t.fillText("Rank",x,f),t.fillText("Initials",k,f),t.textAlign="right",t.fillText("Score",S+40,f),t.textAlign="left",t.fillText("Date",A,f),t.font="14px Arial",u.forEach(($,D)=>{if(D>=ie)return;let v=f+a*(D+1.5);t.textAlign="left",t.fillText(`${D+1}.`,x,v),t.fillText($.initials,k,v),t.textAlign="right",t.fillText($.score.toLocaleString(),S+40,v),t.textAlign="left";try{let z=new Date($.createdAt),le=`${z.toLocaleDateString()} ${z.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;t.fillText(le,A,v)}catch{t.fillText("Invalid Date",A,v)}l=v+a})}else t.fillText("No scores yet! Be the first!",e,o),l+=a;let c=l+60;t.textAlign="center",t.font="28px Arial",t.fillText("Start Game:",e,c),t.font="24px Arial",t.fillText("E)asy   M)edium   D)ifficult",e,c+40),t.font="20px Arial",t.textBaseline="bottom",t.fillText("? for Help",e,s.height-50),t.font="16px Arial",t.fillText("(c) Intensity Ventures, 2025",e,s.height-20)}function Me(e){L=e;let i=p[e];ve=i.playerAcceleration,ne=i.shootCooldown,Te=i.asteroidMinSpeed,Ae=i.asteroidSpeedVariation,be=i.initialAsteroidCountBase,J=i.lives,E=J,console.log(`Difficulty set to: ${e}`)}function Le(){y||(y=!0,C=!0,m=0,T=1,fetch("/api/incrementGamesPlayed",{method:"POST"}).then(e=>{e.ok?console.log("Successfully triggered server-side games played increment."):console.error("Failed to increment games played count on server.")}).catch(e=>{console.error("Network error trying to increment games played count:",e)}),r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,d=[],h=[],ae())}function Re(){console.log("Resizing canvas..."),s.width=window.innerWidth,s.height=window.innerHeight,g?se():y||showStartScreen()}function oe(){console.log("Initializing game..."),ze(),q(),Re(),m=0,E=3,T=1,y=!1,g=!1,r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,d=[],h=[]}function ae(){h=[],d=[];let e=5+T*2;console.log(`Level ${T}: Spawning ${e} asteroids.`);for(let i=0;i<e;i++)G("large");r.isInvulnerable=!0,setTimeout(()=>{r.isInvulnerable=!1},ee)}window.addEventListener("resize",()=>{s.width=window.innerWidth,s.height=window.innerHeight,r&&(r.x>s.width+r.size&&(r.x=s.width/2),r.y>s.height+r.size&&(r.y=s.height/2))});function Ce(){for(let e=h.length-1;e>=0;e--){let i=h[e],n=!1;C&&!r.isInvulnerable&&Q(r,i)&&De();for(let o=d.length-1;o>=0;o--){let a=d[o];if(Q(a,i)){d.splice(o,1),$e(i,e),n=!0;break}}n||(i.update(),U(i))}}function $e(e,i){switch(h.splice(i,1),e.sizeType){case"large":m+=20;for(let n=0;n<2;n++)G("medium",e.x,e.y);break;case"medium":m+=50;for(let n=0;n<2;n++)G("small",e.x,e.y);break;case"small":m+=100;break}h.length===0&&(T++,ae())}function De(){if(!r.isInvulnerable){if(E--,E<=0){re();return}r.x=s.width/2,r.y=s.height/2,r.speed=0,r.angle=-Math.PI/2,r.isInvulnerable=!0,setTimeout(()=>{r.isInvulnerable=!1},ee)}}async function ze(){console.log("Fetching global games played count...");try{let e=await fetch("/api/gamesPlayed");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let i=await e.json();typeof i.count=="number"?(P=i.count,console.log(`Global games played count: ${P}`)):(console.warn("Received invalid count from API."),P=0)}catch(e){console.error("Failed to fetch games played count:",e),P=0}}oe();requestAnimationFrame(R);
